(()=>{var e={};e.id=872,e.ids=[872],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},57147:e=>{"use strict";e.exports=require("fs")},72254:e=>{"use strict";e.exports=require("node:buffer")},6005:e=>{"use strict";e.exports=require("node:crypto")},87561:e=>{"use strict";e.exports=require("node:fs")},88849:e=>{"use strict";e.exports=require("node:http")},22286:e=>{"use strict";e.exports=require("node:https")},87503:e=>{"use strict";e.exports=require("node:net")},49411:e=>{"use strict";e.exports=require("node:path")},97742:e=>{"use strict";e.exports=require("node:process")},84492:e=>{"use strict";e.exports=require("node:stream")},72477:e=>{"use strict";e.exports=require("node:stream/web")},41041:e=>{"use strict";e.exports=require("node:url")},47261:e=>{"use strict";e.exports=require("node:util")},65628:e=>{"use strict";e.exports=require("node:zlib")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},71267:e=>{"use strict";e.exports=require("worker_threads")},59796:e=>{"use strict";e.exports=require("zlib")},27738:e=>{e.exports={style:{fontFamily:"'__Poppins_12c8de', '__Poppins_Fallback_12c8de'",fontWeight:600,fontStyle:"normal"},className:"__className_12c8de"}},59237:e=>{e.exports={style:{fontFamily:"'__Kalam_44673f', '__Kalam_Fallback_44673f'",fontWeight:400,fontStyle:"normal"},className:"__className_44673f"}},89611:e=>{e.exports={style:{fontFamily:"'__Kalam_44673f', '__Kalam_Fallback_44673f'",fontWeight:400,fontStyle:"normal"},className:"__className_44673f"}},96586:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalError:()=>s.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var r=n(50482),i=n(69108),o=n(62563),s=n.n(o),a=n(68300),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);n.d(t,l);let d=["",{children:["board",{children:["[boardId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(n.bind(n,64877)),"/home/homenok/LastHap/miro-clone/app/board/[boardId]/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(n.bind(n,57481))).default(e),async e=>(await Promise.resolve().then(n.bind(n,23757))).default(e),async e=>(await Promise.resolve().then(n.bind(n,71927))).default(e)],apple:[async e=>(await Promise.resolve().then(n.bind(n,53226))).default(e)],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(n.bind(n,1949)),"/home/homenok/LastHap/miro-clone/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(n.t.bind(n,69361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(n.bind(n,57481))).default(e),async e=>(await Promise.resolve().then(n.bind(n,23757))).default(e),async e=>(await Promise.resolve().then(n.bind(n,71927))).default(e)],apple:[async e=>(await Promise.resolve().then(n.bind(n,53226))).default(e)],openGraph:[],twitter:[],manifest:void 0}}],c=["/home/homenok/LastHap/miro-clone/app/board/[boardId]/page.tsx"],u="/board/[boardId]/page",h={require:n,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/board/[boardId]/page",pathname:"/board/[boardId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},11497:(e,t,n)=>{Promise.resolve().then(n.bind(n,79827)),Promise.resolve().then(n.bind(n,97767)),Promise.resolve().then(n.bind(n,42715)),Promise.resolve().then(n.bind(n,77660)),Promise.resolve().then(n.bind(n,94541))},79827:(e,t,n)=>{"use strict";let r,i;n.r(t),n.d(t,{Canvas:()=>em});var o=n(95344),s=n(92121),a=n(6005);function l(e=21){var t;t=e-=0,!r||r.length<t?(r=Buffer.allocUnsafe(128*t),a.webcrypto.getRandomValues(r),i=0):i+t>r.length&&(a.webcrypto.getRandomValues(r),i=0),i+=t;let n="";for(let t=i-e;t<i;t++)n+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[t]];return n}var d=n(3729);let c=()=>{(0,d.useEffect)(()=>(document.body.classList.add("overflow-hidden","overscroll-none"),()=>{document.body.classList.remove("overflow-hidden","overscroll-none")}),[])};var u=n(61489);let h=()=>{let e=(0,u.Sk)(e=>e.presence.selection);return(0,u.Db)(({storage:t,setMyPresence:n})=>{let r=t.get("layers"),i=t.get("layerIds");for(let t of e){r.delete(t);let e=i.indexOf(t);-1!==e&&i.delete(e)}n({selection:[]},{addToHistory:!0})},[e])};var p=n(91626),f=n(21584),m=n(69224);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let y=(0,m.Z)("MousePointer2",[["path",{d:"m4 4 7.07 17 2.51-7.39L21 11.07z",key:"1vqm48"}]]),g=(0,d.memo)(({connectionId:e})=>{let t=(0,u.v8)(e,e=>e?.info),n=(0,u.v8)(e,e=>e.presence.cursor),r=t?.name||"Teammate";if(!n)return null;let{x:i,y:s}=n;return(0,o.jsxs)("foreignObject",{style:{transform:`translateX(${i}px) translateY(${s}px)`},height:50,width:10*r.length+24,className:"relative drop-shadow-md",children:[o.jsx(y,{className:"h-5 w-5",style:{fill:(0,p.t_)(e),color:(0,p.t_)(e)}}),o.jsx("div",{className:"absolute left-5 px-1.5 py-0.5 rounded-md text-sm text-white font-semibold",style:{backgroundColor:(0,p.t_)(e)},children:r})]})});function b(e,t,n,r=e=>e){return e*r(.5-t*(.5-n))}function _(e,t){return[e[0]+t[0],e[1]+t[1]]}function v(e,t){return[e[0]-t[0],e[1]-t[1]]}function x(e,t){return[e[0]*t,e[1]*t]}function w(e){return[e[1],-e[0]]}function E(e,t){return e[0]*t[0]+e[1]*t[1]}function S(e,t){var n;return(n=v(e,t))[0]*n[0]+n[1]*n[1]}function k(e){var t;return t=Math.hypot(e[0],e[1]),[e[0]/t,e[1]/t]}function T(e,t,n){let r=Math.sin(n),i=Math.cos(n),o=e[0]-t[0],s=e[1]-t[1];return[o*i-s*r+t[0],o*r+s*i+t[1]]}function I(e,t,n){return _(e,x(v(t,e),n))}g.displayName="Cursor";var{min:O,PI:C}=Math,A=C+1e-4;let N=({x:e,y:t,points:n,fill:r,onPointerDown:i,stroke:s})=>o.jsx("path",{className:"drop-shadow-md",onPointerDown:i,d:(0,p.US)(function(e,t={}){return function(e,t={}){var n,r;let{size:i=16,smoothing:o=.5,thinning:s=.5,simulatePressure:a=!0,easing:l=e=>e,start:d={},end:c={},last:u=!1}=t,{cap:h=!0,easing:p=e=>e*(2-e)}=d,{cap:f=!0,easing:m=e=>--e*e*e+1}=c;if(0===e.length||i<=0)return[];let y=e[e.length-1].runningLength,g=!1===d.taper?0:!0===d.taper?Math.max(i,y):d.taper,C=!1===c.taper?0:!0===c.taper?Math.max(i,y):c.taper,N=Math.pow(i*o,2),P=[],L=[],j=e.slice(0,10).reduce((e,t)=>{let n=t.pressure;if(a){let r=O(1,t.distance/i),o=O(1,1-r);n=O(1,e+.275*r*(o-e))}return(e+n)/2},e[0].pressure),R=b(i,s,e[e.length-1].pressure,l),D,M=e[0].vector,U=e[0].point,$=U,z=U,K=$,F=!1;for(let t=0;t<e.length;t++){let{pressure:n}=e[t],{point:r,vector:o,distance:d,runningLength:c}=e[t];if(t<e.length-1&&y-c<3)continue;if(s){if(a){let e=O(1,d/i),t=O(1,1-e);n=O(1,j+.275*e*(t-j))}R=b(i,s,n,l)}else R=i/2;void 0===D&&(D=R),R=Math.max(.01,R*Math.min(c<g?p(c/g):1,y-c<C?m((y-c)/C):1));let u=(t<e.length-1?e[t+1]:e[t]).vector,h=t<e.length-1?E(o,u):1,f=0>E(o,M)&&!F,k=null!==h&&h<0;if(f||k){let e=x(w(M),R);for(let t=1/13,n=0;n<=1;n+=t)z=T(v(r,e),r,A*n),P.push(z),K=T(_(r,e),r,-(A*n)),L.push(K);U=z,$=K,k&&(F=!0);continue}if(F=!1,t===e.length-1){let e=x(w(o),R);P.push(v(r,e)),L.push(_(r,e));continue}let q=x(w(I(u,o,h)),R);z=v(r,q),(t<=1||S(U,z)>N)&&(P.push(z),U=z),K=_(r,q),(t<=1||S($,K)>N)&&(L.push(K),$=K),j=n,M=o}let q=e[0].point.slice(0,2),H=e.length>1?e[e.length-1].point.slice(0,2):_(e[0].point,[1,1]),W=[],B=[];if(1===e.length){if(!(g||C)||u){let e=(n=k(w(v(q,H))),_(q,x(n,-(D||R)))),t=[];for(let n=1/13,r=n;r<=1;r+=n)t.push(T(e,q,2*A*r));return t}}else{if(!(g||C&&1===e.length)){if(h)for(let e=1/13,t=e;t<=1;t+=e){let e=T(L[0],q,A*t);W.push(e)}else{let e=v(P[0],L[0]),t=x(e,.5),n=x(e,.51);W.push(v(q,t),v(q,n),_(q,n),_(q,t))}}let t=w([-(r=e[e.length-1].vector)[0],-r[1]]);if(C||g&&1===e.length)B.push(H);else if(f){let e=_(H,x(t,R));for(let t=1/29,n=t;n<1;n+=t)B.push(T(e,H,3*A*n))}else B.push(_(H,x(t,R)),_(H,x(t,.99*R)),v(H,x(t,.99*R)),v(H,x(t,R)))}return P.concat(B,L.reverse(),W)}(function(e,t={}){var n,r,i;let{streamline:o=.5,size:s=16,last:a=!1}=t;if(0===e.length)return[];let l=.15+(1-o)*.85,d=Array.isArray(e[0])?e:e.map(({x:e,y:t,pressure:n=.5})=>[e,t,n]);if(2===d.length){let e=d[1];d=d.slice(0,-1);for(let t=1;t<5;t++)d.push(I(d[0],e,t/4))}1===d.length&&(d=[...d,[..._(d[0],[1,1]),...d[0].slice(2)]]);let c=[{point:[d[0][0],d[0][1]],pressure:d[0][2]>=0?d[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],u=!1,h=0,p=c[0],f=d.length-1;for(let e=1;e<d.length;e++){let t=a&&e===f?d[e].slice(0,2):I(p.point,d[e],l);if((r=p.point)[0]===t[0]&&r[1]===t[1])continue;let n=(i=p.point,Math.hypot(t[1]-i[1],t[0]-i[0]));if(h+=n,e<f&&!u){if(h<s)continue;u=!0}p={point:t,pressure:d[e][2]>=0?d[e][2]:.5,vector:k(v(p.point,t)),distance:n,runningLength:h},c.push(p)}return c[0].vector=(null==(n=c[1])?void 0:n.vector)||[0,0],c}(e,t),t)}(n,{size:16,thinning:.5,smoothing:.5,streamline:.5})),style:{transform:`translate(${e}px, ${t}px)`},x:0,y:0,fill:r,stroke:s,strokeWidth:1}),P=()=>{let e=(0,u.YT)();return o.jsx(o.Fragment,{children:e.map(e=>o.jsx(g,{connectionId:e},e))})},L=()=>{let e=(0,u.hL)(e=>({pencilDraft:e.presence.pencilDraft,penColor:e.presence.penColor}),s.Xd);return o.jsx(o.Fragment,{children:e.map(([e,t])=>t.pencilDraft?o.jsx(N,{x:0,y:0,points:t.pencilDraft,fill:t.penColor?(0,p._M)(t.penColor):"#000"},e):null)})},j=(0,d.memo)(()=>(0,o.jsxs)(o.Fragment,{children:[o.jsx(L,{}),o.jsx(P,{})]}));j.displayName="CursorsPresence";var R=n(97767);let D=({id:e,layer:t,onPointerDown:n,selectionColor:r})=>o.jsx("ellipse",{className:"drop-shadow-md",onPointerDown:t=>n(t,e),style:{transform:`translate(${t.x}px, ${t.y}px)`},cx:t.width/2,cy:t.height/2,rx:t.width/2,ry:t.height/2,fill:t.fill?(0,p._M)(t.fill):"#000",stroke:r||"transparent",strokeWidth:1});var M=n(59237),U=n.n(M),$=n(70496);let z=(e,t)=>Math.min(.15*t,.15*e,96),K=({id:e,layer:t,onPointerDown:n,selectionColor:r})=>{let{x:i,y:s,width:a,height:l,fill:d,value:c}=t,h=(0,u.Db)(({storage:t},n)=>{let r=t.get("layers");r.get(e)?.set("value",n)},[]);return o.jsx("foreignObject",{x:i,y:s,width:a,height:l,onPointerDown:t=>n(t,e),style:{outline:r?`1px solid ${r}`:"none",backgroundColor:d?(0,p._M)(d):"#000"},className:"shadow-md drop-shadow-xl",children:o.jsx($.Z,{html:c||"Text",onChange:e=>{h(e.target.value)},className:(0,p.cn)("h-full w-full flex items-center justify-center text-center outline-none",U().className),style:{fontSize:z(a,l),color:d?(0,p.YJ)(d):"#000"}})})},F=({id:e,layer:t,onPointerDown:n,selectionColor:r})=>{let{x:i,y:s,width:a,height:l,fill:d}=t;return o.jsx("rect",{className:"drop-shadow-md",onPointerDown:t=>n(t,e),style:{transform:`translate(${i}px, ${s}px)`},x:0,y:0,width:a,height:l,strokeWidth:1,fill:d?(0,p._M)(d):"#000",stroke:r||"transparent"})};var q=n(89611),H=n.n(q);let W=(e,t)=>Math.min(.5*t,.5*e,96),B=({id:e,layer:t,onPointerDown:n,selectionColor:r})=>{let{x:i,y:s,width:a,height:l,fill:d,value:c}=t,h=(0,u.Db)(({storage:t},n)=>{let r=t.get("layers");r.get(e)?.set("value",n)},[]);return o.jsx("foreignObject",{x:i,y:s,width:a,height:l,onPointerDown:t=>n(t,e),style:{outline:r?`1px solid ${r}`:"none"},children:o.jsx($.Z,{html:c||"Text",onChange:e=>{h(e.target.value)},className:(0,p.cn)("h-full w-full flex items-center justify-center text-center drop-shadow-md outline-none",H().className),style:{fontSize:W(a,l),color:d?(0,p._M)(d):"#000"}})})},V=(0,d.memo)(({id:e,onLayerPointerDown:t,selectionColor:n})=>{let r=(0,u.y$)(t=>t.layers.get(e));if(!r)return null;switch(r.type){case f.F5.Path:return o.jsx(N,{points:r.points,onPointerDown:n=>t(n,e),x:r.x,y:r.y,fill:r.fill?(0,p._M)(r.fill):"#000",stroke:n},e);case f.F5.Note:return o.jsx(K,{id:e,layer:r,onPointerDown:t,selectionColor:n});case f.F5.Text:return o.jsx(B,{id:e,layer:r,onPointerDown:t,selectionColor:n});case f.F5.Ellipse:return o.jsx(D,{id:e,layer:r,onPointerDown:t,selectionColor:n});case f.F5.Rectangle:return o.jsx(F,{id:e,onPointerDown:t,selectionColor:n,layer:r});default:return console.warn("Unknown layer type"),null}});V.displayName="LayerPreview";var G=n(42715);let J=e=>{let t=e[0];if(!t)return null;let n=t.x,r=t.x+t.width,i=t.y,o=t.y+t.height;for(let t=1;t<e.length;t++){let{x:s,y:a,width:l,height:d}=e[t];n>s&&(n=s),r<s+l&&(r=s+l),i>a&&(i=a),o<a+d&&(o=a+d)}return{x:n,y:i,width:r-n,height:o-i}},Y=()=>{let e=(0,u.Sk)(e=>e.presence.selection);return(0,u.y$)(t=>J(e.map(e=>t.layers.get(e)).filter(Boolean)),s.Xd)},X=(0,d.memo)(({onResizeHandlePointerDown:e})=>{let t=(0,u.Sk)(e=>1===e.presence.selection.length?e.presence.selection[0]:null),n=(0,u.y$)(e=>t&&e.layers.get(t)?.type!==f.F5.Path),r=Y();return r?(0,o.jsxs)(o.Fragment,{children:[o.jsx("rect",{className:"fill-transparent stroke-blue-500 stroke-1 pointer-events-none",style:{transform:`translate(${r.x}px, ${r.y}px)`},x:0,y:0,width:r.width,height:r.height}),n&&(0,o.jsxs)(o.Fragment,{children:[o.jsx("rect",{className:"fill-white stroke-1 stroke-blue-500",x:0,y:0,style:{cursor:"nwse-resize",width:"8px",height:"8px",transform:`
                translate(
                  ${r.x-4}px,
                  ${r.y-4}px
                )
              `},onPointerDown:t=>{t.stopPropagation(),e(f.MF.Top+f.MF.Left,r)}}),o.jsx("rect",{className:"fill-white stroke-1 stroke-blue-500",x:0,y:0,style:{cursor:"ns-resize",width:"8px",height:"8px",transform:`
                translate(
                  ${r.x+r.width/2-4}px, 
                  ${r.y-4}px
                )
              `},onPointerDown:t=>{t.stopPropagation(),e(f.MF.Top,r)}}),o.jsx("rect",{className:"fill-white stroke-1 stroke-blue-500",x:0,y:0,style:{cursor:"nesw-resize",width:"8px",height:"8px",transform:`
                translate(
                  ${r.x-4+r.width}px,
                  ${r.y-4}px
                )`},onPointerDown:t=>{t.stopPropagation(),e(f.MF.Top+f.MF.Right,r)}}),o.jsx("rect",{className:"fill-white stroke-1 stroke-blue-500",x:0,y:0,style:{cursor:"ew-resize",width:"8px",height:"8px",transform:`
                translate(
                  ${r.x-4+r.width}px, 
                  ${r.y+r.height/2-4}px
                )`},onPointerDown:t=>{t.stopPropagation(),e(f.MF.Right,r)}}),o.jsx("rect",{className:"fill-white stroke-1 stroke-blue-500",x:0,y:0,style:{cursor:"nwse-resize",width:"8px",height:"8px",transform:`
                translate(
                  ${r.x-4+r.width}px, 
                  ${r.y-4+r.height}px
                )`},onPointerDown:t=>{t.stopPropagation(),e(f.MF.Bottom+f.MF.Right,r)}}),o.jsx("rect",{className:"fill-white stroke-1 stroke-blue-500",x:0,y:0,style:{cursor:"ns-resize",width:"8px",height:"8px",transform:`
                translate(
                  ${r.x+r.width/2-4}px,
                  ${r.y-4+r.height}px
                )`},onPointerDown:t=>{t.stopPropagation(),e(f.MF.Bottom,r)}}),o.jsx("rect",{className:"fill-white stroke-1 stroke-blue-500",x:0,y:0,style:{cursor:"nesw-resize",width:"8px",height:"8px",transform:`
                translate(
                  ${r.x-4}px,
                  ${r.y-4+r.height}px
                )`},onPointerDown:t=>{t.stopPropagation(),e(f.MF.Bottom+f.MF.Left,r)}}),o.jsx("rect",{className:"fill-white stroke-1 stroke-blue-500",x:0,y:0,style:{cursor:"ew-resize",width:"8px",height:"8px",transform:`
                translate(
                  ${r.x-4}px,
                  ${r.y-4+r.height/2}px
                )`},onPointerDown:t=>{t.stopPropagation(),e(f.MF.Left,r)}})]})]}):null});X.displayName="SelectionBox";/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let Z=(0,m.Z)("BringToFront",[["rect",{x:"8",y:"8",width:"8",height:"8",rx:"2",key:"yj20xf"}],["path",{d:"M4 10a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2",key:"1ltk23"}],["path",{d:"M14 20a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2",key:"1q24h9"}]]),Q=(0,m.Z)("SendToBack",[["rect",{x:"14",y:"14",width:"8",height:"8",rx:"2",key:"1b0bso"}],["rect",{x:"2",y:"2",width:"8",height:"8",rx:"2",key:"1x09vl"}],["path",{d:"M7 14v1a2 2 0 0 0 2 2h1",key:"pao6x6"}],["path",{d:"M14 7h1a2 2 0 0 1 2 2v1",key:"19tdru"}]]);var ee=n(38271),et=n(16212),en=n(59174);let er=({onChange:e})=>(0,o.jsxs)("div",{className:"flex flex-wrap gap-2 items-center max-w-[164px] pr-2 mr-2 border-r border-neutral-200",children:[o.jsx(ei,{color:{r:243,g:82,b:35},onClick:e}),o.jsx(ei,{color:{r:255,g:249,b:177},onClick:e}),o.jsx(ei,{color:{r:68,g:202,b:99},onClick:e}),o.jsx(ei,{color:{r:39,g:142,b:237},onClick:e}),o.jsx(ei,{color:{r:155,g:105,b:245},onClick:e}),o.jsx(ei,{color:{r:252,g:142,b:42},onClick:e}),o.jsx(ei,{color:{r:0,g:0,b:0},onClick:e}),o.jsx(ei,{color:{r:255,g:255,b:255},onClick:e})]}),ei=({color:e,onClick:t})=>o.jsx("button",{className:"w-8 h-8 items-center flex justify-center hover:opacity-75 transition",onClick:()=>t(e),children:o.jsx("div",{className:"h-8 w-8 rounded-md border border-neutral-300",style:{background:(0,p._M)(e)},"aria-hidden":!0})}),eo=(0,d.memo)(({camera:e,setLastUsedColor:t})=>{let n=(0,u.Sk)(e=>e.presence.selection),r=(0,u.Db)(({storage:e})=>{let t=e.get("layerIds"),r=[],i=t.toImmutable();for(let e=0;e<i.length;e++)n.includes(i[e])&&r.push(e);for(let e=r.length-1;e>=0;e--)t.move(r[e],i.length-1-(r.length-1-e))},[n]),i=(0,u.Db)(({storage:e})=>{let t=e.get("layerIds"),r=[],i=t.toImmutable();for(let e=0;e<i.length;e++)n.includes(i[e])&&r.push(e);for(let e=0;e<r.length;e++)t.move(r[e],e)},[n]),s=(0,u.Db)(({storage:e},r)=>{let i=e.get("layers");t(r),n.forEach(e=>{i.get(e)?.set("fill",r)})},[n,t]),a=h(),l=Y();if(!l)return null;let d=l.width/2+l.x+e.x,c=l.y+e.y;return(0,o.jsxs)("div",{className:"absolute p-3 rounded-xl bg-white shadow-sm border flex select-none",style:{transform:`translate(
            calc(${d}px - 50%),
            calc(${c-16}px - 100%)
        )`},children:[o.jsx(er,{onChange:s}),(0,o.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[o.jsx(en.k,{label:"Bring to front",children:o.jsx(et.z,{onClick:r,variant:"board",size:"icon",children:o.jsx(Z,{})})}),o.jsx(en.k,{label:"Bring to back",side:"bottom",children:o.jsx(et.z,{onClick:i,variant:"board",size:"icon",children:o.jsx(Q,{})})})]}),o.jsx("div",{className:"flex items-center pl-2 ml-2 border-l border-t-neutral-200",children:o.jsx(en.k,{label:"Delete",children:o.jsx(et.z,{variant:"board",size:"icon",onClick:a,children:o.jsx(ee.Z,{})})})})]})});eo.displayName="SelectionTools";/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let es=(0,m.Z)("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),ea=(0,m.Z)("StickyNote",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]),el=(0,m.Z)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var ed=n(82958),ec=n(31741);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let eu=(0,m.Z)("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]),eh=(0,m.Z)("Redo2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5v0A5.5 5.5 0 0 0 9.5 20H13",key:"19mnr4"}]]);var ep=n(77660);let ef=({canvasState:e,setCanvasState:t,undo:n,redo:r,canRedo:i,canUndo:s})=>(0,o.jsxs)("div",{className:"absolute top-[50%] -translate-y-[50%] left-2 flex flex-col gap-y-4",children:[(0,o.jsxs)("div",{className:"bg-white rounded-md p-1.5 flex gap-y-1 flex-col items-center shadow-md",children:[o.jsx(ep.ToolButton,{label:"Select",icon:y,onClick:()=>t({mode:f.Lz.None}),isActive:e.mode===f.Lz.None||e.mode===f.Lz.Translating||e.mode===f.Lz.SelectionNet||e.mode===f.Lz.Pressing||e.mode===f.Lz.Resizing}),o.jsx(ep.ToolButton,{label:"Text",icon:es,onClick:()=>t({mode:f.Lz.Inserting,layerType:f.F5.Text}),isActive:e.mode===f.Lz.Inserting&&e.layerType===f.F5.Text}),o.jsx(ep.ToolButton,{label:"Sticky note",icon:ea,onClick:()=>t({mode:f.Lz.Inserting,layerType:f.F5.Note}),isActive:e.mode===f.Lz.Inserting&&e.layerType===f.F5.Note}),o.jsx(ep.ToolButton,{label:"Rectangle",icon:el,onClick:()=>t({mode:f.Lz.Inserting,layerType:f.F5.Rectangle}),isActive:e.mode===f.Lz.Inserting&&e.layerType===f.F5.Rectangle}),o.jsx(ep.ToolButton,{label:"Ellipse",icon:ed.Z,onClick:()=>t({mode:f.Lz.Inserting,layerType:f.F5.Ellipse}),isActive:e.mode===f.Lz.Inserting&&e.layerType===f.F5.Ellipse}),o.jsx(ep.ToolButton,{label:"Pen",icon:ec.Z,onClick:()=>t({mode:f.Lz.Pencil}),isActive:e.mode===f.Lz.Pencil})]}),(0,o.jsxs)("div",{className:"bg-white rounded-md p-1.5 flex flex-col items-center shadow-md",children:[o.jsx(ep.ToolButton,{label:"Undo",icon:eu,onClick:n,isDisabled:!s}),o.jsx(ep.ToolButton,{label:"Redo",icon:eh,onClick:r,isDisabled:!i})]})]}),em=({boardId:e})=>{let t=(0,u.y$)(e=>e.layerIds),n=(0,u.Sk)(e=>e.presence.pencilDraft),[r,i]=(0,d.useState)({mode:f.Lz.None}),[a,m]=(0,d.useState)({x:0,y:0}),[y,g]=(0,d.useState)({r:0,g:0,b:0});c();let b=(0,u.k6)(),_=(0,u.xF)(),v=(0,u.Pq)(),x=(0,u.Db)(({storage:e,setMyPresence:t},n,r)=>{let o=e.get("layers");if(o.size>=100)return;let a=e.get("layerIds"),d=l(),c=new s.EU({type:n,x:r.x,y:r.y,height:100,width:100,fill:y});a.push(d),o.set(d,c),t({selection:[d]},{addToHistory:!0}),i({mode:f.Lz.None})},[y]),w=(0,u.Db)(({storage:e,self:t},n)=>{if(r.mode!==f.Lz.Translating)return;let o={x:n.x-r.current.x,y:n.y-r.current.y},s=e.get("layers");for(let e of t.presence.selection){let t=s.get(e);t&&t.update({x:t.get("x")+o.x,y:t.get("y")+o.y})}i({mode:f.Lz.Translating,current:n})},[r]),E=(0,u.Db)(({self:e,setMyPresence:t})=>{e.presence.selection.length>0&&t({selection:[]},{addToHistory:!0})},[]),S=(0,u.Db)(({storage:e,setMyPresence:n},r,o)=>{let s=e.get("layers").toImmutable();i({mode:f.Lz.SelectionNet,origin:o,current:r}),n({selection:(0,p.n$)(t,s,o,r)})},[t]),k=(0,d.useCallback)((e,t)=>{Math.abs(e.x-t.x)+Math.abs(e.y-t.y)>5&&i({mode:f.Lz.SelectionNet,origin:t,current:e})},[]),T=(0,u.Db)(({self:e,setMyPresence:t},n,i)=>{let{pencilDraft:o}=e.presence;r.mode===f.Lz.Pencil&&1===i.buttons&&null!=o&&t({cursor:n,pencilDraft:1===o.length&&o[0][0]===n.x&&o[0][1]===n.y?o:[...o,[n.x,n.y,i.pressure]]})},[r.mode]),I=(0,u.Db)(({storage:e,self:t,setMyPresence:n})=>{let r=e.get("layers"),{pencilDraft:o}=t.presence;if(null==o||o.length<2||r.size>=100){n({pencilDraft:null});return}let a=l();r.set(a,new s.EU((0,p.Ad)(o,y))),e.get("layerIds").push(a),n({pencilDraft:null}),i({mode:f.Lz.Pencil})},[y]),O=(0,u.Db)(({setMyPresence:e},t,n)=>{e({pencilDraft:[[t.x,t.y,n]],penColor:y})},[y]),C=(0,u.Db)(({storage:e,self:t},n)=>{if(r.mode!==f.Lz.Resizing)return;let i=(0,p.zY)(r.initialBounds,r.corner,n),o=e.get("layers").get(t.presence.selection[0]);o&&o.update(i)},[r]),A=(0,d.useCallback)((e,t)=>{b.pause(),i({mode:f.Lz.Resizing,initialBounds:t,corner:e})},[b]),P=(0,d.useCallback)(e=>{m(t=>({x:t.x-e.deltaX,y:t.y-e.deltaY}))},[]),L=(0,u.Db)(({setMyPresence:e},t)=>{t.preventDefault();let n=(0,p.pF)(t,a);r.mode===f.Lz.Pressing?k(n,r.origin):r.mode===f.Lz.SelectionNet?S(n,r.origin):r.mode===f.Lz.Translating?w(n):r.mode===f.Lz.Resizing?C(n):r.mode===f.Lz.Pencil&&T(n,t),e({cursor:n})},[k,S,T,r,C,a,w]),D=(0,u.Db)(({setMyPresence:e})=>{e({cursor:null})},[]),M=(0,d.useCallback)(e=>{let t=(0,p.pF)(e,a);if(r.mode!==f.Lz.Inserting){if(r.mode===f.Lz.Pencil){O(t,e.pressure);return}i({origin:t,mode:f.Lz.Pressing})}},[a,r.mode,i,O]),U=(0,u.Db)(({},e)=>{let t=(0,p.pF)(e,a);r.mode===f.Lz.None||r.mode===f.Lz.Pressing?(E(),i({mode:f.Lz.None})):r.mode===f.Lz.Pencil?I():r.mode===f.Lz.Inserting?x(r.layerType,t):i({mode:f.Lz.None}),b.resume()},[i,a,r,b,x,E,I]),$=(0,u.hL)(e=>e.presence.selection),z=(0,u.Db)(({self:e,setMyPresence:t},n,o)=>{if(r.mode===f.Lz.Pencil||r.mode===f.Lz.Inserting)return;b.pause(),n.stopPropagation();let s=(0,p.pF)(n,a);e.presence.selection.includes(o)||t({selection:[o]},{addToHistory:!0}),i({mode:f.Lz.Translating,current:s})},[i,a,b,r.mode]),K=(0,d.useMemo)(()=>{let e={};for(let t of $){let[n,r]=t;for(let t of r)e[t]=(0,p.t_)(n)}return e},[$]),F=h();return(0,d.useEffect)(()=>{function e(e){"z"===e.key&&(e.ctrlKey||e.metaKey)&&(e.shiftKey||e.altKey?b.redo():b.undo())}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[F,b]),(0,o.jsxs)("main",{className:"h-full w-full relative bg-neutral-100 touch-none",children:[o.jsx(R.Info,{boardId:e}),o.jsx(G.Participants,{}),o.jsx(ef,{canvasState:r,setCanvasState:i,canRedo:v,canUndo:_,undo:b.undo,redo:b.redo}),o.jsx(eo,{camera:a,setLastUsedColor:g}),o.jsx("svg",{className:"h-[100vh] w-[100vw]",onWheel:P,onPointerMove:L,onPointerLeave:D,onPointerDown:M,onPointerUp:U,children:(0,o.jsxs)("g",{style:{transform:`translate(${a.x}px, ${a.y}px)`},children:[t.map(e=>o.jsx(V,{id:e,onLayerPointerDown:z,selectionColor:K[e]},e)),o.jsx(X,{onResizeHandlePointerDown:A}),r.mode===f.Lz.SelectionNet&&null!=r.current&&o.jsx("rect",{className:"fill-blue-500/5 stroke-blue-500 stroke-1",x:Math.min(r.origin.x,r.current.x),y:Math.min(r.origin.y,r.current.y),width:Math.abs(r.origin.x-r.current.x),height:Math.abs(r.origin.y-r.current.y)}),o.jsx(j,{}),null!=n&&n.length>0&&o.jsx(N,{points:n,fill:(0,p._M)(y),x:0,y:0})]})})]})}},97767:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Info:()=>g,InfoSkeleton:()=>b});var r=n(95344),i=n(27738),o=n.n(i),s=n(33523);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,n(69224).Z)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);var l=n(89410),d=n(56506),c=n(50004),u=n(59174),h=n(16212),p=n(10948),f=n(91626),m=n(97401);let y=()=>r.jsx("div",{className:"text-neutral-300 px-1.5",children:"|"}),g=({boardId:e})=>{let{onOpen:t}=(0,m.C)(),n=(0,s.aM)(p.h.board.get,{id:e});return n?(0,r.jsxs)("div",{className:"absolute top-2 left-2 bg-white rounded-md px-1.5 h-12 flex items-center shadow-md",children:[r.jsx(u.k,{label:"Go to boards",side:"bottom",sideOffset:10,children:r.jsx(h.z,{variant:"board",className:"px-2",asChild:!0,children:(0,r.jsxs)(d.default,{href:"/",children:[r.jsx(l.default,{src:"/logo.svg",alt:"Miro Clone Logo",height:40,width:40}),r.jsx("span",{className:(0,f.cn)("font-semibold text-xl ml-2 text-black",o().className),children:"Miro"})]})})}),r.jsx(y,{}),r.jsx(u.k,{label:"Edit title",side:"bottom",sideOffset:10,children:r.jsx(h.z,{onClick:()=>t(n._id,n.title),variant:"board",className:"text-base font-normal px-2",children:n.title})}),r.jsx(y,{}),r.jsx(c.e,{id:n._id,title:n.title,side:"bottom",sideOffset:10,children:r.jsx("div",{className:"",children:r.jsx(u.k,{label:"Main menu",side:"bottom",sideOffset:10,children:r.jsx(h.z,{size:"icon",variant:"board",children:r.jsx(a,{})})})})})]}):r.jsx(b,{})},b=()=>r.jsx("div",{className:"w-[300px] absolute top-2 left-2 bg-white rounded-md px-1.5 h-12 flex items-center shadow-md","aria-hidden":!0})},42715:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Participants:()=>k,ParticipantsSkeleton:()=>T});var r=n(95344),i=n(91626),o=n(61489),s=n(59174),a=n(3729),l=n(65651),d=n(98462),c=n(2256),u=n(16069),h=n(62409);let p="Avatar",[f,m]=(0,d.b)(p),[y,g]=f(p),b=(0,a.forwardRef)((e,t)=>{let{__scopeAvatar:n,...r}=e,[i,o]=(0,a.useState)("idle");return(0,a.createElement)(y,{scope:n,imageLoadingStatus:i,onImageLoadingStatusChange:o},(0,a.createElement)(h.WV.span,(0,l.Z)({},r,{ref:t})))}),_=(0,a.forwardRef)((e,t)=>{let{__scopeAvatar:n,src:r,onLoadingStatusChange:i=()=>{},...o}=e,s=g("AvatarImage",n),d=function(e){let[t,n]=(0,a.useState)("idle");return(0,u.b)(()=>{if(!e){n("error");return}let t=!0,r=new window.Image,i=e=>()=>{t&&n(e)};return n("loading"),r.onload=i("loaded"),r.onerror=i("error"),r.src=e,()=>{t=!1}},[e]),t}(r),p=(0,c.W)(e=>{i(e),s.onImageLoadingStatusChange(e)});return(0,u.b)(()=>{"idle"!==d&&p(d)},[d,p]),"loaded"===d?(0,a.createElement)(h.WV.img,(0,l.Z)({},o,{ref:t,src:r})):null}),v=(0,a.forwardRef)((e,t)=>{let{__scopeAvatar:n,delayMs:r,...i}=e,o=g("AvatarFallback",n),[s,d]=(0,a.useState)(void 0===r);return(0,a.useEffect)(()=>{if(void 0!==r){let e=window.setTimeout(()=>d(!0),r);return()=>window.clearTimeout(e)}},[r]),s&&"loaded"!==o.imageLoadingStatus?(0,a.createElement)(h.WV.span,(0,l.Z)({},i,{ref:t})):null}),x=a.forwardRef(({className:e,...t},n)=>r.jsx(b,{ref:n,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));x.displayName=b.displayName;let w=a.forwardRef(({className:e,...t},n)=>r.jsx(_,{ref:n,className:(0,i.cn)("aspect-square h-full w-full",e),...t}));w.displayName=_.displayName;let E=a.forwardRef(({className:e,...t},n)=>r.jsx(v,{ref:n,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));E.displayName=v.displayName;let S=({src:e,name:t,fallback:n,borderColor:i})=>r.jsx(s.k,{label:t||"Teammate",side:"bottom",sideOffset:18,children:(0,r.jsxs)(x,{className:"h-8 w-8 border-2",style:{borderColor:i},children:[r.jsx(w,{src:e}),r.jsx(E,{className:"text-xs font-semibold",children:n})]})}),k=()=>{let e=(0,o.Rq)(),t=(0,o.Sk)(),n=e.length>2;return r.jsx("div",{className:"absolute h-12 top-2 right-2 bg-white rounded-md p-3 flex items-center shadow-md",children:(0,r.jsxs)("div",{className:"flex gap-x-2",children:[e.slice(0,2).map(({connectionId:e,info:t})=>r.jsx(S,{borderColor:(0,i.t_)(e),src:t?.picture,name:t?.name,fallback:t?.name?.[0]||"T"},e)),t&&r.jsx(S,{borderColor:(0,i.t_)(t.connectionId),src:t.info?.picture,name:`${t.info?.name} (You)`,fallback:t.info?.name?.[0]}),n&&r.jsx(S,{name:`${e.length-2} more`,fallback:`+${e.length-2}`})]})})},T=()=>r.jsx("div",{className:"w-[100px] absolute h-12 top-2 right-2 bg-white rounded-md p-3 flex items-center shadow-md","aria-hidden":!0})},77660:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ToolButton:()=>s});var r=n(95344),i=n(59174),o=n(16212);let s=({label:e,icon:t,onClick:n,isActive:s,isDisabled:a})=>r.jsx(i.k,{label:e,side:"right",sideOffset:14,children:r.jsx(o.z,{disabled:a,"aria-disabled":a,onClick:n,size:"icon",variant:s?"boardActive":"board",children:r.jsx(t,{})})})},94541:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Room:()=>a});var r=n(95344),i=n(92121),o=n(18817),s=n(61489);let a=({children:e,roomId:t,fallback:n})=>r.jsx(s.ke,{id:t,initialPresence:{cursor:null,selection:[],pencilDraft:null,penColor:null},initialStorage:{layers:new i.oV,layerIds:new i.as},children:r.jsx(o.EH,{fallback:n,children:()=>e})})},61489:(e,t,n)=>{"use strict";n.d(t,{Db:()=>C,Pq:()=>O,Rq:()=>u,Sk:()=>c,YT:()=>f,hL:()=>h,k6:()=>S,ke:()=>s,v8:()=>m,xF:()=>I,y$:()=>_});var r=n(92121),i=n(18817);let o=(0,r.eI)({throttle:16,authEndpoint:"/api/liveblocks-auth",resolveUsers:async({userIds:e})=>[],resolveMentionSuggestions:async({text:e})=>[],resolveRoomsInfo:async({roomIds:e})=>[]}),{suspense:{RoomProvider:s,useRoom:a,useMyPresence:l,useUpdateMyPresence:d,useSelf:c,useOthers:u,useOthersMapped:h,useOthersListener:p,useOthersConnectionIds:f,useOther:m,useBroadcastEvent:y,useEventListener:g,useErrorListener:b,useStorage:_,useObject:v,useMap:x,useList:w,useBatch:E,useHistory:S,useUndo:k,useRedo:T,useCanUndo:I,useCanRedo:O,useMutation:C,useStatus:A,useLostConnectionListener:N,useThreads:P,useCreateThread:L,useEditThreadMetadata:j,useCreateComment:R,useEditComment:D,useDeleteComment:M,useAddReaction:U,useRemoveReaction:$,useThreadSubscription:z,useMarkThreadAsRead:K,useRoomNotificationSettings:F,useUpdateRoomNotificationSettings:q}}=(0,i.m1)(o),{suspense:{LiveblocksProvider:H,useMarkInboxNotificationAsRead:W,useMarkAllInboxNotificationsAsRead:B,useInboxNotifications:V,useUnreadInboxNotificationsCount:G,useUser:J,useRoomInfo:Y}}=(0,i.pf)(o)},37187:e=>{"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,o[i]))return!1;for(i=r;0!=i--;){var r,i,o,s=o[i];if(!e(t[s],n[s]))return!1}return!0}return t!=t&&n!=n}},21541:(e,t,n)=>{"use strict";var r=n(40378);function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,o,s){if(s!==r){var a=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return n.PropTypes=n,n}},7470:(e,t,n)=>{"use strict";e.exports=n(21541)()},40378:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},70496:(e,t,n)=>{"use strict";var r=function(){var e=function(t,n){return(e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]},s=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return s(t,e),t},l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},d=a(n(3729)),c=function(e){return e&&e.__esModule?e:{default:e}}(n(37187)),u=a(n(7470));function h(e){return e&&e.replace(/&nbsp;|\u202F|\u00A0/g," ").replace(/<br \/>/g,"<br>")}var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastHtml=t.props.html,t.el="function"==typeof t.props.innerRef?{current:null}:d.createRef(),t.getEl=function(){return(t.props.innerRef&&"function"!=typeof t.props.innerRef?t.props.innerRef:t.el).current},t.emitChange=function(e){var n=t.getEl();if(n){var r=n.innerHTML;if(t.props.onChange&&r!==t.lastHtml){var i=Object.assign({},e,{target:{value:r}});t.props.onChange(i)}t.lastHtml=r}},t}return r(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.tagName,r=t.html,o=t.innerRef,s=l(t,["tagName","html","innerRef"]);return d.createElement(n||"div",i(i({},s),{ref:"function"==typeof o?function(t){o(t),e.el.current=t}:o||this.el,onInput:this.emitChange,onBlur:this.props.onBlur||this.emitChange,onKeyUp:this.props.onKeyUp||this.emitChange,onKeyDown:this.props.onKeyDown||this.emitChange,contentEditable:!this.props.disabled,dangerouslySetInnerHTML:{__html:r}}),this.props.children)},t.prototype.shouldComponentUpdate=function(e){var t=this.props,n=this.getEl();return!n||h(e.html)!==h(n.innerHTML)||t.disabled!==e.disabled||t.tagName!==e.tagName||t.className!==e.className||t.innerRef!==e.innerRef||t.placeholder!==e.placeholder||!(0,c.default)(t.style,e.style)},t.prototype.componentDidUpdate=function(){var e=this.getEl();e&&(this.props.html!==e.innerHTML&&(e.innerHTML=this.props.html),this.lastHtml=this.props.html,function(e){var t=document.createTextNode("");e.appendChild(t);var n=document.activeElement===e;if(null!==t&&null!==t.nodeValue&&n){var r=window.getSelection();if(null!==r){var i=document.createRange();i.setStart(t,t.nodeValue.length),i.collapse(!0),r.removeAllRanges(),r.addRange(i)}e instanceof HTMLElement&&e.focus()}}(e))},t.propTypes={html:u.string.isRequired,onChange:u.func,disabled:u.bool,tagName:u.string,className:u.string,style:u.object,innerRef:u.oneOfType([u.object,u.func])},t}(d.Component);t.Z=p},64877:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>A});var r,i,o,s=n(25036),a=n(86843);let l=(0,a.createProxy)(String.raw`/home/homenok/LastHap/miro-clone/app/board/[boardId]/_components/canvas.tsx`),{__esModule:d,$$typeof:c}=l;l.default;let u=(0,a.createProxy)(String.raw`/home/homenok/LastHap/miro-clone/app/board/[boardId]/_components/canvas.tsx#Canvas`),h=(0,a.createProxy)(String.raw`/home/homenok/LastHap/miro-clone/components/room.tsx`),{__esModule:p,$$typeof:f}=h;h.default;let m=(0,a.createProxy)(String.raw`/home/homenok/LastHap/miro-clone/components/room.tsx#Room`),y=(0,n(59508).Z)("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),g=(0,a.createProxy)(String.raw`/home/homenok/LastHap/miro-clone/app/board/[boardId]/_components/info.tsx`),{__esModule:b,$$typeof:_}=g;g.default,(0,a.createProxy)(String.raw`/home/homenok/LastHap/miro-clone/app/board/[boardId]/_components/info.tsx#Info`);let v=(0,a.createProxy)(String.raw`/home/homenok/LastHap/miro-clone/app/board/[boardId]/_components/info.tsx#InfoSkeleton`),x=(0,a.createProxy)(String.raw`/home/homenok/LastHap/miro-clone/app/board/[boardId]/_components/participants.tsx`),{__esModule:w,$$typeof:E}=x;x.default,(0,a.createProxy)(String.raw`/home/homenok/LastHap/miro-clone/app/board/[boardId]/_components/participants.tsx#Participants`);let S=(0,a.createProxy)(String.raw`/home/homenok/LastHap/miro-clone/app/board/[boardId]/_components/participants.tsx#ParticipantsSkeleton`);(function(e){e[e.Rectangle=0]="Rectangle",e[e.Ellipse=1]="Ellipse",e[e.Path=2]="Path",e[e.Text=3]="Text",e[e.Note=4]="Note"})(r||(r={})),function(e){e[e.Top=1]="Top",e[e.Bottom=2]="Bottom",e[e.Left=4]="Left",e[e.Right=8]="Right"}(i||(i={})),function(e){e[e.None=0]="None",e[e.Pressing=1]="Pressing",e[e.SelectionNet=2]="SelectionNet",e[e.Translating=3]="Translating",e[e.Inserting=4]="Inserting",e[e.Resizing=5]="Resizing",e[e.Pencil=6]="Pencil"}(o||(o={}));let k=(0,a.createProxy)(String.raw`/home/homenok/LastHap/miro-clone/app/board/[boardId]/_components/tool-button.tsx`),{__esModule:T,$$typeof:I}=k;k.default,(0,a.createProxy)(String.raw`/home/homenok/LastHap/miro-clone/app/board/[boardId]/_components/tool-button.tsx#ToolButton`);let O=()=>s.jsx("div",{className:"absolute top-[50%] -translate-y-[50%] left-2 flex flex-col gap-y-4 bg-white h-[360px] w-[52px] shadow-md rounded-md","aria-hidden":!0}),C=()=>(0,s.jsxs)("main",{className:"h-full w-full relative bg-neutral-100 touch-none flex items-center justify-center",children:[s.jsx(y,{className:"h-6 w-6 text-muted-foreground animate-spin"}),s.jsx(v,{}),s.jsx(S,{}),s.jsx(O,{})]}),A=({params:e})=>s.jsx(m,{roomId:e.boardId,fallback:s.jsx(C,{}),children:s.jsx(u,{boardId:e.boardId})})},92121:(e,t,n)=>{"use strict";n.d(t,{EU:()=>eF,I6:()=>eV,Pz:()=>eo,VB:()=>ts,WO:()=>tr,W_:()=>ei,Wy:()=>e8,Xd:()=>tb,YF:()=>tt,Zb:()=>y,as:()=>eP,eI:()=>to,iV:()=>g,iz:()=>e6,l8:()=>p,nn:()=>m,oV:()=>eK,rU:()=>tn,sE:()=>te,x3:()=>tg,yO:()=>P});var r,i,o,s,a,l=Object.defineProperty,d="@liveblocks/core",c="1.10.1",u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:{};function h(e){console.error(e)}function p(e,t,n){let r=Symbol.for(e),i=n?`${t||"dev"} (${n})`:t||"dev";u[r]?u[r]===i||h(`Multiple copies of Liveblocks are being loaded in your project. This will cause issues! See https://liveblocks.io/docs/errors/dupes 

Conflicts:
- ${e} ${u[r]} (already loaded)
- ${e} ${i} (trying to load this now)`):u[r]=i,t&&c&&t!==c&&h(`Cross-linked versions of Liveblocks found, which will cause issues! See https://liveblocks.io/docs/errors/cross-linked 

Conflicts:
- ${d} is at ${c}
- ${e} is at ${t}

Always upgrade all Liveblocks packages to the same version number.`)}function f(e,t){throw Error(t)}function m(e,t="Expected value to be non-nullable"){return e}function y(){let e=new Set,t=new Set,n=null;function r(e){return t.add(e),()=>t.delete(e)}function i(t){return e.add(t),()=>e.delete(t)}async function o(e){let t;return new Promise(n=>{t=r(t=>{(void 0===e||e(t))&&n(t)})}).finally(()=>t?.())}function s(n){e.forEach(e=>e(n)),e.clear(),t.forEach(e=>e(n))}return{notify:function(e){null!==n?n.push(e):s(e)},subscribe:r,subscribeOnce:i,clear:function(){e.clear(),t.clear()},count:function(){return e.size+t.size},waitUntil:o,pause:function(){n=[]},unpause:function(){if(null!==n){for(let e of n)s(e);n=null}},observable:{subscribe:r,subscribeOnce:i,waitUntil:o}}}var g={};((e,t)=>{for(var n in t)l(e,n,{get:t[n],enumerable:!0})})(g,{error:()=>_,errorWithTitle:()=>x,warn:()=>b,warnWithTitle:()=>v});var b=console.warn,_=console.error,v=console.warn,x=console.error,w=class{constructor(e){this.curr=e}get current(){return this.curr}allowPatching(e){let t=this,n=!0;e({...this.curr,patch(e){if(n)for(let n of(t.curr=Object.assign({},t.curr,e),Object.entries(e))){let[e,t]=n;"patch"!==e&&(this[e]=t)}else throw Error("Can no longer patch stale context")}}),n=!1}},E=1,S=class{get initialState(){let e=this.states.values()[Symbol.iterator]().next();if(!e.done)return e.value;throw Error("No states defined yet")}get currentState(){if(null===this.currentStateOrNull){if(0===this.runningState)throw Error("Not started yet");throw Error("Already stopped")}return this.currentStateOrNull}start(){if(0!==this.runningState)throw Error("State machine has already started");return this.runningState=1,this.currentStateOrNull=this.initialState,this.enter(null),this}stop(){if(1!==this.runningState)throw Error("Cannot stop a state machine that hasn't started yet");this.exit(null),this.runningState=2,this.currentStateOrNull=null}constructor(e){this.id=E++,this.runningState=0,this.currentStateOrNull=null,this.states=new Set,this.enterFns=new Map,this.cleanupStack=[],this.knownEventTypes=new Set,this.allowedTransitions=new Map,this.currentContext=new w(e),this.eventHub={didReceiveEvent:y(),willTransition:y(),didIgnoreEvent:y(),willExitState:y(),didEnterState:y()},this.events={didReceiveEvent:this.eventHub.didReceiveEvent.observable,willTransition:this.eventHub.willTransition.observable,didIgnoreEvent:this.eventHub.didIgnoreEvent.observable,willExitState:this.eventHub.willExitState.observable,didEnterState:this.eventHub.didEnterState.observable}}get context(){return this.currentContext.current}addState(e){if(0!==this.runningState)throw Error("Already started");return this.states.add(e),this}onEnter(e,t){if(0!==this.runningState)throw Error("Already started");if(this.enterFns.has(e))throw Error(`enter/exit function for ${e} already exists`);return this.enterFns.set(e,t),this}onEnterAsync(e,t,n,r){return this.onEnter(e,()=>{let e=new AbortController,i=e.signal,o=!1;return t(this.currentContext.current,i).then(e=>{i.aborted||(o=!0,this.transition({type:"ASYNC_OK",data:e},n))},e=>{i.aborted||(o=!0,this.transition({type:"ASYNC_ERROR",reason:e},r))}),()=>{o||e.abort()}})}getStatesMatching(e){let t=[];if("*"===e)for(let e of this.states)t.push(e);else if(e.endsWith(".*")){let n=e.slice(0,-1);for(let e of this.states)e.startsWith(n)&&t.push(e)}else this.states.has(e)&&t.push(e);if(0===t.length)throw Error(`No states match ${JSON.stringify(e)}`);return t}addTransitions(e,t){if(0!==this.runningState)throw Error("Already started");for(let n of this.getStatesMatching(e)){let r=this.allowedTransitions.get(n);for(let[i,o]of(void 0===r&&(r=new Map,this.allowedTransitions.set(n,r)),Object.entries(t))){if(r.has(i))throw Error(`Trying to set transition "${i}" on "${n}" (via "${e}"), but a transition already exists there.`);let t=o;if(this.knownEventTypes.add(i),void 0!==t){let e="function"==typeof t?t:()=>t;r.set(i,e)}}}return this}addTimedTransition(e,t,n){return this.onEnter(e,()=>{let e=setTimeout(()=>{this.transition({type:"TIMER"},n)},"function"==typeof t?t(this.currentContext.current):t);return()=>{clearTimeout(e)}})}getTargetFn(e){return this.allowedTransitions.get(this.currentState)?.get(e)}exit(e){this.eventHub.willExitState.notify(this.currentState),this.currentContext.allowPatching(t=>{e=e??this.cleanupStack.length;for(let n=0;n<e;n++)this.cleanupStack.pop()?.(t)})}enter(e){let t=function(e,t){let n=e.split(".");if(t<1||t>n.length+1)throw Error("Invalid number of levels");let r=[];t>n.length&&r.push("*");for(let e=n.length-t+1;e<n.length;e++){let t=n.slice(0,e);t.length>0&&r.push(t.join(".")+".*")}return r.push(e),r}(this.currentState,e??this.currentState.split(".").length+1);this.currentContext.allowPatching(e=>{for(let n of t){let t=this.enterFns.get(n),r=t?.(e);"function"==typeof r?this.cleanupStack.push(r):this.cleanupStack.push(null)}}),this.eventHub.didEnterState.notify(this.currentState)}send(e){if(!this.knownEventTypes.has(e.type))throw Error(`Invalid event ${JSON.stringify(e.type)}`);if(2===this.runningState)return;let t=this.getTargetFn(e.type);if(void 0!==t)return this.transition(e,t);this.eventHub.didIgnoreEvent.notify(e)}transition(e,t){let n,r;this.eventHub.didReceiveEvent.notify(e);let i=this.currentState,o=("function"==typeof t?t:()=>t)(e,this.currentContext.current);if(null===o){this.eventHub.didIgnoreEvent.notify(e);return}if("string"==typeof o?n=o:(n=o.target,r=Array.isArray(o.effect)?o.effect:[o.effect]),!this.states.has(n))throw Error(`Invalid next state name: ${JSON.stringify(n)}`);this.eventHub.willTransition.notify({from:i,to:n});let[s,a]=function(e,t){if(e===t)return[0,0];let n=e.split("."),r=t.split("."),i=Math.min(n.length,r.length),o=0;for(;o<i&&n[o]===r[o];o++);return[n.length-o,r.length-o]}(this.currentState,n);if(s>0&&this.exit(s),this.currentStateOrNull=n,void 0!==r){let t=r;this.currentContext.allowPatching(n=>{for(let r of t)"function"==typeof r?r(n,e):n.patch(r)})}a>0&&this.enter(a)}};function k(e){return null!==e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)}function T(e){return Object.entries(e)}function I(e){try{return JSON.parse(e)}catch(e){return}}function O(e){return JSON.parse(JSON.stringify(e))}function C(e){return e.filter(e=>null!=e)}function A(e){let t={...e};return Object.keys(e).forEach(e=>{void 0===t[e]&&delete t[e]}),t}async function N(e,t,n){let r;return Promise.race([e,new Promise((e,i)=>{r=setTimeout(()=>{i(Error(n))},t)})]).finally(()=>clearTimeout(r))}var P=((r=P||{})[r.UPDATE_PRESENCE=100]="UPDATE_PRESENCE",r[r.USER_JOINED=101]="USER_JOINED",r[r.USER_LEFT=102]="USER_LEFT",r[r.BROADCASTED_EVENT=103]="BROADCASTED_EVENT",r[r.ROOM_STATE=104]="ROOM_STATE",r[r.INITIAL_STORAGE_STATE=200]="INITIAL_STORAGE_STATE",r[r.UPDATE_STORAGE=201]="UPDATE_STORAGE",r[r.REJECT_STORAGE_OP=299]="REJECT_STORAGE_OP",r[r.UPDATE_YDOC=300]="UPDATE_YDOC",r[r.THREAD_CREATED=400]="THREAD_CREATED",r[r.THREAD_METADATA_UPDATED=401]="THREAD_METADATA_UPDATED",r[r.COMMENT_CREATED=402]="COMMENT_CREATED",r[r.COMMENT_EDITED=403]="COMMENT_EDITED",r[r.COMMENT_DELETED=404]="COMMENT_DELETED",r[r.COMMENT_REACTION_ADDED=405]="COMMENT_REACTION_ADDED",r[r.COMMENT_REACTION_REMOVED=406]="COMMENT_REACTION_REMOVED",r),L=((i=L||{})[i.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",i[i.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",i[i.UNEXPECTED_CONDITION=1011]="UNEXPECTED_CONDITION",i[i.TRY_AGAIN_LATER=1013]="TRY_AGAIN_LATER",i[i.INVALID_MESSAGE_FORMAT=4e3]="INVALID_MESSAGE_FORMAT",i[i.NOT_ALLOWED=4001]="NOT_ALLOWED",i[i.MAX_NUMBER_OF_MESSAGES_PER_SECONDS=4002]="MAX_NUMBER_OF_MESSAGES_PER_SECONDS",i[i.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS=4003]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS",i[i.MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP=4004]="MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP",i[i.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM=4005]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM",i[i.KICKED=4100]="KICKED",i[i.TOKEN_EXPIRED=4109]="TOKEN_EXPIRED",i[i.CLOSE_WITHOUT_RETRY=4999]="CLOSE_WITHOUT_RETRY",i);function j(e){return 4999===e||e>=4e3&&e<4100}function R(e){return 1013===e||e>=4200&&e<4300}function D(e){switch(e){case"connecting":return"connecting";case"connected":return"open";case"reconnecting":return"unavailable";case"disconnected":return"failed";default:return"closed"}}function M(e){let t=e.currentState;switch(t){case"@ok.connected":case"@ok.awaiting-pong":return"connected";case"@idle.initial":return"initial";case"@auth.busy":case"@auth.backoff":case"@connecting.busy":case"@connecting.backoff":case"@idle.zombie":return e.context.successCount>0?"reconnecting":"connecting";case"@idle.failed":return"disconnected";default:return f(t,"Unknown state")}}var U=[250,500,1e3,2e3,4e3,8e3,1e4],$=U[0]-1,z=[2e3,3e4,6e4,3e5],K=class extends Error{constructor(e){super(e)}},F=class extends Error{constructor(e,t){super(e),this.code=t}};function q(e,t){return t.find(t=>t>e)??t[t.length-1]}function H(e){e.patch({backoffDelay:q(e.backoffDelay,U)})}function W(e){e.patch({backoffDelay:q(e.backoffDelay,z)})}function B(e){e.patch({successCount:0})}function V(e,t){let n=2===e?_:1===e?b:()=>{};return()=>{n(t)}}function G(e){let t="Connection to Liveblocks websocket server";return n=>{e instanceof Error?b(`${t} could not be established. ${String(e)}`):b(X(e)?`${t} closed prematurely (code: ${e.code}). Retrying in ${n.backoffDelay}ms.`:`${t} could not be established.`)}}function J(e){return t=>{b(`Connection to Liveblocks websocket server closed (code: ${e.code}). Retrying in ${t.backoffDelay}ms.`)}}var Y=V(1,"Connection to WebSocket closed permanently. Won't retry.");function X(e){return!(e instanceof Error)&&"close"===e.type}var Z=e=>t=>t.patch(e),Q=class{constructor(e,t=!1,n=!0){let{machine:r,events:i,cleanups:o}=function(e,t){let n=y();n.pause();let r=y();function i(e,t){return()=>{let n=new F(e,t);r.notify(n)}}let o=new S({successCount:0,authValue:null,socket:null,backoffDelay:$}).addState("@idle.initial").addState("@idle.failed").addState("@idle.zombie").addState("@auth.busy").addState("@auth.backoff").addState("@connecting.busy").addState("@connecting.backoff").addState("@ok.connected").addState("@ok.awaiting-pong");o.addTransitions("*",{RECONNECT:{target:"@auth.backoff",effect:[H,B]},DISCONNECT:"@idle.initial"}),o.onEnter("@idle.*",B).addTransitions("@idle.*",{CONNECT:(e,t)=>null!==t.authValue?"@connecting.busy":"@auth.busy"}),o.addTransitions("@auth.backoff",{NAVIGATOR_ONLINE:{target:"@auth.busy",effect:Z({backoffDelay:$})}}).addTimedTransition("@auth.backoff",e=>e.backoffDelay,"@auth.busy").onEnterAsync("@auth.busy",()=>N(e.authenticate(),1e4,"Timed out during auth"),e=>({target:"@connecting.busy",effect:Z({authValue:e.data})}),e=>e.reason instanceof K?{target:"@idle.failed",effect:[V(2,e.reason.message),i(e.reason.message,-1)]}:{target:"@auth.backoff",effect:[H,V(2,`Authentication failed: ${e.reason instanceof Error?e.reason.message:String(e.reason)}`)]});let s=e=>o.send({type:"EXPLICIT_SOCKET_ERROR",event:e}),a=e=>o.send({type:"EXPLICIT_SOCKET_CLOSE",event:e}),l=e=>"pong"===e.data?o.send({type:"PONG"}):n.notify(e);function d(e){e&&(e.removeEventListener("error",s),e.removeEventListener("close",a),e.removeEventListener("message",l),e.close())}o.addTransitions("@connecting.backoff",{NAVIGATOR_ONLINE:{target:"@connecting.busy",effect:Z({backoffDelay:$})}}).addTimedTransition("@connecting.backoff",e=>e.backoffDelay,"@connecting.busy").onEnterAsync("@connecting.busy",async(n,r)=>{let i=null,o=null;return N(new Promise((r,d)=>{if(null===n.authValue)throw Error("No auth authValue");let c=e.createSocket(n.authValue);function u(e){i=e,c.removeEventListener("message",l),d(e)}o=c;let[h,p]=function(){let e;let t=new Promise(t=>{e=t});if(!e)throw Error("Should never happen");return[t,e]}();function f(e){let t=I(e.data);t?.type===104&&p()}t.waitForActorId||p(),c.addEventListener("message",l),t.waitForActorId&&c.addEventListener("message",f),c.addEventListener("error",u),c.addEventListener("close",u),c.addEventListener("open",()=>{c.addEventListener("error",s),c.addEventListener("close",a);let e=()=>{c.removeEventListener("error",u),c.removeEventListener("close",u),c.removeEventListener("message",f)};h.then(()=>{r([c,e])})})}),1e4,"Timed out during websocket connection").then(([e,t])=>{if(t(),r.aborted)throw Error("Aborted");if(i)throw i;return e}).catch(e=>{throw d(o),e})},e=>({target:"@ok.connected",effect:Z({socket:e.data,backoffDelay:$})}),e=>{let t=e.reason;if(t instanceof K)return{target:"@idle.failed",effect:[V(2,t.message),i(t.message,-1)]};if(X(t)){if(4109===t.code)return"@auth.busy";if(R(t.code))return{target:"@connecting.backoff",effect:[W,G(t)]};if(j(t.code))return{target:"@idle.failed",effect:[V(2,t.reason),i(t.reason,t.code)]}}return{target:"@auth.backoff",effect:[H,G(t)]}});let c={target:"@ok.awaiting-pong",effect:e=>{e.socket?.send("ping")}},u=()=>{let t="undefined"!=typeof document?document:void 0;return t?.visibilityState==="hidden"&&e.canZombie()?"@idle.zombie":c};if(o.addTimedTransition("@ok.connected",3e4,u).addTransitions("@ok.connected",{NAVIGATOR_OFFLINE:u,WINDOW_GOT_FOCUS:c}),o.addTransitions("@idle.zombie",{WINDOW_GOT_FOCUS:"@connecting.backoff"}),o.onEnter("@ok.*",e=>{e.patch({successCount:e.successCount+1});let t=setTimeout(n.unpause,0);return e=>{d(e.socket),e.patch({socket:null}),clearTimeout(t),n.pause()}}).addTransitions("@ok.awaiting-pong",{PONG:"@ok.connected"}).addTimedTransition("@ok.awaiting-pong",2e3,{target:"@connecting.busy",effect:V(1,"Received no pong from server, assume implicit connection loss.")}).addTransitions("@ok.*",{EXPLICIT_SOCKET_ERROR:(e,t)=>t.socket?.readyState===1?null:{target:"@connecting.backoff",effect:H},EXPLICIT_SOCKET_CLOSE:e=>{var t;return j(e.event.code)?{target:"@idle.failed",effect:[Y,i(e.event.reason,e.event.code)]}:(t=e.event.code)>=4100&&t<4200?4109===e.event.code?"@auth.busy":{target:"@auth.backoff",effect:[H,J(e.event)]}:R(e.event.code)?{target:"@connecting.backoff",effect:[W,J(e.event)]}:{target:"@connecting.backoff",effect:[H,J(e.event)]}}}),"undefined"!=typeof document){let e="undefined"!=typeof document?document:void 0,t=void 0,n=t??e;o.onEnter("*",r=>{function i(){o.send({type:"NAVIGATOR_OFFLINE"})}function s(){o.send({type:"NAVIGATOR_ONLINE"})}function a(){e?.visibilityState==="visible"&&o.send({type:"WINDOW_GOT_FOCUS"})}return t?.addEventListener("online",s),t?.addEventListener("offline",i),n?.addEventListener("visibilitychange",a),()=>{n?.removeEventListener("visibilitychange",a),t?.removeEventListener("online",s),t?.removeEventListener("offline",i),d(r.socket)}})}let h=[],{statusDidChange:p,didConnect:f,didDisconnect:m,unsubscribe:g}=function(e){let t=y(),n=y(),r=y(),i=null,o=e.events.didEnterState.subscribe(()=>{let o=M(e);o!==i&&t.notify(o),"connected"===i&&"connected"!==o?r.notify():"connected"!==i&&"connected"===o&&n.notify(),i=o});return{statusDidChange:t.observable,didConnect:n.observable,didDisconnect:r.observable,unsubscribe:o}}(o);return h.push(g),t.enableDebugLogging&&h.push(function(e){let t=new Date().getTime();function n(...r){b(`${((new Date().getTime()-t)/1e3).toFixed(2)} [FSM #${e.id}]`,...r)}let r=[e.events.didReceiveEvent.subscribe(e=>n(`Event ${e.type}`)),e.events.willTransition.subscribe(({from:e,to:t})=>n("Transitioning",e,"→",t)),e.events.didIgnoreEvent.subscribe(e=>n("Ignored event",e.type,e,"(current state won't handle it)"))];return()=>{for(let e of r)e()}}(o)),o.start(),{machine:o,cleanups:h,events:{statusDidChange:p,didConnect:f,didDisconnect:m,onMessage:n.observable,onLiveblocksError:r.observable}}}(e,{waitForActorId:n,enableDebugLogging:t});this.machine=r,this.events=i,this.cleanups=o}getLegacyStatus(){return D(this.getStatus())}getStatus(){try{return M(this.machine)}catch{return"initial"}}get authValue(){return this.machine.context.authValue}connect(){this.machine.send({type:"CONNECT"})}reconnect(){this.machine.send({type:"RECONNECT"})}disconnect(){this.machine.send({type:"DISCONNECT"})}destroy(){let e;for(this.machine.stop();e=this.cleanups.pop();)e()}send(e){let t=this.machine.context?.socket;null===t?b("Cannot send: not connected yet",e):1!==t.readyState?b("Cannot send: WebSocket no longer open",e):t.send(e)}_privateSendMachineEvent(e){this.machine.send(e)}};function ee(e){return e.includes("room:write")}function et(e){return e.includes("comments:write")||e.includes("room:write")}function en(e){var t;let n=e.split(".");if(3!==n.length)throw Error("Authentication error: invalid JWT token");let r=I(function(e){try{let t=e.replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch(t){return atob(e)}}(n[1]));if(!(r&&k(t=r)&&("acc"===t.k||"id"===t.k||"sec-legacy"===t.k)))throw Error("Authentication error: expected a valid token but did not get one. Hint: if you are using a callback, ensure the room is passed when creating the token. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientCallback");return{raw:e,parsed:r}}async function er(e,t,n){let r;let i=await e(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){let e=`${(await i.text()).trim()||"reason not provided in auth response"} (${i.status} returned by POST ${t})`;if(401===i.status||403===i.status)throw new K(`Unauthorized: ${e}`);throw Error(`Failed to authenticate: ${e}`)}try{r=await i.json()}catch(e){throw Error(`Expected a JSON response when doing a POST request on "${t}". ${String(e)}`)}if(!k(r)||"string"!=typeof r.token)throw Error(`Expected a JSON response of the form \`{ token: "..." }\` when doing a POST request on "${t}", but got ${JSON.stringify(r)}`);let{token:o}=r;return{token:o}}var ei=Symbol();function eo(e,...t){return"object"!=typeof e||null===e||Array.isArray(e)?JSON.stringify(e,...t):JSON.stringify(Object.keys(e).sort().reduce((t,n)=>(t[n]=e[n],t),{}),...t)}y().observable,Date.now();var es=()=>{},ea=class{constructor(e){this.resolve=es,this.reject=es,this.promise=new Promise(es),this.args=e}},el=class{constructor(e,t){this.queue=[],this.error=!1,this.callback=e,this.size=t?.size??50,this.delay=t?.delay??100}clearDelayTimeout(){void 0!==this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=void 0)}schedule(){this.queue.length===this.size?this.flush():1===this.queue.length&&(this.clearDelayTimeout(),this.delayTimeoutId=setTimeout(()=>void this.flush(),this.delay))}async flush(){if(0===this.queue.length)return;let e=this.queue.splice(0),t=e.map(e=>e.args);try{let n=await this.callback(t);this.error=!1,e.forEach((t,r)=>{let i=n?.[r];i instanceof Error?t.reject(i):void 0!==i?t.resolve(i):Array.isArray(n)?t.reject(Error(`Batch callback must return an array of the same length as the number of calls in the batch. Expected ${e.length}, but got ${n.length}.`)):t.reject(Error("Batch callback must return an array."))})}catch(t){this.error=!0,e.forEach(e=>{e.reject(t)})}}get(...e){let t=this.queue.find(t=>eo(t.args)===eo(e));if(t)return t.promise;let n=new ea(e);return n.promise=new Promise((e,t)=>{n.resolve=e,n.reject=t}),this.queue.push(n),this.schedule(),n.promise}clear(){this.queue=[],this.error=!1,this.clearDelayTimeout()}};function ed(e,t){let n=new el(e,t),r=new Map,i=y();function o(e,t){t?r.set(e,t):r.delete(e),i.notify(t)}async function s(...e){let t=eo(e);if(!r.has(t))try{o(t,{isLoading:!0});let r=await n.get(...e);o(t,{isLoading:!1,data:r})}catch(e){o(t,{isLoading:!1,error:e})}}return{...i,get:s,getState:function(...e){let t=eo(e);return r.get(t)}}}function ec(e){let t=e,n=new Set;return{get:function(){return t},set:function(e){let r=e(t);if(t!==r)for(let e of(t=r,n))e(t)},subscribe:function(e){return n.add(e),e(t),()=>{n.delete(e)}}}}function eu(e){let t=e.editedAt?new Date(e.editedAt):void 0,n=new Date(e.createdAt),r=e.reactions.map(e=>({...e,createdAt:new Date(e.createdAt)}));if(e.body)return{...e,reactions:r,createdAt:n,editedAt:t};{let i=new Date(e.deletedAt);return{...e,reactions:r,createdAt:n,editedAt:t,deletedAt:i}}}function eh(e){let t=e.updatedAt?new Date(e.updatedAt):void 0,n=new Date(e.createdAt),r=e.comments.map(e=>eu(e));return{...e,createdAt:n,updatedAt:t,comments:r}}function ep(e){let t=new Date(e.notifiedAt),n=e.readAt?new Date(e.readAt):null;return{...e,notifiedAt:t,readAt:n}}function ef(e){let t=new Date(e.deletedAt);return{...e,deletedAt:t}}function em(e){let t=new Date(e.deletedAt);return{...e,deletedAt:t}}function ey(e,t,n){let r=new URL(t,e);return void 0!==n&&(r.search=(n instanceof URLSearchParams?n:function(e){let t=new URLSearchParams;for(let[n,r]of Object.entries(e))null!=r&&t.set(n,r.toString());return t}(n)).toString()),r.toString()}var eg=ev(0),eb=ev(1),e_=eg+ev(-1);function ev(e){let t=32+(e<0?95+e:e);if(t<32||t>126)throw Error(`Invalid n value: ${e}`);return String.fromCharCode(t)}function ex(e,t){return void 0!==e&&void 0!==t?function(e,t){if(e<t)return ew(e,t);if(e>t)return ew(t,e);throw Error("Cannot compute value between two equal positions")}(e,t):void 0!==e?function(e){for(let t=0;t<=e.length-1;t++){let n=e.charCodeAt(t);if(!(n>=126))return e.substring(0,t)+String.fromCharCode(n+1)}return e+eb}(e):void 0!==t?function(e){let t=e.length-1;for(let n=0;n<=t;n++){let r=e.charCodeAt(n);if(!(r<=32)){if(n!==t)return e.substring(0,n+1);if(33===r)return e.substring(0,n)+e_;return e.substring(0,n)+String.fromCharCode(r-1)}}return eb}(t):eb}function ew(e,t){let n=0,r=e.length,i=t.length;for(;;){let s=n<r?e.charCodeAt(n):32,a=n<i?t.charCodeAt(n):126;if(s===a){n++;continue}if(a-s!=1){var o;return((o=n)<e.length?e.substring(0,o):e+eg.repeat(o-e.length))+String.fromCharCode(a+s>>1)}{let t=n+1,r=e.substring(0,t);return r.length<t&&(r+=eg.repeat(t-r.length)),r+ew(e.substring(t),"")}}}function eE(e){return!function(e){if(""===e)return!1;let t=e.length-1,n=e.charCodeAt(t);if(n<33||n>126)return!1;for(let n=0;n<t;n++){let t=e.charCodeAt(n);if(t<32||t>126)return!1}return!0}(e)?function(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);t.push(r<32?32:r>126?126:r)}for(;t.length>0&&32===t[t.length-1];)t.length--;return t.length>0?String.fromCharCode(...t):eb}(e):e}var eS=((o=eS||{})[o.INIT=0]="INIT",o[o.SET_PARENT_KEY=1]="SET_PARENT_KEY",o[o.CREATE_LIST=2]="CREATE_LIST",o[o.UPDATE_OBJECT=3]="UPDATE_OBJECT",o[o.CREATE_OBJECT=4]="CREATE_OBJECT",o[o.DELETE_CRDT=5]="DELETE_CRDT",o[o.DELETE_OBJECT_KEY=6]="DELETE_OBJECT_KEY",o[o.CREATE_MAP=7]="CREATE_MAP",o[o.CREATE_REGISTER=8]="CREATE_REGISTER",o);function ek(e,t,n=eE(t)){return Object.freeze({type:"HasParent",node:e,key:t,pos:n})}var eT=Object.freeze({type:"NoParent"}),eI=class{constructor(){this._parent=eT}_getParentKeyOrThrow(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldKey;default:return f(this.parent,"Unknown state")}}get _parentPos(){switch(this.parent.type){case"HasParent":return this.parent.pos;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldPos;default:return f(this.parent,"Unknown state")}}get _pool(){return this.__pool}get roomId(){return this.__pool?this.__pool.roomId:null}get _id(){return this.__id}get parent(){return this._parent}get _parentKey(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":return null;case"Orphaned":return this.parent.oldKey;default:return f(this.parent,"Unknown state")}}_apply(e,t){return 5===e.type&&"HasParent"===this.parent.type?this.parent.node._detachChild(this):{modified:!1}}_setParentLink(e,t){switch(this.parent.type){case"HasParent":if(this.parent.node!==e)throw Error("Cannot set parent: node already has a parent");this._parent=ek(e,t);return;case"Orphaned":case"NoParent":this._parent=ek(e,t);return;default:return f(this.parent,"Unknown state")}}_attach(e,t){if(this.__id||this.__pool)throw Error("Cannot attach node: already attached");t.addNode(e,this),this.__id=e,this.__pool=t}_detach(){switch(this.__pool&&this.__id&&this.__pool.deleteNode(this.__id),this.parent.type){case"HasParent":this._parent=function(e,t=eE(e)){return Object.freeze({type:"Orphaned",oldKey:e,oldPos:t})}(this.parent.key,this.parent.pos);break;case"NoParent":this._parent=eT;break;case"Orphaned":break;default:f(this.parent,"Unknown state")}this.__pool=void 0}invalidate(){(void 0!==this._cachedImmutable||void 0!==this._cachedTreeNode)&&(this._cachedImmutable=void 0,this._cachedTreeNode=void 0,"HasParent"===this.parent.type&&this.parent.node.invalidate())}toTreeNode(e){return(void 0===this._cachedTreeNode||this._cachedTreeNodeKey!==e)&&(this._cachedTreeNodeKey=e,this._cachedTreeNode=this._toTreeNode(e)),this._cachedTreeNode}toImmutable(){return void 0===this._cachedImmutable&&(this._cachedImmutable=this._toImmutable()),this._cachedImmutable}},eO=((s=eO||{})[s.OBJECT=0]="OBJECT",s[s.LIST=1]="LIST",s[s.MAP=2]="MAP",s[s.REGISTER=3]="REGISTER",s);function eC(e=7){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789,./;[]~!@#$%&*()_+=-",n=t.length;return Array.from({length:e},()=>t.charAt(Math.floor(Math.random()*n))).join("")}var eA=class e extends eI{constructor(e){super(),this._data=e}get data(){return this._data}static _deserialize([t,n],r,i){let o=new e(n.data);return o._attach(t,i),o}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize register if parentId or parentKey is undefined");return[{type:8,opId:n?.generateOpId(),id:this._id,parentId:e,parentKey:t,data:this.data}]}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveRegister if parent is missing");return{type:3,parentId:m(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key,data:this.data}}_attachChild(e){throw Error("Method not implemented.")}_detachChild(e){throw Error("Method not implemented.")}_apply(e,t){return super._apply(e,t)}_toTreeNode(e){return{type:"Json",id:this._id??eC(),key:e,payload:this._data}}_toImmutable(){return this._data}clone(){return O(this.data)}};function eN(e,t){let n=e._parentPos,r=t._parentPos;return n===r?0:n<r?-1:1}var eP=class e extends eI{constructor(e=[]){let t;for(let n of(super(),this._items=[],this._implicitlyDeletedItems=new WeakSet,this._unacknowledgedSets=new Map,e)){let e=ex(t),r=eY(n);r._setParentLink(this,e),this._items.push(r),t=e}}static _deserialize([t],n,r){let i=new e;i._attach(t,r);let o=n.get(t);if(void 0===o)return i;for(let[e,t]of o){let o=eW([e,t],n,r);o._setParentLink(i,t.parentKey),i._insertAndSort(o)}return i}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let r=[],i={id:this._id,opId:n?.generateOpId(),type:2,parentId:e,parentKey:t};for(let e of(r.push(i),this._items)){let t=e._getParentKeyOrThrow(),i=e$(e._toOps(this._id,t,n),void 0),o=i[0].opId;void 0!==o&&this._unacknowledgedSets.set(t,o),r.push(...i)}return r}_insertAndSort(e){this._items.push(e),this._sortItems()}_sortItems(){this._items.sort(eN),this.invalidate()}_indexOfPosition(e){return this._items.findIndex(t=>t._getParentKeyOrThrow()===e)}_attach(e,t){for(let n of(super._attach(e,t),this._items))n._attach(t.generateId(),t)}_detach(){for(let e of(super._detach(),this._items))e._detach()}_applySetRemote(e){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:t,parentKey:n}=e,r=eq(e);r._attach(t,this._pool),r._setParentLink(this,n);let i=e.deletedId,o=this._indexOfPosition(n);if(-1!==o){let t=this._items[o];if(t._id===i)return t._detach(),this._items[o]=r,{modified:ej(this,[eR(o,r)]),reverse:[]};{this._implicitlyDeletedItems.add(t),this._items[o]=r;let n=[eR(o,r)],i=this._detachItemAssociatedToSetOperation(e.deletedId);return i&&n.push(i),{modified:ej(this,n),reverse:[]}}}{let t=[],i=this._detachItemAssociatedToSetOperation(e.deletedId);return i&&t.push(i),this._insertAndSort(r),t.push(eM(this._indexOfPosition(n),r)),{reverse:[],modified:ej(this,t)}}}_applySetAck(e){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let t=[],n=this._detachItemAssociatedToSetOperation(e.deletedId);n&&t.push(n);let r=this._unacknowledgedSets.get(e.parentKey);if(void 0!==r){if(r!==e.opId)return 0===t.length?{modified:!1}:{modified:ej(this,t),reverse:[]};this._unacknowledgedSets.delete(e.parentKey)}let i=this._indexOfPosition(e.parentKey),o=this._items.find(t=>t._id===e.id);if(void 0!==o){if(o._parentKey===e.parentKey)return{modified:t.length>0&&ej(this,t),reverse:[]};-1!==i&&(this._implicitlyDeletedItems.add(this._items[i]),this._items.splice(i,1),t.push(eD(i)));let n=this._items.indexOf(o);o._setParentLink(this,e.parentKey),this._sortItems();let r=this._items.indexOf(o);return r!==n&&t.push(eU(n,r,o)),{modified:t.length>0&&ej(this,t),reverse:[]}}{let n=this._pool.getNode(e.id);if(n&&this._implicitlyDeletedItems.has(n)){n._setParentLink(this,e.parentKey),this._implicitlyDeletedItems.delete(n),this._insertAndSort(n);let r=this._items.indexOf(n);return{modified:ej(this,[-1===i?eM(r,n):eR(r,n),...t]),reverse:[]}}{-1!==i&&this._items.splice(i,1);let{newItem:n,newIndex:r}=this._createAttachItemAndSort(e,e.parentKey);return{modified:ej(this,[-1===i?eM(r,n):eR(r,n),...t]),reverse:[]}}}}_detachItemAssociatedToSetOperation(e){if(void 0===e||void 0===this._pool)return null;let t=this._pool.getNode(e);if(void 0===t)return null;let n=this._detachChild(t);return!1===n.modified?null:n.modified.updates[0]}_applyRemoteInsert(e){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let t=eE(e.parentKey),n=this._indexOfPosition(t);-1!==n&&this._shiftItemPosition(n,t);let{newItem:r,newIndex:i}=this._createAttachItemAndSort(e,t);return{modified:ej(this,[eM(i,r)]),reverse:[]}}_applyInsertAck(e){let t=this._items.find(t=>t._id===e.id),n=eE(e.parentKey),r=this._indexOfPosition(n);if(t){if(t._parentKey===n)return{modified:!1};{let e=this._items.indexOf(t);-1!==r&&this._shiftItemPosition(r,n),t._setParentLink(this,n),this._sortItems();let i=this._indexOfPosition(n);return i===e?{modified:!1}:{modified:ej(this,[eU(e,i,t)]),reverse:[]}}}{let t=m(this._pool).getNode(e.id);if(t&&this._implicitlyDeletedItems.has(t))return t._setParentLink(this,n),this._implicitlyDeletedItems.delete(t),this._insertAndSort(t),{modified:ej(this,[eM(this._indexOfPosition(n),t)]),reverse:[]};{-1!==r&&this._shiftItemPosition(r,n);let{newItem:t,newIndex:i}=this._createAttachItemAndSort(e,n);return{modified:ej(this,[eM(i,t)]),reverse:[]}}}}_applyInsertUndoRedo(e){let{id:t,parentKey:n}=e,r=eq(e);if(this._pool?.getNode(t)!==void 0)return{modified:!1};r._attach(t,m(this._pool)),r._setParentLink(this,n);let i=this._indexOfPosition(n),o=n;return -1!==i&&(o=ex(this._items[i]?._parentPos,this._items[i+1]?._parentPos),r._setParentLink(this,o)),this._insertAndSort(r),{modified:ej(this,[eM(this._indexOfPosition(o),r)]),reverse:[{type:5,id:t}]}}_applySetUndoRedo(e){let{id:t,parentKey:n}=e,r=eq(e);if(this._pool?.getNode(t)!==void 0)return{modified:!1};this._unacknowledgedSets.set(n,m(e.opId));let i=this._indexOfPosition(n);if(r._attach(t,m(this._pool)),r._setParentLink(this,n),-1===i)return this._insertAndSort(r),this._detachItemAssociatedToSetOperation(e.deletedId),{reverse:[{type:5,id:t}],modified:ej(this,[eM(this._indexOfPosition(n),r)])};{let t=this._items[i];t._detach(),this._items[i]=r;let o=e$(t._toOps(m(this._id),n,this._pool),e.id),s=[eR(i,r)],a=this._detachItemAssociatedToSetOperation(e.deletedId);return a&&s.push(a),{modified:ej(this,s),reverse:o}}}_attachChild(e,t){let n;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");return!1!==(n="set"===e.intent?1===t?this._applySetRemote(e):2===t?this._applySetAck(e):this._applySetUndoRedo(e):1===t?this._applyRemoteInsert(e):2===t?this._applyInsertAck(e):this._applyInsertUndoRedo(e)).modified&&this.invalidate(),n}_detachChild(e){if(e){let t=m(e._parentKey),n=e._toOps(m(this._id),t,this._pool),r=this._items.indexOf(e);return -1===r?{modified:!1}:(this._items.splice(r,1),this.invalidate(),e._detach(),{modified:ej(this,[eD(r)]),reverse:n})}return{modified:!1}}_applySetChildKeyRemote(e,t){if(this._implicitlyDeletedItems.has(t))return this._implicitlyDeletedItems.delete(t),t._setParentLink(this,e),this._insertAndSort(t),{modified:ej(this,[eM(this._items.indexOf(t),t)]),reverse:[]};if(e===t._parentKey)return{modified:!1};let n=this._indexOfPosition(e);if(-1===n){let n=this._items.indexOf(t);t._setParentLink(this,e),this._sortItems();let r=this._items.indexOf(t);return r===n?{modified:!1}:{modified:ej(this,[eU(n,r,t)]),reverse:[]}}{this._items[n]._setParentLink(this,ex(e,this._items[n+1]?._parentPos));let r=this._items.indexOf(t);t._setParentLink(this,e),this._sortItems();let i=this._items.indexOf(t);return i===r?{modified:!1}:{modified:ej(this,[eU(r,i,t)]),reverse:[]}}}_applySetChildKeyAck(e,t){let n=m(t._parentKey);if(this._implicitlyDeletedItems.has(t)){let n=this._indexOfPosition(e);return this._implicitlyDeletedItems.delete(t),-1!==n&&this._items[n]._setParentLink(this,ex(e,this._items[n+1]?._parentPos)),t._setParentLink(this,e),this._insertAndSort(t),{modified:!1}}{if(e===n)return{modified:!1};let r=this._items.indexOf(t),i=this._indexOfPosition(e);-1!==i&&this._items[i]._setParentLink(this,ex(e,this._items[i+1]?._parentPos)),t._setParentLink(this,e),this._sortItems();let o=this._items.indexOf(t);return r===o?{modified:!1}:{modified:ej(this,[eU(r,o,t)]),reverse:[]}}}_applySetChildKeyUndoRedo(e,t){let n=m(t._parentKey),r=this._items.indexOf(t),i=this._indexOfPosition(e);-1!==i&&this._items[i]._setParentLink(this,ex(e,this._items[i+1]?._parentPos)),t._setParentLink(this,e),this._sortItems();let o=this._items.indexOf(t);return r===o?{modified:!1}:{modified:ej(this,[eU(r,o,t)]),reverse:[{type:1,id:m(t._id),parentKey:n}]}}_setChildKey(e,t,n){return 1===n?this._applySetChildKeyRemote(e,t):2===n?this._applySetChildKeyAck(e,t):this._applySetChildKeyUndoRedo(e,t)}_apply(e,t){return super._apply(e,t)}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveList if parent is missing");return{type:1,parentId:m(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get length(){return this._items.length}push(e){return this._pool?.assertStorageIsWritable(),this.insert(e,this.length)}insert(e,t){if(this._pool?.assertStorageIsWritable(),t<0||t>this._items.length)throw Error(`Cannot insert list item at index "${t}". index should be between 0 and ${this._items.length}`);let n=ex(this._items[t-1]?this._items[t-1]._parentPos:void 0,this._items[t]?this._items[t]._parentPos:void 0),r=eY(e);if(r._setParentLink(this,n),this._insertAndSort(r),this._pool&&this._id){let e=this._pool.generateId();r._attach(e,this._pool),this._pool.dispatch(r._toOps(this._id,n,this._pool),[{type:5,id:e}],new Map([[this._id,ej(this,[eM(t,r)])]]))}}move(e,t){if(this._pool?.assertStorageIsWritable(),t<0)throw Error("targetIndex cannot be less than 0");if(t>=this._items.length)throw Error("targetIndex cannot be greater or equal than the list length");if(e<0)throw Error("index cannot be less than 0");if(e>=this._items.length)throw Error("index cannot be greater or equal than the list length");let n=null,r=null;e<t?(r=t===this._items.length-1?void 0:this._items[t+1]._parentPos,n=this._items[t]._parentPos):(r=this._items[t]._parentPos,n=0===t?void 0:this._items[t-1]._parentPos);let i=ex(n,r),o=this._items[e],s=o._getParentKeyOrThrow();if(o._setParentLink(this,i),this._sortItems(),this._pool&&this._id){let n=new Map([[this._id,ej(this,[eU(e,t,o)])]]);this._pool.dispatch([{type:1,id:m(o._id),opId:this._pool.generateOpId(),parentKey:i}],[{type:1,id:m(o._id),parentKey:s}],n)}}delete(e){if(this._pool?.assertStorageIsWritable(),e<0||e>=this._items.length)throw Error(`Cannot delete list item at index "${e}". index should be between 0 and ${this._items.length-1}`);let t=this._items[e];if(t._detach(),this._items.splice(e,1),this.invalidate(),this._pool){let n=t._id;if(n){let r=new Map;r.set(m(this._id),ej(this,[eD(e)])),this._pool.dispatch([{id:n,opId:this._pool.generateOpId(),type:5}],t._toOps(m(this._id),t._getParentKeyOrThrow()),r)}}}clear(){if(this._pool?.assertStorageIsWritable(),this._pool){let e=[],t=[],n=[];for(let r of this._items){r._detach();let i=r._id;i&&(e.push({type:5,id:i,opId:this._pool.generateOpId()}),t.push(...r._toOps(m(this._id),r._getParentKeyOrThrow())),n.push(eD(0)))}this._items=[],this.invalidate();let r=new Map;r.set(m(this._id),ej(this,n)),this._pool.dispatch(e,t,r)}else{for(let e of this._items)e._detach();this._items=[],this.invalidate()}}set(e,t){if(this._pool?.assertStorageIsWritable(),e<0||e>=this._items.length)throw Error(`Cannot set list item at index "${e}". index should be between 0 and ${this._items.length-1}`);let n=this._items[e],r=n._getParentKeyOrThrow(),i=n._id;n._detach();let o=eY(t);if(o._setParentLink(this,r),this._items[e]=o,this.invalidate(),this._pool&&this._id){let t=this._pool.generateId();o._attach(t,this._pool);let s=new Map;s.set(this._id,ej(this,[eR(e,o)]));let a=e$(o._toOps(this._id,r,this._pool),i);this._unacknowledgedSets.set(r,m(a[0].opId));let l=e$(n._toOps(this._id,r,void 0),t);this._pool.dispatch(a,l,s)}}toArray(){return this._items.map(e=>eJ(e))}every(e){return this.toArray().every(e)}filter(e){return this.toArray().filter(e)}find(e){return this.toArray().find(e)}findIndex(e){return this.toArray().findIndex(e)}forEach(e){return this.toArray().forEach(e)}get(e){if(!(e<0)&&!(e>=this._items.length))return eJ(this._items[e])}indexOf(e,t){return this.toArray().indexOf(e,t)}lastIndexOf(e,t){return this.toArray().lastIndexOf(e,t)}map(e){return this._items.map((t,n)=>e(eJ(t),n))}some(e){return this.toArray().some(e)}[Symbol.iterator](){return new eL(this._items)}_createAttachItemAndSort(e,t){let n=eq(e);return n._attach(e.id,m(this._pool)),n._setParentLink(this,t),this._insertAndSort(n),{newItem:n,newIndex:this._indexOfPosition(t)}}_shiftItemPosition(e,t){let n=ex(t,this._items.length>e+1?this._items[e+1]?._parentPos:void 0);this._items[e]._setParentLink(this,n)}_toTreeNode(e){return{type:"LiveList",id:this._id??eC(),key:e,payload:this._items.map((e,t)=>e.toTreeNode(t.toString()))}}toImmutable(){return super.toImmutable()}_toImmutable(){return this._items.map(e=>e.toImmutable())}clone(){return new e(this._items.map(e=>e.clone()))}},eL=class{constructor(e){this._innerIterator=e[Symbol.iterator]()}[Symbol.iterator](){return this}next(){let e=this._innerIterator.next();return e.done?{done:!0,value:void 0}:{value:eJ(e.value)}}};function ej(e,t){return{node:e,type:"LiveList",updates:t}}function eR(e,t){return{index:e,type:"set",item:t instanceof eA?t.data:t}}function eD(e){return{index:e,type:"delete"}}function eM(e,t){return{index:e,type:"insert",item:t instanceof eA?t.data:t}}function eU(e,t,n){return{index:t,type:"move",previousIndex:e,item:n instanceof eA?n.data:n}}function e$(e,t){return e.map((e,n)=>0===n?{...e,intent:"set",deletedId:t}:e)}var ez=e=>e,eK=class e extends eI{constructor(e){if(super(),this.unacknowledgedSet=new Map,e){let t=[];for(let[n,r]of e){let e=eY(r);e._setParentLink(this,n),t.push([n,e])}this._map=new Map(t)}else this._map=new Map}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let r=[],i={id:this._id,opId:n?.generateOpId(),type:7,parentId:e,parentKey:t};for(let[e,t]of(r.push(i),this._map))r.push(...t._toOps(this._id,e,n));return r}static _deserialize([t,n],r,i){let o=new e;o._attach(t,i);let s=r.get(t);if(void 0===s)return o;for(let[e,t]of s){let n=eW([e,t],r,i);n._setParentLink(o,t.parentKey),o._map.set(t.parentKey,n),o.invalidate()}return o}_attach(e,t){for(let[n,r]of(super._attach(e,t),this._map))eV(r)&&r._attach(t.generateId(),t)}_attachChild(e,t){let n;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:r,parentKey:i,opId:o}=e,s=eq(e);if(void 0!==this._pool.getNode(r))return{modified:!1};if(2===t){let e=this.unacknowledgedSet.get(i);if(e===o)return this.unacknowledgedSet.delete(i),{modified:!1};if(void 0!==e)return{modified:!1}}else 1===t&&this.unacknowledgedSet.delete(i);let a=this._map.get(i);if(a){let e=m(this._id);n=a._toOps(e,i),a._detach()}else n=[{type:5,id:r}];return s._setParentLink(this,i),s._attach(r,this._pool),this._map.set(i,s),this.invalidate(),{modified:{node:this,type:"LiveMap",updates:{[i]:{type:"update"}}},reverse:n}}_detach(){for(let e of(super._detach(),this._map.values()))e._detach()}_detachChild(e){let t=m(this._id),n=m(e._parentKey),r=e._toOps(t,n,this._pool);for(let[t,n]of this._map)n===e&&(this._map.delete(t),this.invalidate());return e._detach(),{modified:{node:this,type:"LiveMap",updates:{[n]:{type:"delete"}}},reverse:r}}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveMap if parent is missing");return{type:2,parentId:m(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get(e){let t=this._map.get(e);if(void 0!==t)return eJ(t)}set(e,t){this._pool?.assertStorageIsWritable();let n=this._map.get(e);n&&n._detach();let r=eY(t);if(r._setParentLink(this,e),this._map.set(e,r),this.invalidate(),this._pool&&this._id){let t=this._pool.generateId();r._attach(t,this._pool);let i=new Map;i.set(this._id,{node:this,type:"LiveMap",updates:{[e]:{type:"update"}}});let o=r._toOps(this._id,e,this._pool);this.unacknowledgedSet.set(e,m(o[0].opId)),this._pool.dispatch(r._toOps(this._id,e,this._pool),n?n._toOps(this._id,e):[{type:5,id:t}],i)}}get size(){return this._map.size}has(e){return this._map.has(e)}delete(e){this._pool?.assertStorageIsWritable();let t=this._map.get(e);if(void 0===t)return!1;if(t._detach(),this._map.delete(e),this.invalidate(),this._pool&&t._id){let n=m(this._id),r=new Map;r.set(n,{node:this,type:"LiveMap",updates:{[e]:{type:"delete"}}}),this._pool.dispatch([{type:5,id:t._id,opId:this._pool.generateOpId()}],t._toOps(n,e),r)}return!0}entries(){let e=this._map.entries();return{[Symbol.iterator](){return this},next(){let t=e.next();return t.done?{done:!0,value:void 0}:{value:[t.value[0],eJ(t.value[1])]}}}}[Symbol.iterator](){return this.entries()}keys(){return this._map.keys()}values(){let e=this._map.values();return{[Symbol.iterator](){return this},next(){let t=e.next();return t.done?{done:!0,value:void 0}:{value:eJ(t.value)}}}}forEach(e){for(let t of this)e(t[1],t[0],this)}_toTreeNode(e){return{type:"LiveMap",id:this._id??eC(),key:e,payload:Array.from(this._map.entries()).map(([e,t])=>t.toTreeNode(e))}}toImmutable(){return super.toImmutable()}_toImmutable(){let e=new Map;for(let[t,n]of this._map)e.set(t,n.toImmutable());return ez(e)}clone(){return new e(Array.from(this._map).map(([e,t])=>[e,t.clone()]))}},eF=class e extends eI{constructor(e={}){for(let t in super(),this._propToLastUpdate=new Map,e){let n=e[t];void 0!==n&&eV(n)&&n._setParentLink(this,t)}this._map=new Map(Object.entries(e))}static _buildRootAndParentToChildren(e){let t=new Map,n=null;for(let[r,i]of e)if(0!==i.type||void 0!==i.parentId&&void 0!==i.parentKey){let e=[r,i],n=t.get(i.parentId);void 0!==n?n.push(e):t.set(i.parentId,[e])}else n=[r,i];if(null===n)throw Error("Root can't be null");return[n,t]}static _fromItems(t,n){let[r,i]=e._buildRootAndParentToChildren(t);return e._deserialize(r,i,n)}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let r=n?.generateOpId(),i=[],o={type:4,id:this._id,opId:r,parentId:e,parentKey:t,data:{}};for(let[e,t]of(i.push(o),this._map))eV(t)?i.push(...t._toOps(this._id,e,n)):o.data[e]=t;return i}static _deserialize([t,n],r,i){let o=new e(n.data);return o._attach(t,i),this._deserializeChildren(o,r,i)}static _deserializeChildren(e,t,n){let r=t.get(m(e._id));if(void 0===r)return e;for(let[i,o]of r){let r=function([e,t],n,r){switch(t.type){case 0:return eF._deserialize([e,t],n,r);case 1:return eP._deserialize([e,t],n,r);case 2:return eK._deserialize([e,t],n,r);case 3:return t.data;default:throw Error("Unexpected CRDT type")}}([i,o],t,n);eB(r)&&r._setParentLink(e,o.parentKey),e._map.set(o.parentKey,r),e.invalidate()}return e}_attach(e,t){for(let[n,r]of(super._attach(e,t),this._map))eV(r)&&r._attach(t.generateId(),t)}_attachChild(e,t){let n;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:r,opId:i,parentKey:o}=e,s=eH(e);if(void 0!==this._pool.getNode(r))return this._propToLastUpdate.get(o)===i&&this._propToLastUpdate.delete(o),{modified:!1};if(0===t)this._propToLastUpdate.set(o,m(i));else if(void 0===this._propToLastUpdate.get(o));else if(this._propToLastUpdate.get(o)===i)return this._propToLastUpdate.delete(o),{modified:!1};else return{modified:!1};let a=m(this._id),l=this._map.get(o);return eV(l)?(n=l._toOps(a,o),l._detach()):n=void 0===l?[{type:6,id:a,key:o}]:[{type:3,id:a,data:{[o]:l}}],this._map.set(o,s),this.invalidate(),eB(s)&&(s._setParentLink(this,o),s._attach(r,this._pool)),{reverse:n,modified:{node:this,type:"LiveObject",updates:{[o]:{type:"update"}}}}}_detachChild(e){if(e){let t=m(this._id),n=m(e._parentKey),r=e._toOps(t,n,this._pool);for(let[t,n]of this._map)n===e&&(this._map.delete(t),this.invalidate());return e._detach(),{modified:{node:this,type:"LiveObject",updates:{[n]:{type:"delete"}}},reverse:r}}return{modified:!1}}_detach(){for(let e of(super._detach(),this._map.values()))eV(e)&&e._detach()}_apply(e,t){return 3===e.type?this._applyUpdate(e,t):6===e.type?this._applyDeleteObjectKey(e,t):super._apply(e,t)}_serialize(){let e={};for(let[t,n]of this._map)eV(n)||(e[t]=n);return"HasParent"===this.parent.type&&this.parent.node._id?{type:0,parentId:this.parent.node._id,parentKey:this.parent.key,data:e}:{type:0,data:e}}_applyUpdate(e,t){let n=!1,r=m(this._id),i=[],o={type:3,id:r,data:{}};for(let t in e.data){let e=this._map.get(t);eV(e)?(i.push(...e._toOps(r,t)),e._detach()):void 0!==e?o.data[t]=e:void 0===e&&i.push({type:6,id:r,key:t})}let s={};for(let r in e.data){let i=e.data[r];if(void 0===i)continue;if(t)this._propToLastUpdate.set(r,m(e.opId));else if(void 0===this._propToLastUpdate.get(r))n=!0;else{if(this._propToLastUpdate.get(r)!==e.opId)continue;this._propToLastUpdate.delete(r);continue}let o=this._map.get(r);eV(o)&&o._detach(),n=!0,s[r]={type:"update"},this._map.set(r,i),this.invalidate()}return 0!==Object.keys(o.data).length&&i.unshift(o),n?{modified:{node:this,type:"LiveObject",updates:s},reverse:i}:{modified:!1}}_applyDeleteObjectKey(e,t){let n=e.key;if(!1===this._map.has(n)||!t&&void 0!==this._propToLastUpdate.get(n))return{modified:!1};let r=this._map.get(n),i=m(this._id),o=[];return eV(r)?(o=r._toOps(i,e.key),r._detach()):void 0!==r&&(o=[{type:3,id:i,data:{[n]:r}}]),this._map.delete(n),this.invalidate(),{modified:{node:this,type:"LiveObject",updates:{[e.key]:{type:"delete"}}},reverse:o}}toObject(){return Object.fromEntries(this._map)}set(e,t){this._pool?.assertStorageIsWritable(),this.update({[e]:t})}get(e){return this._map.get(e)}delete(e){let t;this._pool?.assertStorageIsWritable();let n=this._map.get(e);if(void 0===n)return;if(void 0===this._pool||void 0===this._id){eV(n)&&n._detach(),this._map.delete(e),this.invalidate();return}eV(n)?(n._detach(),t=n._toOps(this._id,e)):t=[{type:3,data:{[e]:n},id:this._id}],this._map.delete(e),this.invalidate();let r=new Map;r.set(this._id,{node:this,type:"LiveObject",updates:{[e]:{type:"delete"}}}),this._pool.dispatch([{type:6,key:e,id:this._id,opId:this._pool.generateOpId()}],t,r)}update(e){if(this._pool?.assertStorageIsWritable(),void 0===this._pool||void 0===this._id){for(let t in e){let n=e[t];if(void 0===n)continue;let r=this._map.get(t);eV(r)&&r._detach(),eV(n)&&n._setParentLink(this,t),this._map.set(t,n),this.invalidate()}return}let t=[],n=[],r=this._pool.generateOpId(),i={},o={id:this._id,type:3,data:{}},s={};for(let a in e){let l=e[a];if(void 0===l)continue;let d=this._map.get(a);if(eV(d)?(n.push(...d._toOps(this._id,a)),d._detach()):void 0===d?n.push({type:6,id:this._id,key:a}):o.data[a]=d,eV(l)){l._setParentLink(this,a),l._attach(this._pool.generateId(),this._pool);let e=l._toOps(this._id,a,this._pool),n=e.find(e=>e.parentId===this._id);n&&this._propToLastUpdate.set(a,m(n.opId)),t.push(...e)}else i[a]=l,this._propToLastUpdate.set(a,r);this._map.set(a,l),this.invalidate(),s[a]={type:"update"}}0!==Object.keys(o.data).length&&n.unshift(o),0!==Object.keys(i).length&&t.unshift({opId:r,id:this._id,type:3,data:i});let a=new Map;a.set(this._id,{node:this,type:"LiveObject",updates:s}),this._pool.dispatch(t,n,a)}toImmutable(){return super.toImmutable()}toTreeNode(e){return super.toTreeNode(e)}_toTreeNode(e){let t=this._id??eC();return{type:"LiveObject",id:t,key:e,payload:Array.from(this._map.entries()).map(([e,n])=>eV(n)?n.toTreeNode(e):{type:"Json",id:`${t}:${e}`,key:e,payload:n})}}_toImmutable(){let e={};for(let[t,n]of this._map)e[t]=eB(n)?n.toImmutable():n;return e}clone(){return new e(Object.fromEntries(Array.from(this._map).map(([e,t])=>[e,eB(t)?t.clone():O(t)])))}};function eq(e){return eY(eH(e))}function eH(e){switch(e.type){case 8:return e.data;case 4:return new eF(e.data);case 7:return new eK;case 2:return new eP;default:return f(e,"Unknown creation Op")}}function eW([e,t],n,r){switch(t.type){case 0:return eF._deserialize([e,t],n,r);case 1:return eP._deserialize([e,t],n,r);case 2:return eK._deserialize([e,t],n,r);case 3:return eA._deserialize([e,t],n,r);default:throw Error("Unexpected CRDT type")}}function eB(e){return eG(e)||e instanceof eK||function(e){return e instanceof eF}(e)}function eV(e){return eB(e)||e instanceof eA}function eG(e){return e instanceof eP}function eJ(e){return e instanceof eA?e.data:e instanceof eP||e instanceof eK||e instanceof eF?e:f(e,"Unknown AbstractCrdt")}function eY(e){return e instanceof eF||e instanceof eK||e instanceof eP?e:new eA(e)}function eX(e,t){return void 0===e?t:"LiveObject"===e.type&&"LiveObject"===t.type?function(e,t){let n=e.updates;for(let[e,r]of T(t.updates))n[e]=r;return{...t,updates:n}}(e,t):"LiveMap"===e.type&&"LiveMap"===t.type?function(e,t){let n=e.updates;for(let[e,r]of T(t.updates))n[e]=r;return{...t,updates:n}}(e,t):"LiveList"===e.type&&"LiveList"===t.type?function(e,t){let n=e.updates;return{...t,updates:n.concat(t.updates)}}(e,t):t}function eZ(e){return Array.isArray(e)}var eQ=((a=eQ||{})[a.UPDATE_PRESENCE=100]="UPDATE_PRESENCE",a[a.BROADCAST_EVENT=103]="BROADCAST_EVENT",a[a.FETCH_STORAGE=200]="FETCH_STORAGE",a[a.UPDATE_STORAGE=201]="UPDATE_STORAGE",a[a.FETCH_YDOC=300]="FETCH_YDOC",a[a.UPDATE_YDOC=301]="UPDATE_YDOC",a);function e0(e,t){let n=!1,r={...e};return Object.keys(t).forEach(e=>{let i=t[e];r[e]!==i&&(void 0===i?delete r[e]:r[e]=i,n=!0)}),n?r:e}var e1=class{constructor(){this._ev=y()}get didInvalidate(){return this._ev.observable}invalidate(){void 0!==this._cache&&(this._cache=void 0,this._ev.notify())}get current(){return this._cache??(this._cache=this._toImmutable())}},e2=class extends e1{constructor(){super(),this._connections=new Map,this._presences=new Map,this._users=new Map}connectionIds(){return this._connections.keys()}_toImmutable(){return C(Array.from(this._presences.keys()).map(e=>this.getUser(Number(e))))}clearOthers(){this._connections=new Map,this._presences=new Map,this._users=new Map,this.invalidate()}_getUser(e){let t=this._connections.get(e),n=this._presences.get(e);if(void 0!==t&&void 0!==n)return function(e,t){let{connectionId:n,id:r,info:i}=e,o=ee(e.scopes);return ez(A({connectionId:n,id:r,info:i,canWrite:o,canComment:et(e.scopes),isReadOnly:!o,presence:t}))}(t,n)}getUser(e){let t=this._users.get(e);if(t)return t;let n=this._getUser(e);if(n)return this._users.set(e,n),n}_invalidateUser(e){this._users.has(e)&&this._users.delete(e),this.invalidate()}setConnection(e,t,n,r){this._connections.set(e,ez({connectionId:e,id:t,info:n,scopes:r})),this._presences.has(e)&&this._invalidateUser(e)}removeConnection(e){this._connections.delete(e),this._presences.delete(e),this._invalidateUser(e)}setOther(e,t){this._presences.set(e,ez(A(t))),this._connections.has(e)&&this._invalidateUser(e)}patchOther(e,t){let n=this._presences.get(e);if(void 0===n)return;let r=e0(n,t);n!==r&&(this._presences.set(e,ez(r)),this._invalidateUser(e))}},e4=class extends e1{constructor(e){super(),this._data=ez(A(e))}_toImmutable(){return this._data}patch(e){let t=this._data,n=e0(t,e);t!==n&&(this._data=ez(n),this.invalidate())}},e5=class extends e1{constructor(e){super(),this._value=ez(e)}_toImmutable(){return this._value}set(e){this._value=ez(e),this.invalidate()}},e3=class extends e1{constructor(...e){super();let t=e.pop();this._refs=e,this._refs.forEach(e=>{e.didInvalidate.subscribe(()=>this.invalidate())}),this._transform=t}_toImmutable(){return this._transform(...this._refs.map(e=>e.current))}};function e7(e,t){return{type:"User",id:`${t.connectionId}`,key:e,payload:t}}var e6=class extends Error{constructor(e,t,n){super(e),this.message=e,this.status=t,this.details=n}};function e9(e,t){return e.updatedAt&&t.updatedAt?e.updatedAt>t.updatedAt?1:e.updatedAt<t.updatedAt?-1:0:e.updatedAt||t.updatedAt?e.updatedAt?1:-1:e.createdAt>t.createdAt?1:e.createdAt<t.createdAt?-1:0}function e8(e){let t={threads:{...e.threads},inboxNotifications:{...e.inboxNotifications},notificationSettings:{...e.notificationSettings}};for(let n of e.optimisticUpdates)switch(n.type){case"create-thread":t.threads[n.thread.id]=n.thread;break;case"edit-thread-metadata":{let e=t.threads[n.threadId];if(void 0===e||void 0!==e.deletedAt||void 0!==e.updatedAt&&e.updatedAt>n.updatedAt)break;t.threads[e.id]={...e,updatedAt:n.updatedAt,metadata:{...e.metadata,...n.metadata}};break}case"create-comment":{let e=t.threads[n.comment.threadId];if(void 0===e)break;t.threads[e.id]=te(e,n.comment);let r=Object.values(t.inboxNotifications).find(t=>t.threadId===e.id);if(void 0===r)break;t.inboxNotifications[r.id]={...r,notifiedAt:n.comment.createdAt,readAt:n.comment.createdAt};break}case"edit-comment":{let e=t.threads[n.comment.threadId];if(void 0===e)break;t.threads[e.id]=te(e,n.comment);break}case"delete-comment":{let e=t.threads[n.threadId];if(void 0===e)break;t.threads[e.id]=tt(e,n.commentId,n.deletedAt);break}case"add-reaction":{let e=t.threads[n.threadId];if(void 0===e)break;t.threads[e.id]=tn(e,n.commentId,n.reaction);break}case"remove-reaction":{let e=t.threads[n.threadId];if(void 0===e)break;t.threads[e.id]=tr(e,n.commentId,n.emoji,n.userId,n.removedAt);break}case"mark-inbox-notification-as-read":t.inboxNotifications[n.inboxNotificationId]={...e.inboxNotifications[n.inboxNotificationId],readAt:n.readAt};break;case"mark-inbox-notifications-as-read":for(let e in t.inboxNotifications)t.inboxNotifications[e]={...t.inboxNotifications[e],readAt:n.readAt};break;case"update-notification-settings":t.notificationSettings[n.roomId]={...t.notificationSettings[n.roomId],...n.settings}}return t}function te(e,t){if(void 0!==e.deletedAt)return e;if(t.threadId!==e.id)return b(`Comment ${t.id} does not belong to thread ${e.id}`),e;let n=e.comments.find(e=>e.id===t.id);if(void 0===n){let n=new Date(Math.max(e.updatedAt?.getTime()||0,t.createdAt.getTime()));return{...e,updatedAt:n,comments:[...e.comments,t]}}if(void 0!==n.deletedAt)return e;if(void 0===n.editedAt||void 0===t.editedAt||n.editedAt<=t.editedAt){let n=e.comments.map(e=>e.id===t.id?t:e);return{...e,updatedAt:new Date(Math.max(e.updatedAt?.getTime()||0,t.editedAt?.getTime()||t.createdAt.getTime())),comments:n}}return e}function tt(e,t,n){if(void 0!==e.deletedAt)return e;let r=e.comments.find(e=>e.id===t);if(void 0===r||void 0!==r.deletedAt)return e;let i=e.comments.map(e=>e.id===t?{...e,deletedAt:n,body:void 0}:e);return i.some(e=>void 0===e.deletedAt)?{...e,updatedAt:n,comments:i}:{...e,deletedAt:n,updatedAt:n,comments:[]}}function tn(e,t,n){if(void 0!==e.deletedAt)return e;let r=e.comments.find(e=>e.id===t);if(void 0===r||void 0!==r.deletedAt)return e;let i=e.comments.map(e=>e.id===t?{...e,reactions:function(e,t){let n=e.find(e=>e.emoji===t.emoji);return void 0===n?[...e,{emoji:t.emoji,createdAt:t.createdAt,users:[{id:t.userId}]}]:!1===n.users.some(e=>e.id===t.userId)?e.map(e=>e.emoji===t.emoji?{...e,users:[...e.users,{id:t.userId}]}:e):e}(e.reactions,n)}:e);return{...e,updatedAt:new Date(Math.max(n.createdAt.getTime(),e.updatedAt?.getTime()||0)),comments:i}}function tr(e,t,n,r,i){if(void 0!==e.deletedAt)return e;let o=e.comments.find(e=>e.id===t);if(void 0===o||void 0!==o.deletedAt)return e;let s=e.comments.map(e=>e.id===t?{...e,reactions:e.reactions.map(e=>e.emoji===n?{...e,users:e.users.filter(e=>e.id!==r)}:e).filter(e=>e.users.length>0)}:e);return{...e,updatedAt:new Date(Math.max(i.getTime(),e.updatedAt?.getTime()||0)),comments:s}}function ti(e){return"public"===e.type?e.publicApiKey:e.token.raw}function to(e){var t;let n=ta("throttle",e.throttle??100,16,1e3),r=ta("lostConnectionTimeout",e.lostConnectionTimeout??5e3,200,3e4,1e3),i=function(e){if(void 0!==e)return ta("backgroundKeepAliveTimeout",e,15e3)}(e.backgroundKeepAliveTimeout),o=((t=e.baseUrl)||(t=process.env.LIVEBLOCKS_BASE_URL||process.env.NEXT_PUBLIC_LIVEBLOCKS_BASE_URL||process.env.VITE_LIVEBLOCKS_BASE_URL||void 0),"string"==typeof t&&t.startsWith("http"))?t:"https://api.liveblocks.io",s=function(e){let t=function(e){let{publicApiKey:t,authEndpoint:n}=e;if(void 0!==n&&void 0!==t)throw Error("You cannot simultaneously use `publicApiKey` and `authEndpoint` options. Please pick one and leave the other option unspecified. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient");if("string"==typeof t){if(t.startsWith("sk_"))throw Error("Invalid `publicApiKey` option. The value you passed is a secret key, which should not be used from the client. Please only ever pass a public key here. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");if(!t.startsWith("pk_"))throw Error("Invalid key. Please use the public key format: pk_<public key>. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");return{type:"public",publicApiKey:t}}if("string"==typeof n)return{type:"private",url:n};if("function"==typeof n)return{type:"custom",callback:n};if(void 0!==n)throw Error("The `authEndpoint` option must be a string or a function. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientAuthEndpoint");throw Error("Invalid Liveblocks client options. Please provide either a `publicApiKey` or `authEndpoint` option. They cannot both be empty. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient")}(e),n=new Set,r=[],i=[],o=new Map;function s(e,t){return"comments:read"===e?t.includes("comments:read")||t.includes("comments:write")||t.includes("room:read")||t.includes("room:write"):"room:read"===e&&(t.includes("room:read")||t.includes("room:write"))}async function a(r){let i=e.polyfills?.fetch??void 0;if("private"===t.type){if(void 0===i)throw new K("To use Liveblocks client in a non-DOM environment with a url as auth endpoint, you need to provide a fetch polyfill.");let e=en((await er(i,t.url,{room:r.roomId})).token);if(l(e,r),n.has(e.raw))throw new K("The same Liveblocks auth token was issued from the backend before. Caching Liveblocks tokens is not supported.");return e}if("custom"===t.type){let e=await t.callback(r.roomId);if(e&&"object"==typeof e){if("string"==typeof e.token){let t=en(e.token);return l(t,r),t}if("string"==typeof e.error){let t=`Authentication failed: ${"reason"in e&&"string"==typeof e.reason?e.reason:"Forbidden"}`;if("forbidden"===e.error)throw new K(t);throw Error(t)}}throw Error('Your authentication callback function should return a token, but it did not. Hint: the return value should look like: { token: "..." }')}throw Error("Unexpected authentication type. Must be private or custom.")}function l(e,t){if(!t.roomId&&"acc"===e.parsed.k&&0!==Object.entries(e.parsed.perms).length){for(let[n,r]of Object.entries(e.parsed.perms))if(n.includes("*")&&s(t.requestedScope,r))return;throw new K("The issued access token doesn't grant enough permissions. Please follow the instructions at https://liveblocks.io/docs/errors/liveblocks-client/access-tokens-not-enough-permissions")}}return{reset:function(){n.clear(),r.length=0,i.length=0,o.clear()},getAuthValue:async function(e){let l;if("public"===t.type)return{type:"public",publicApiKey:t.publicApiKey};let d=function(e){let t=Math.ceil(Date.now()/1e3);for(let n=r.length-1;n>=0;n--){let o=r[n];if(i[n]<=t){r.splice(n,1),i.splice(n,1);continue}if("id"===o.parsed.k)return o;if("acc"===o.parsed.k){if(!e.roomId&&0===Object.entries(o.parsed.perms).length)return o;for(let[t,n]of Object.entries(o.parsed.perms))if(e.roomId){if(t.includes("*")&&e.roomId.startsWith(t.replace("*",""))||e.roomId===t&&s(e.requestedScope,n))return o}else if(t.includes("*")&&s(e.requestedScope,n))return o}}}(e);if(void 0!==d)return{type:"secret",token:d};e.roomId?void 0===(l=o.get(e.roomId))&&(l=a(e),o.set(e.roomId,l)):void 0===(l=o.get("liveblocks-user-token"))&&(l=a(e),o.set("liveblocks-user-token",l));try{let e=await l,t=Math.floor(Date.now()/1e3)+(e.parsed.exp-e.parsed.iat)-30;return n.add(e.raw),"sec-legacy"!==e.parsed.k&&(r.push(e),i.push(t)),{type:"secret",token:e}}finally{e.roomId?o.delete(e.roomId):o.delete("liveblocks-user-token")}}}}(e),a=new Map;function l(e){let t=()=>{if(e.unsubs.delete(t)){if(0===e.unsubs.size){var n;(n=e.room).id,a.delete(n.id),n.destroy()}}else b("This leave function was already called. Calling it more than once has no effect.")};return e.unsubs.add(t),{room:e.room,leave:t}}function d(t,d){var u;let h=a.get(t);if(void 0!==h)return l(h);!function(e,t,n=t){}(null===d.initialPresence||d.initialPresence,"Please provide an initial presence value for the current user when entering the room.");let p=function(e,t){let n,r,i;let o="function"==typeof e.initialPresence?e.initialPresence(t.roomId):e.initialPresence,s="function"==typeof e.initialStorage?e.initialStorage(t.roomId):e.initialStorage,[a,l]=function(){let e="undefined"!=typeof document?document:void 0,t={current:null};function n(){e?.visibilityState==="hidden"?t.current=t.current??Date.now():t.current=null}return e?.addEventListener("visibilitychange",n),[t,()=>{e?.removeEventListener("visibilitychange",n)}]}(),d={...t.delegates,canZombie:()=>void 0!==t.backgroundKeepAliveTimeout&&null!==a.current&&Date.now()>a.current+t.backgroundKeepAliveTimeout&&"synchronizing"!==X()},c=new Q(d,t.enableDebugLogging),u={buffer:{flushTimerID:void 0,lastFlushedAt:0,presenceUpdates:{type:"full",data:o},messages:[],storageOperations:[]},staticSessionInfo:new e5(null),dynamicSessionInfo:new e5(null),myPresence:new e4(o),others:new e2,initialStorage:s,idFactory:null,clock:0,opClock:0,nodes:new Map,root:void 0,undoStack:[],redoStack:[],pausedHistory:null,activeBatch:null,unacknowledgedOps:new Map,opStackTraces:void 0},h=e=>e(),p=t.unstable_batchedUpdates??h,g=!1;c.events.onMessage.subscribe(function(e){if("string"!=typeof e.data)return;let t=function(e){let t=I(e);return void 0===t?null:eZ(t)?C(t.map(e=>K(e))):C([K(t)])}(e.data);if(null===t||0===t.length)return;let n={storageUpdates:new Map,others:[]};p(()=>{for(let e of t)switch(e.type){case 101:{let t=function(e){u.others.setConnection(e.actor,e.id,e.info,e.scopes),u.buffer.messages.push({type:100,data:u.myPresence.current,targetActor:e.actor}),F();let t=u.others.getUser(e.actor);return t?{type:"enter",user:t}:void 0}(e);t&&n.others.push(t);break}case 100:{let t=function(e){if(void 0!==e.targetActor){let t=u.others.getUser(e.actor);u.others.setOther(e.actor,e.data);let n=u.others.getUser(e.actor);if(void 0===t&&void 0!==n)return{type:"enter",user:n}}else u.others.patchOther(e.actor,e.data);let t=u.others.getUser(e.actor);return t?{type:"update",updates:e.data,user:t}:void 0}(e);t&&n.others.push(t);break}case 103:{let t=u.others.current;v.customEvent.notify({connectionId:e.actor,user:e.actor<0?null:t.find(t=>t.connectionId===e.actor)??null,event:e.event});break}case 102:{let t=function(e){let t=u.others.getUser(e.actor);return t?(u.others.removeConnection(e.actor),{type:"leave",user:t}):null}(e);t&&n.others.push(t);break}case 300:v.ydoc.notify(e);break;case 104:n.others.push(function(e,t){var n;let r;for(let i of(u.dynamicSessionInfo.set({actor:e.actor,nonce:e.nonce,scopes:e.scopes}),u.idFactory=(n=e.actor,r=0,()=>`${n}:${r++}`),A(t),u.others.connectionIds()))void 0===e.users[i]&&u.others.removeConnection(i);for(let t in e.users){let n=e.users[t],r=Number(t);u.others.setConnection(r,n.id,n.info,n.scopes)}return{type:"reset"}}(e,h));break;case 200:B(e);break;case 201:for(let[t,r]of M(e.ops,!1).updates.storageUpdates)n.storageUpdates.set(t,eX(n.storageUpdates.get(t),r));break;case 299:x("Storage mutation rejection error",e.reason);break;case 400:case 401:case 405:case 406:case 402:case 403:case 404:v.comments.notify(e)}j(n,h)})}),c.events.statusDidChange.subscribe(function(e){let t=c.authValue;if(null!==t){let e=ti(t);if(e!==n){if(n=e,"secret"===t.type){let e=t.token.parsed;u.staticSessionInfo.set({userId:"sec-legacy"===e.k?e.id:e.uid,userInfo:"sec-legacy"===e.k?e.info:e.ui})}else u.staticSessionInfo.set({userId:void 0,userInfo:void 0})}}p(()=>{v.status.notify(e),A(h)})}),c.events.statusDidChange.subscribe(function(e){"reconnecting"===e?r=setTimeout(()=>{p(()=>{v.lostConnection.notify("lost"),g=!0,u.others.clearOthers(),j({others:[{type:"reset"}]},h)})},t.lostConnectionTimeout):(clearTimeout(r),g&&("disconnected"===e?p(()=>{v.lostConnection.notify("failed")}):p(()=>{v.lostConnection.notify("restored")}),g=!1))}),c.events.didConnect.subscribe(function(){u.buffer.presenceUpdates={type:"full",data:{...u.myPresence.current}},null!==H&&G({flush:!1}),F()}),c.events.didDisconnect.subscribe(function(){clearTimeout(u.buffer.flushTimerID)}),c.events.onLiveblocksError.subscribe(e=>{p(()=>{v.error.notify(e)})});let _={roomId:t.roomId,getNode:e=>u.nodes.get(e),addNode:(e,t)=>void u.nodes.set(e,t),deleteNode:e=>void u.nodes.delete(e),generateId:()=>`${R()}:${u.clock++}`,generateOpId:()=>`${R()}:${u.opClock++}`,dispatch(e,t,n){let r=u.activeBatch;if(r){for(let[t,i]of(r.ops.push(...e),n))r.updates.storageUpdates.set(t,eX(r.updates.storageUpdates.get(t),i));r.reverseOps.unshift(...t)}else p(()=>{L(t,h),u.redoStack.length=0,q(e),j({storageUpdates:n},h)})},assertStorageIsWritable:()=>{let e=u.dynamicSessionInfo.current?.scopes;if(void 0!==e&&!ee(e))throw Error("Cannot write to storage with a read only user, please ensure the user has write permissions")}},v={connection:y(),status:y(),lostConnection:y(),customEvent:y(),self:y(),myPresence:y(),others:y(),error:y(),storage:y(),history:y(),storageDidLoad:y(),storageStatus:y(),ydoc:y(),comments:y()};async function w(e,n,r,i,o){let s=ey(t.baseUrl,`/v2/c/rooms/${encodeURIComponent(e)}${n}`,o),a=t.polyfills?.fetch||fetch;return await a(s,{...i,headers:{...i?.headers,Authorization:`Bearer ${ti(r)}`}})}async function E(e,t){return w(t,"/storage",e,{method:"GET",headers:{"Content-Type":"application/json"}})}async function S(e,n){if(!c.authValue)throw Error("Not authorized");return w(t.roomId,e,c.authValue,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}function k(e){let n=JSON.stringify(e),r=u.dynamicSessionInfo.current?.nonce;if(t.unstable_fallbackToHTTP&&r&&new TextEncoder().encode(n).length>1047552){S("/send-message",{nonce:r,messages:e}).then(e=>{e.ok||403!==e.status||c.reconnect()}),b("Message was too large for websockets and sent over HTTP instead");return}c.send(n)}let T=new e3(u.staticSessionInfo,u.dynamicSessionInfo,u.myPresence,(e,t,n)=>{if(null===e||null===t)return null;{let r=ee(t.scopes);return{connectionId:t.actor,id:e.userId,info:e.userInfo,presence:n,canWrite:r,canComment:et(t.scopes),isReadOnly:!r}}});function A(e){let t=T.current;null!==t&&t!==i&&(e(()=>{v.self.notify(t)}),i=t)}let N=new e3(T,e=>null!==e?e7("Me",e):null);function P(e,t){u.undoStack.length>=50&&u.undoStack.shift(),u.undoStack.push(e),z(t)}function L(e,t){null!==u.pausedHistory?u.pausedHistory.unshift(...e):P(e,t)}function j(e,t){let n=e.storageUpdates,r=e.others;t(()=>{if(void 0!==r&&r.length>0){let e=u.others.current;for(let t of r)v.others.notify({...t,others:e})}if(e.presence&&(A(h),v.myPresence.notify(u.myPresence.current)),void 0!==n&&n.size>0){let e=Array.from(n.values());v.storage.notify(e)}en()})}function R(){let e=u.dynamicSessionInfo.current;if(e)return e.actor;throw Error("Internal. Tried to get connection id but connection was never open")}function M(e,t){let n={reverse:[],storageUpdates:new Map,presence:!1},r=new Set,i=e.map(e=>"presence"===e.type||e.opId?e:{...e,opId:_.generateOpId()});for(let e of i)if("presence"===e.type){let t={type:"presence",data:{}};for(let n in e.data)t.data[n]=u.myPresence.current[n];if(u.myPresence.patch(e.data),null===u.buffer.presenceUpdates)u.buffer.presenceUpdates={type:"partial",data:e.data};else for(let t in e.data)u.buffer.presenceUpdates.data[t]=e.data[t];n.reverse.unshift(t),n.presence=!0}else{let i;if(t)i=0;else{let t=m(e.opId);i=u.unacknowledgedOps.delete(t)?2:1}let o=function(e,t){if(5===e.type&&"ACK"===e.id)return{modified:!1};switch(e.type){case 6:case 3:case 5:{let n=u.nodes.get(e.id);if(void 0===n)return{modified:!1};return n._apply(e,0===t)}case 1:{let n=u.nodes.get(e.id);if(void 0===n)return{modified:!1};if("HasParent"===n.parent.type&&eG(n.parent.node))return n.parent.node._setChildKey(eE(e.parentKey),n,t);return{modified:!1}}case 4:case 2:case 7:case 8:{if(void 0===e.parentId)return{modified:!1};let n=u.nodes.get(e.parentId);if(void 0===n)return{modified:!1};return n._attachChild(e,t)}}}(e,i);if(o.modified){let t=o.modified.node._id;t&&r.has(t)||(n.storageUpdates.set(m(o.modified.node._id),eX(n.storageUpdates.get(m(o.modified.node._id)),o.modified)),n.reverse.unshift(...o.reverse)),(2===e.type||7===e.type||4===e.type)&&r.add(m(e.id))}}return{ops:i,reverse:n.reverse,updates:{storageUpdates:n.storageUpdates,presence:n.presence}}}function U(){return u.undoStack.length>0}function $(){return u.redoStack.length>0}function z(e){e(()=>{v.history.notify({canUndo:U(),canRedo:$()})})}function K(e){var t;return null===(t=e)||"string"==typeof t||"number"==typeof t||"boolean"==typeof t||eZ(t)?null:e}function F(){let e=u.buffer.storageOperations;if(e.length>0){for(let t of e)u.unacknowledgedOps.set(m(t.opId),t);en()}if("connected"!==c.getStatus()){u.buffer.storageOperations=[];return}let n=Date.now(),r=n-u.buffer.lastFlushedAt;if(r>=t.throttleDelay){let e=function(){let e=[];for(let t of(u.buffer.presenceUpdates&&e.push("full"===u.buffer.presenceUpdates.type?{type:100,targetActor:-1,data:u.buffer.presenceUpdates.data}:{type:100,data:u.buffer.presenceUpdates.data}),u.buffer.messages))e.push(t);return u.buffer.storageOperations.length>0&&e.push({type:201,ops:u.buffer.storageOperations}),e}();if(0===e.length)return;k(e),u.buffer={flushTimerID:void 0,lastFlushedAt:n,messages:[],storageOperations:[],presenceUpdates:null}}else clearTimeout(u.buffer.flushTimerID),u.buffer.flushTimerID=setTimeout(F,t.throttleDelay-r)}function q(e){u.buffer.storageOperations.push(...e),F()}let H=null,W=null;function B(e){let t=new Map(u.unacknowledgedOps);(function(e,t){if(0===e.items.length)throw Error("Internal error: cannot load storage without items");void 0!==u.root?function(e,t){if(void 0===u.root)return;let n=new Map;for(let[e,t]of u.nodes)n.set(e,t._serialize());j(M(function(e,t){let n=[];return e.forEach((e,r)=>{t.get(r)||n.push({type:5,id:r})}),t.forEach((t,r)=>{let i=e.get(r);if(i)0===t.type&&(0!==i.type||JSON.stringify(t.data)!==JSON.stringify(i.data))&&n.push({type:3,id:r,data:t.data}),t.parentKey!==i.parentKey&&n.push({type:1,id:r,parentKey:m(t.parentKey,"Parent key must not be missing")});else switch(t.type){case 3:n.push({type:8,id:r,parentId:t.parentId,parentKey:t.parentKey,data:t.data});break;case 1:n.push({type:2,id:r,parentId:t.parentId,parentKey:t.parentKey});break;case 0:if(void 0===t.parentId||void 0===t.parentKey)throw Error("Internal error. Cannot serialize storage root into an operation");n.push({type:4,id:r,parentId:t.parentId,parentKey:t.parentKey,data:t.data});break;case 2:n.push({type:7,id:r,parentId:t.parentId,parentKey:t.parentKey})}}),n}(n,new Map(e)),!1).updates,t)}(e.items,t):u.root=eF._fromItems(e.items,_);let n=u.undoStack.length;for(let e in u.initialStorage)if(void 0===u.root.get(e)){var r;u.root.set(e,void 0===(r=u.initialStorage[e])?void 0:eB(r)?r.clone():O(r))}u.undoStack.length=n})(e,h),function(e,t){if(0===e.size)return;let n=[],r=M(Array.from(e.values()),!0);n.push({type:201,ops:r.ops}),j(r.updates,t),k(n)}(t,h),W?.(),en(),v.storageDidLoad.notify()}async function V(){if(!c.authValue)return;let e=await E(c.authValue,t.roomId);B({type:200,items:await e.json()})}function G(e){let n=u.buffer.messages;t.unstable_streamData?V():n.some(e=>200===e.type)||n.push({type:200}),e.flush&&F()}function J(){return null===H&&(G({flush:!0}),H=new Promise(e=>{W=e}),en()),H}async function Y(){return void 0!==u.root?Promise.resolve({root:u.root}):(await J(),{root:m(u.root)})}function X(){return void 0===u.root?null===H?"not-loaded":"loading":0===u.unacknowledgedOps.size?"synchronized":"synchronizing"}let Z=X();function en(){let e=X();Z!==e&&(Z=e,v.storageStatus.notify(e))}let er=new e3(u.others,e=>e.map((e,t)=>e7(`Other ${t}`,e))),eo={status:v.status.observable,lostConnection:v.lostConnection.observable,customEvent:v.customEvent.observable,others:v.others.observable,self:v.self.observable,myPresence:v.myPresence.observable,error:v.error.observable,storage:v.storage.observable,history:v.history.observable,storageDidLoad:v.storageDidLoad.observable,storageStatus:v.storageStatus.observable,ydoc:v.ydoc.observable,comments:v.comments.observable},es=function(e,t,n){async function r(r,i,o){return n(e,r,await t(),o,i)}async function i(e,t,n){let i;let o=await r(e,n,t);if(!o.ok&&o.status>=400&&o.status<600){let e;try{let t=await o.json();e=new e6(t.message,o.status,t)}catch{e=new e6(o.statusText,o.status)}throw e}try{i=await o.json()}catch{i={}}return i}return{getThreads:async function(e){let t=await r("/threads/search",{since:e?.since?.toISOString()},{body:JSON.stringify({...e?.query?.metadata&&{metadata:e.query.metadata}}),headers:{"Content-Type":"application/json"},method:"POST"});if(t.ok){let e=await t.json();return{threads:e.data.map(e=>eh(e)),inboxNotifications:e.inboxNotifications.map(e=>ep(e)),deletedThreads:e.deletedThreads.map(e=>ef(e)),deletedInboxNotifications:e.deletedInboxNotifications.map(e=>em(e)),meta:{requestedAt:new Date(e.meta.requestedAt)}}}if(404===t.status)return{threads:[],inboxNotifications:[],deletedThreads:[],deletedInboxNotifications:[],meta:{requestedAt:new Date}};throw Error("There was an error while getting threads.")},getThread:async function({threadId:e}){let t=await r(`/thread-with-notification/${e}`);if(t.ok){let e=await t.json();return{thread:eh(e.thread),inboxNotification:e.inboxNotification?ep(e.inboxNotification):void 0}}if(404!==t.status)throw Error(`There was an error while getting thread ${e}.`)},createThread:async function({metadata:e,body:t,commentId:n,threadId:r}){return eh(await i("/threads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r,comment:{id:n,body:t},metadata:e})}))},editThreadMetadata:async function({metadata:e,threadId:t}){return await i(`/threads/${encodeURIComponent(t)}/metadata`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})},createComment:async function({threadId:e,commentId:t,body:n}){return eu(await i(`/threads/${encodeURIComponent(e)}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,body:n})}))},editComment:async function({threadId:e,commentId:t,body:n}){return eu(await i(`/threads/${encodeURIComponent(e)}/comments/${encodeURIComponent(t)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({body:n})}))},deleteComment:async function({threadId:e,commentId:t}){await i(`/threads/${encodeURIComponent(e)}/comments/${encodeURIComponent(t)}`,{method:"DELETE"})},addReaction:async function({threadId:e,commentId:t,emoji:n}){var r;return{...r=await i(`/threads/${encodeURIComponent(e)}/comments/${encodeURIComponent(t)}/reactions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:n})}),createdAt:new Date(r.createdAt)}},removeReaction:async function({threadId:e,commentId:t,emoji:n}){await i(`/threads/${encodeURIComponent(e)}/comments/${encodeURIComponent(t)}/reactions/${encodeURIComponent(n)}`,{method:"DELETE"})}}}(t.roomId,d.authenticate,w);async function ea(e,n){let r;let i=await d.authenticate(),o=await w(t.roomId,e,i,n);if(!o.ok&&o.status>=400&&o.status<600){let e;try{let t=await o.json();e=new ts(t.message,o.status,t)}catch{e=new ts(o.statusText,o.status)}throw e}try{r=await o.json()}catch{r={}}return r}async function ed(e){await ea("/inbox-notifications/read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inboxNotificationIds:e})})}let ec=new el(async e=>{let t=e.flat();return await ed(t),t},{delay:50});async function eg(e){await ec.get(e)}return Object.defineProperty({[ei]:{get presenceBuffer(){return O(u.buffer.presenceUpdates?.data??null)},get undoStack(){return O(u.undoStack)},get nodeCount(){return u.nodes.size},getSelf_forDevTools:()=>N.current,getOthers_forDevTools:()=>er.current,simulate:{explicitClose:e=>c._privateSendMachineEvent({type:"EXPLICIT_SOCKET_CLOSE",event:e}),rawSend:e=>c.send(e)},comments:{...es},notifications:{getRoomNotificationSettings:function(){return ea("/notification-settings")},updateRoomNotificationSettings:function(e){return ea("/notification-settings",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})},markInboxNotificationAsRead:eg}},id:t.roomId,subscribe:function(e,t,n){if("string"==typeof e&&("my-presence"===e||"others"===e||"event"===e||"error"===e||"history"===e||"status"===e||"storage-status"===e||"lost-connection"===e||"connection"===e)){if("function"!=typeof t)throw Error("Second argument must be a callback function");switch(e){case"event":return eo.customEvent.subscribe(t);case"my-presence":return eo.myPresence.subscribe(t);case"others":return eo.others.subscribe(e=>{let{others:n,...r}=e;return t(n,r)});case"error":return eo.error.subscribe(t);case"connection":return eo.status.subscribe(e=>t(D(e)));case"status":return eo.status.subscribe(t);case"lost-connection":return eo.lostConnection.subscribe(t);case"history":return eo.history.subscribe(t);case"storage-status":return eo.storageStatus.subscribe(t);default:return f(e,`"${String(e)}" is not a valid event name`)}}if(void 0===t||"function"==typeof e){if("function"==typeof e)return eo.storage.subscribe(e);throw Error("Please specify a listener callback")}if(eV(e))return n?.isDeep?eo.storage.subscribe(n=>{let r=n.filter(t=>(function e(t,n){return t===n||"HasParent"===t.parent.type&&e(t.parent.node,n)})(t.node,e));r.length>0&&t(r)}):eo.storage.subscribe(n=>{for(let r of n)r.node._id===e._id&&t(r.node)});throw Error(`${String(e)} is not a value that can be subscribed to.`)},connect:()=>c.connect(),reconnect:()=>c.reconnect(),disconnect:()=>c.disconnect(),destroy:()=>{l(),c.destroy()},updatePresence:function(e,t){let n={};for(let t in null===u.buffer.presenceUpdates&&(u.buffer.presenceUpdates={type:"partial",data:{}}),e){let r=e[t];void 0!==r&&(u.buffer.presenceUpdates.data[t]=r,n[t]=u.myPresence.current[t])}u.myPresence.patch(e),u.activeBatch?(t?.addToHistory&&u.activeBatch.reverseOps.unshift({type:"presence",data:n}),u.activeBatch.updates.presence=!0):(F(),p(()=>{t?.addToHistory&&L([{type:"presence",data:n}],h),j({presence:!0},h)}))},updateYDoc:function(e,t){let n={type:301,update:e,guid:t};u.buffer.messages.push(n),v.ydoc.notify(n),F()},broadcastEvent:function(e,t={shouldQueueEventIfNotReady:!1}){("connected"===c.getStatus()||t.shouldQueueEventIfNotReady)&&(u.buffer.messages.push({type:103,event:e}),F())},batch:function(e){let t;return u.activeBatch?e():(p(()=>{u.activeBatch={ops:[],updates:{storageUpdates:new Map,presence:!1,others:[]},reverseOps:[]};try{t=e()}finally{let e=u.activeBatch;u.activeBatch=null,e.reverseOps.length>0&&L(e.reverseOps,h),e.ops.length>0&&(u.redoStack.length=0),e.ops.length>0&&q(e.ops),j(e.updates,h),F()}}),t)},history:{undo:function(){if(u.activeBatch)throw Error("undo is not allowed during a batch");let e=u.undoStack.pop();if(void 0===e)return;u.pausedHistory=null;let t=M(e,!0);for(let e of(p(()=>{j(t.updates,h),u.redoStack.push(t.reverse),z(h)}),t.ops))"presence"!==e.type&&u.buffer.storageOperations.push(e);F()},redo:function(){if(u.activeBatch)throw Error("redo is not allowed during a batch");let e=u.redoStack.pop();if(void 0===e)return;u.pausedHistory=null;let t=M(e,!0);for(let e of(p(()=>{j(t.updates,h),u.undoStack.push(t.reverse),z(h)}),t.ops))"presence"!==e.type&&u.buffer.storageOperations.push(e);F()},canUndo:U,canRedo:$,clear:function(){u.undoStack.length=0,u.redoStack.length=0},pause:function(){null===u.pausedHistory&&(u.pausedHistory=[])},resume:function(){let e=u.pausedHistory;u.pausedHistory=null,null!==e&&e.length>0&&P(e,p)}},fetchYDoc:function(e,t){u.buffer.messages.find(n=>300===n.type&&n.vector===e&&n.guid===t)||u.buffer.messages.push({type:300,vector:e,guid:t}),F()},getStorage:Y,getStorageSnapshot:function(){let e=u.root;return void 0!==e?e:(J(),null)},getStorageStatus:X,events:eo,getStatus:()=>c.getStatus(),getConnectionState:()=>c.getLegacyStatus(),getSelf:()=>T.current,getPresence:()=>u.myPresence.current,getOthers:()=>u.others.current},ei,{enumerable:!1})}({initialPresence:d.initialPresence??{},initialStorage:d.initialStorage},{roomId:t,throttleDelay:n,lostConnectionTimeout:r,backgroundKeepAliveTimeout:i,polyfills:e.polyfills,delegates:e.mockedDelegates??{createSocket:(u=e.polyfills?.WebSocket,e=>{let n=u??("undefined"==typeof WebSocket?void 0:WebSocket);if(void 0===n)throw new K("To use Liveblocks client in a non-DOM environment, you need to provide a WebSocket polyfill.");let r=new URL(o);if(r.protocol="http:"===r.protocol?"ws":"wss",r.pathname="/v7",r.searchParams.set("roomId",t),"secret"===e.type)r.searchParams.set("tok",e.token.raw);else{if("public"!==e.type)return f(e,"Unhandled case");r.searchParams.set("pubkey",e.publicApiKey)}return r.searchParams.set("version",c||"dev"),new n(r.toString())}),authenticate:async()=>s.getAuthValue({requestedScope:"room:read",roomId:t})},enableDebugLogging:e.enableDebugLogging,unstable_batchedUpdates:d?.unstable_batchedUpdates,baseUrl:o,unstable_fallbackToHTTP:!!e.unstable_fallbackToHTTP,unstable_streamData:!!e.unstable_streamData}),g={room:p,unsubs:new Set};if(a.set(t,g),d.autoConnect??d.shouldInitiallyConnect??!0){if("undefined"==typeof atob){if(e.polyfills?.atob===void 0)throw Error("You need to polyfill atob to use the client in your environment. Please follow the instructions at https://liveblocks.io/docs/errors/liveblocks-client/atob-polyfill");global.atob=e.polyfills.atob}p.connect()}return l(g)}let u=ec(null),{getInboxNotifications:h,getUnreadInboxNotificationsCount:p,markAllInboxNotificationsAsRead:g,markInboxNotificationAsRead:_}=function({baseUrl:e,authManager:t,currentUserIdStore:n,fetcher:r}){async function i(i,o,s){let a;let l=await t.getAuthValue({requestedScope:"comments:read"});if("secret"===l.type&&"acc"===l.token.parsed.k){let e=l.token.parsed.uid;n.set(()=>e)}let d=ey(e,`/v2/c${i}`,s),c=await r(d.toString(),{...o,headers:{...o?.headers,Authorization:`Bearer ${ti(l)}`}});if(!c.ok&&c.status>=400&&c.status<600){let e;try{let t=await c.json();e=new ts(t.message,c.status,t)}catch{e=new ts(c.statusText,c.status)}throw e}try{a=await c.json()}catch{a={}}return a}async function o(e){let t=await i("/inbox-notifications",void 0,{limit:e?.limit,since:e?.since?.toISOString()});return{threads:t.threads.map(e=>eh(e)),inboxNotifications:t.inboxNotifications.map(e=>ep(e)),deletedThreads:t.deletedThreads.map(e=>ef(e)),deletedInboxNotifications:t.deletedInboxNotifications.map(e=>em(e)),meta:{requestedAt:new Date(t.meta.requestedAt)}}}async function s(){let{count:e}=await i("/inbox-notifications/count");return e}async function a(){await i("/inbox-notifications/read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inboxNotificationIds:"all"})})}async function l(e){await i("/inbox-notifications/read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inboxNotificationIds:e})})}let d=new el(async e=>{let t=e.flat();return await l(t),t},{delay:50});return{getInboxNotifications:o,getUnreadInboxNotificationsCount:s,markAllInboxNotificationsAsRead:a,markInboxNotificationAsRead:async function(e){await d.get(e)}}}({baseUrl:o,fetcher:e.polyfills?.fetch||fetch,authManager:s,currentUserIdStore:u}),v=function(){let e=ec({threads:{},queries:{},optimisticUpdates:[],inboxNotifications:{},notificationSettings:{}});return{...e,deleteThread(t){e.set(e=>({...e,threads:function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let{[t]:n,...r}=e;return r}return e}(e.threads,t),inboxNotifications:Object.fromEntries(Object.entries(e.inboxNotifications).filter(([e,n])=>n.threadId!==t))}))},updateThreadAndNotification(t,n){e.set(e=>{let r=e.threads[t.id];return{...e,threads:void 0===r||1===e9(t,r)?{...e.threads,[t.id]:t}:e.threads,inboxNotifications:void 0===n?e.inboxNotifications:{...e.inboxNotifications,[n.id]:n}}})},updateThreadsAndNotifications(t,n,r,i,o){e.set(e=>({...e,threads:function(e,t){let n={...e};return t.newThreads.forEach(e=>{let t=n[e.id];t&&1===e9(t,e)||(n[e.id]=e)}),t.deletedThreads.forEach(({id:e,deletedAt:t})=>{let r=n[e];void 0!==r&&(r.deletedAt=t,r.updatedAt=t,r.comments=[])}),n}(e.threads,{newThreads:t,deletedThreads:r}),inboxNotifications:function(e,t){let n={...e};return t.newInboxNotifications.forEach(e=>{let t=n[e.id];(!t||1!=(t.notifiedAt>e.notifiedAt?1:t.notifiedAt<e.notifiedAt?-1:t.readAt&&e.readAt?t.readAt>e.readAt?1:t.readAt<e.readAt?-1:0:t.readAt||e.readAt?t.readAt?1:-1:0))&&(n[e.id]=e)}),t.deletedNotifications.forEach(({id:e})=>delete n[e]),n}(e.inboxNotifications,{newInboxNotifications:n,deletedNotifications:i}),queries:void 0!==o?{...e.queries,[o]:{isLoading:!1}}:e.queries}))},updateRoomInboxNotificationSettings(t,n,r){e.set(e=>({...e,notificationSettings:{...e.notificationSettings,[t]:n},queries:{...e.queries,[r]:{isLoading:!1}}}))},pushOptimisticUpdate(t){e.set(e=>({...e,optimisticUpdates:[...e.optimisticUpdates,t]}))},setQueryState(t,n){e.set(e=>({...e,queries:{...e.queries,[t]:n}}))}}}(),w=e.resolveUsers,E=tl(()=>!w,"Set the resolveUsers option in createClient to specify user info."),S=ed(async e=>{let t=e.flat(),n=await w?.({userIds:t});return E(),n??t.map(()=>void 0)},{delay:50}),k=e.resolveRoomsInfo,T=tl(()=>!k,"Set the resolveRoomsInfo option in createClient to specify room info."),A=ed(async e=>{let t=e.flat(),n=await k?.({roomIds:t});return T(),n??t.map(()=>void 0)},{delay:50});return Object.defineProperty({logout:function(){for(let{room:t}of(s.reset(),a.values())){var e;"initial"===(e=t.getStatus())||"disconnected"===e||t.reconnect()}},enter:function(e,t){let{room:n,leave:r}=d(e,t);return n},getRoom:function(e){return a.get(e)?.room||null},leave:function(e){for(let t of a.get(e)?.unsubs??new Set)t()},enterRoom:d,[ei]:{notifications:{getInboxNotifications:h,getUnreadInboxNotificationsCount:p,markAllInboxNotificationsAsRead:g,markInboxNotificationAsRead:_},currentUserIdStore:u,resolveMentionSuggestions:e.resolveMentionSuggestions,cacheStore:v,usersStore:S,roomsInfoStore:A,getRoomIds:()=>Array.from(a.keys())}},ei,{enumerable:!1})}var ts=class extends Error{constructor(e,t,n){super(e),this.message=e,this.status=t,this.details=n}};function ta(e,t,n,r,i){if("number"!=typeof t||t<n||void 0!==r&&t>r)throw Error(void 0!==r?`${e} should be between ${i??n} and ${r}.`:`${e} should be at least ${i??n}.`);return t}function tl(e,...t){return()=>{}}var td={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},tc=RegExp(Object.keys(td).map(e=>`\\${e}`).join("|"),"g"),tu=class{constructor(e,t){this._strings=e,this._values=t}toString(){return this._strings.reduce((e,t,n)=>{var r;return e+((r=m(this._values[n-1]))instanceof tu?r.toString():Array.isArray(r)?(r.length<=0?new tu([""],[]):new tu(["",...Array(r.length-1).fill(""),""],r)).toString():String(r).replace(tc,e=>td[e]))+t})}},th={_:"\\_","*":"\\*","#":"\\#","`":"\\`","~":"\\~","!":"\\!","|":"\\|","(":"\\(",")":"\\)","{":"\\{","}":"\\}","[":"\\[","]":"\\]"},tp=RegExp(Object.keys(th).map(e=>`\\${e}`).join("|"),"g"),tf=class{constructor(e,t){this._strings=e,this._values=t}toString(){return this._strings.reduce((e,t,n)=>{var r;return e+((r=m(this._values[n-1]))instanceof tf?r.toString():Array.isArray(r)?(r.length<=0?new tf([""],[]):new tf(["",...Array(r.length-1).fill(""),""],r)).toString():String(r).replace(tp,e=>th[e]))+t})}};function tm(e){let t={};for(let n in e){let r=e[n];void 0!==r&&(t[n]=function e(t){return t instanceof eF?tm(t.toObject()):t instanceof eP?t.toArray().map(e):t instanceof eK?function(t){let n={};for(let[r,i]of t.entries())n[r]=e(i);return n}(t):t instanceof eA?t.data:Array.isArray(t)?t.map(e):k(t)?tm(t):t}(r))}return t}function ty(e){if(Array.isArray(e))return new eP(e.map(ty));if(!k(e))return e;{let t={};for(let n in e){let r=e[n];void 0!==r&&(t[n]=ty(r))}return new eF(t)}}function tg(e){let t={state:"stopped",timeoutHandle:null,interval:null,lastScheduledAt:null,remainingInterval:null};function n(){"running"===t.state&&r(t.interval),e()}function r(e){t={state:"running",interval:"stopped"!==t.state?t.interval:e,lastScheduledAt:performance.now(),timeoutHandle:setTimeout(n,e),remainingInterval:null}}function i(e){"running"!==t.state&&r(e)}function o(){"stopped"!==t.state&&(t.timeoutHandle&&clearTimeout(t.timeoutHandle),t={state:"stopped",interval:null,lastScheduledAt:null,timeoutHandle:null,remainingInterval:null})}return{start:i,restart:function(e){o(),i(e)},pause:function(){"running"===t.state&&(clearTimeout(t.timeoutHandle),t={state:"paused",interval:t.interval,lastScheduledAt:t.lastScheduledAt,timeoutHandle:null,remainingInterval:t.interval-(performance.now()-t.lastScheduledAt)})},resume:function(){if("paused"===t.state){var e;e=t.remainingInterval,"paused"===t.state&&(t={state:"running",interval:t.interval,lastScheduledAt:t.lastScheduledAt,timeoutHandle:setTimeout(n,e),remainingInterval:null})}},stop:o}}function tb(e,t){if(Object.is(e,t))return!0;let n=Array.isArray(e),r=Array.isArray(t);return n||r?!!n&&!!r&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}(e,t):function(e,t){if("object"!=typeof e||null===e||"object"!=typeof t||null===t||"[object Object]"!==Object.prototype.toString.call(e)||"[object Object]"!==Object.prototype.toString.call(t))return!1;let n=Object.keys(e);return n.length===Object.keys(t).length&&n.every(n=>Object.prototype.hasOwnProperty.call(t,n)&&Object.is(e[n],t[n]))}(e,t)}p(d,c,"esm")},18817:(e,t,n)=>{"use strict";let r,i;n.d(t,{EH:()=>h,pf:()=>F,m1:()=>R});var o=n(92121),s=n(3729),a=n(6113);let l=e=>{!r||r.length<e?(r=Buffer.allocUnsafe(128*e),a.randomFillSync(r),i=0):i+e>r.length&&(a.randomFillSync(r),i=0),i+=e},d=(e=21)=>{l(e-=0);let t="";for(let n=i-e;n<i;n++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[n]];return t};var c=n(8145),u=n(34657);function h(e){let[t,n]=s.useState(!1);return s.useEffect(()=>{n(!0)},[]),s.createElement(s.Suspense,{fallback:e.fallback},t?e.children():e.fallback)}function p(e){return Object.values((0,o.Wy)(e).inboxNotifications).sort((e,t)=>t.notifiedAt.getTime()-e.notifiedAt.getTime())}function f(e,t){t>=5||setTimeout(()=>{e()},5e3*Math.pow(2,t))}var m=class extends Error{constructor(e,t){super("Create thread failed."),this.cause=e,this.context=t,this.name="CreateThreadError"}},y=class extends Error{constructor(e,t){super("Edit thread metadata failed."),this.cause=e,this.context=t,this.name="EditThreadMetadataError"}},g=class extends Error{constructor(e,t){super("Create comment failed."),this.cause=e,this.context=t,this.name="CreateCommentError"}},b=class extends Error{constructor(e,t){super("Edit comment failed."),this.cause=e,this.context=t,this.name="EditCommentError"}},_=class extends Error{constructor(e,t){super("Delete comment failed."),this.cause=e,this.context=t,this.name="DeleteCommentError"}},v=class extends Error{constructor(e,t){super("Add reaction failed."),this.cause=e,this.context=t,this.name="AddReactionError"}},x=class extends Error{constructor(e,t){super("Remove reaction failed."),this.cause=e,this.context=t,this.name="RemoveReactionError"}},w=class extends Error{constructor(e,t){super("Mark inbox notification as read failed."),this.cause=e,this.context=t,this.name="MarkInboxNotificationAsReadError"}},E=class extends Error{constructor(e,t){super("Update notification settings failed."),this.cause=e,this.context=t,this.name="UpdateNotificationSettingsError"}};function S(e){return`${e}_${d()}`}function k(e,t){let{notificationSettings:n}=(0,o.Wy)(t);return(0,o.nn)(n[e])}function T(e,t,n){return Object.values((0,o.Wy)(t).threads).filter(t=>{if(t.roomId!==e||void 0!==t.deletedAt)return!1;let r=n.query;if(!r)return!0;for(let e in r.metadata)if(t.metadata[e]!==r.metadata[e])return!1;return!0}).sort((e,t)=>e.createdAt.getTime()-t.createdAt.getTime())}function I(e){let t=(0,s.useRef)(e);return(0,s.useEffect)(()=>{t.current=e},[e]),t}var O=()=>{},C=e=>e;function A(e,t,n){return(0,u.useSyncExternalStoreWithSelector)(e,t,n,C)}var N=Object.freeze([]);function P(){return N}function L(){return null}var j=s.createContext(null);function R(e,t){if(t?.resolveUsers)throw Error("The 'resolveUsers' option has moved to 'createClient' from '@liveblocks/client'. Please refer to our Upgrade Guide to learn more, see https://liveblocks.io/docs/platform/upgrading/1.10.");if(t?.resolveMentionSuggestions)throw Error("The 'resolveMentionSuggestions' option has moved to 'createClient' from '@liveblocks/client'. Please refer to our Upgrade Guide to learn more, see https://liveblocks.io/docs/platform/upgrading/1.10.");let n=s.createContext(null),r=(0,o.Zb)(),i=$(e);function a(t){let[n]=s.useState(()=>new Map),r=s.useCallback((t,r)=>{let i=n.get(t);if(i)return i;let o=e.enterRoom(t,r),s=o.leave;return o.leave=()=>{s(),n.delete(t)},n.set(t,o),o},[n]);return s.createElement(l,{...t,stableEnterRoom:r})}function l(e){var t;let{id:r,stableEnterRoom:i}=e,a=(t={initialPresence:e.initialPresence,initialStorage:e.initialStorage,unstable_batchedUpdates:e.unstable_batchedUpdates,autoConnect:e.autoConnect??e.shouldInitiallyConnect??!1},(0,s.useState)(t)[0]),[{room:l},d]=s.useState(()=>i(r,{...a,autoConnect:!1}));return s.useEffect(()=>{async function e(e){let t=await l[o.W_].comments.getThread({threadId:e.threadId});if(!t){ep.deleteThread(e.threadId);return}let{thread:n,inboxNotification:r}=t,i=ep.get().threads[e.threadId];switch(e.type){case o.yO.COMMENT_EDITED:case o.yO.THREAD_METADATA_UPDATED:case o.yO.COMMENT_REACTION_ADDED:case o.yO.COMMENT_REACTION_REMOVED:case o.yO.COMMENT_DELETED:if(!i)break;ep.updateThreadAndNotification(n,r);break;case o.yO.COMMENT_CREATED:ep.updateThreadAndNotification(n,r)}}return l.events.comments.subscribe(t=>void e(t))},[l]),s.useEffect(()=>{eS(l.id)},[l.id]),s.useEffect(()=>{function e(){eS(l.id)}return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}},[l.id]),s.useEffect(()=>{let e=i(r,a);d(e);let{room:t,leave:n}=e;return a.autoConnect&&t.connect(),()=>{n()}},[r,a,i]),s.createElement(n.Provider,{value:l},s.createElement(j.Provider,{value:e$},e.children))}function c(e){return e.map(e=>e.connectionId)}function h(){let e=s.useContext(n);if(null===e)throw Error("RoomProvider is missing from the React tree.");return e}function N(){let e=h();return A(e.events.status.subscribe,e.getStatus,e.getStatus)}function R(){let e=h(),t=e.events.myPresence.subscribe,n=e.getPresence;return[A(t,n,n),e.updatePresence]}function z(){return h().updatePresence}function K(e,t){let n=h(),r=n.events.others.subscribe,i=n.getOthers;return(0,u.useSyncExternalStoreWithSelector)(r,i,P,e??C,t)}function F(){return K(c,o.Xd)}function q(e,t){return K(s.useCallback(t=>t.map(t=>[t.connectionId,e(t)]),[e]),s.useCallback((e,n)=>{let r=t??Object.is;return e.length===n.length&&e.every((e,t)=>{let i=n[t];return e[0]===i[0]&&r(e[1],i[1])})},[t]))}let H=Symbol();function W(e,t,n){let r=K(s.useCallback(n=>{let r=n.find(t=>t.connectionId===e);return void 0!==r?t(r):H},[e,t]),s.useCallback((e,t)=>e===H||t===H?e===t:(n??Object.is)(e,t),[n]));if(r===H)throw Error(`No such other user with connection id ${e} exists`);return r}function B(){let e=h();return s.useCallback((t,n={shouldQueueEventIfNotReady:!1})=>{e.broadcastEvent(t,n)},[e])}function V(e){let t=h(),n=I(e);s.useEffect(()=>t.events.others.subscribe(e=>n.current(e)),[t,n])}function G(e){let t=h(),n=I(e);s.useEffect(()=>t.events.lostConnection.subscribe(e=>n.current(e)),[t,n])}function J(e){let t=h(),n=I(e);s.useEffect(()=>t.events.error.subscribe(e=>n.current(e)),[t,n])}function Y(e){let t=h(),n=I(e);s.useEffect(()=>t.events.customEvent.subscribe(e=>{n.current(e)}),[t,n])}function X(e,t){let n=h(),r=n.events.self.subscribe,i=n.getSelf,o=e??C,a=s.useCallback(e=>null!==e?o(e):null,[o]);return(0,u.useSyncExternalStoreWithSelector)(r,i,L,a,t)}function Z(){let e=h();return A(e.events.storageDidLoad.subscribeOnce,e.getStorageSnapshot,L)}function Q(){return[Z()]}function ee(){return h().history}function et(){return ee().undo}function en(){return ee().redo}function er(){let e=h(),t=e.events.history.subscribe,n=e.history.canUndo;return A(t,n,n)}function ei(){let e=h(),t=e.events.history.subscribe,n=e.history.canRedo;return A(t,n,n)}function eo(){return h().batch}function es(e){let t=h(),n=Z(),r=function(){let[,e]=(0,s.useReducer)(e=>e+1,0);return e}();return(s.useEffect(()=>{let i;if(null===n)return;let s=n.get(e);function a(){i=(0,o.I6)(s)?t.subscribe(s,r):void 0}a(),r();let l=t.subscribe(n,function(){let t=n.get(e);t!==s&&(i?.(),s=t,a(),r())});return()=>{l(),i?.()}},[n,t,e,r]),null===n)?null:n.get(e)}function ea(e,t){let n=h(),r=Z(),i=s.useCallback(t=>null!==t?e(t):null,[e]),o=s.useCallback(e=>null!==r?n.subscribe(r,e,{isDeep:!0}):O,[n,r]),a=s.useCallback(()=>null===r?null:r.toImmutable(),[r]);return(0,u.useSyncExternalStoreWithSelector)(o,a,L,i,t)}function el(){throw Error("You cannot use the Suspense version of this hook on the server side. Make sure to only call them on the client side.\nFor tips, see https://liveblocks.io/docs/api-reference/liveblocks-react#suspense-avoid-ssr")}function ed(){let e=h();if(null===e.getStorageSnapshot())throw el(),new Promise(t=>{e.events.storageDidLoad.subscribeOnce(()=>t())})}function ec(){let e=h();if(null===e.getSelf())throw el(),new Promise(t=>{e.events.self.subscribeOnce(()=>t()),e.events.status.subscribeOnce(()=>t())})}function eu(e,t){let n=h();return s.useMemo(()=>(...t)=>n.batch(()=>e(function(e){let t="This mutation cannot be used until connected to the Liveblocks room";return{get storage(){let n=e.getStorageSnapshot();if(null===n)throw Error(t);return n},get self(){let n=e.getSelf();if(null===n)throw Error(t);return n},get others(){let n=e.getOthers();if(null===e.getSelf())throw Error(t);return n},setMyPresence:e.updatePresence}}(n),...t)),[n,...t])}function eh(e){return ed(),es(e)}let ep=e[o.W_].cacheStore;function ef(e,t,n){if(ep.set(e=>({...e,optimisticUpdates:e.optimisticUpdates.filter(e=>e.id!==t)})),e instanceof o.iz){let t=M(e);r.notify(n(t));return}if(e instanceof o.VB){M(e);return}throw e}let em=new Map,ey=new Map,eg=(0,o.x3)(eb);async function eb(){let t=[];e[o.W_].getRoomIds().map(n=>{let r=e.getRoom(n);null!==r&&t.push(eS(r.id))}),await Promise.allSettled(t)}function e_(e){let t=em.get(e)??0;em.set(e,t+1),eg.start(3e5)}function ev(e){let t=em.get(e);if(void 0===t||t<=0){o.iV.warn(`Internal unexpected behavior. Cannot decrease subscriber count for query "${e}"`);return}em.set(e,t-1);let n=0;for(let e of em.values())n+=e;n<=0&&eg.stop()}async function ex(e,t,n,{retryCount:r}={retryCount:0}){let i=ey.get(t);if(void 0!==i)return i;let s=e[o.W_].comments.getThreads(n);ey.set(t,s),ep.setQueryState(t,{isLoading:!0});try{let n=await s;ep.updateThreadsAndNotifications(n.threads,n.inboxNotifications,n.deletedThreads,n.deletedInboxNotifications,t);let r=ew.get(e.id);(void 0===r||r>n.meta.requestedAt)&&ew.set(e.id,n.meta.requestedAt),eg.start(3e5)}catch(i){ey.delete(t),f(()=>{ex(e,t,n,{retryCount:r+1})},r),ep.setQueryState(t,{isLoading:!1,error:i});return}}let ew=new Map,eE=new Map;async function eS(t){let n=e.getRoom(t);if(null===n)return;let r=ew.get(n.id);if(void 0!==r&&!0!==(eE.get(n.id)??!1))try{eE.set(n.id,!0);let e=await n[o.W_].comments.getThreads({since:r});setTimeout(()=>{eE.set(n.id,!1)},2e3),ep.updateThreadsAndNotifications(e.threads,e.inboxNotifications,e.deletedThreads,e.deletedInboxNotifications),ew.set(n.id,e.meta.requestedAt)}catch(e){eE.set(n.id,!1);return}}function ek(){let e=h();return s.useCallback(t=>{let n=t.body,r="metadata"in t?t.metadata:{},i=S("th"),s=S("cm"),a=new Date,l={id:s,threadId:i,roomId:e.id,createdAt:a,type:"comment",userId:D(e),body:n,reactions:[]},c={id:i,type:"thread",createdAt:a,updatedAt:a,roomId:e.id,metadata:r,comments:[l]},u=d();return ep.pushOptimisticUpdate({type:"create-thread",thread:c,id:u}),e[o.W_].comments.createThread({threadId:i,commentId:s,body:n,metadata:r}).then(e=>{ep.set(t=>({...t,threads:{...t.threads,[i]:e},optimisticUpdates:t.optimisticUpdates.filter(e=>e.id!==u)}))},t=>ef(t,u,t=>new m(t,{roomId:e.id,threadId:i,commentId:s,body:n,metadata:r}))),c},[e])}function eT(){let e=h();return s.useCallback(t=>{if(!("metadata"in t))return;let n=t.threadId,r=t.metadata,i=new Date,s=d();ep.pushOptimisticUpdate({type:"edit-thread-metadata",metadata:r,id:s,threadId:n,updatedAt:i}),e[o.W_].comments.editThreadMetadata({metadata:r,threadId:n}).then(e=>{ep.set(t=>{let r=t.threads[n],o=t.optimisticUpdates.filter(e=>e.id!==s);return void 0===r||void 0!==r.deletedAt||r.updatedAt&&r.updatedAt>i?{...t,optimisticUpdates:o}:{...t,threads:{...t.threads,[n]:{...r,metadata:{...r.metadata,...e}}},optimisticUpdates:o}})},t=>ef(t,s,t=>new y(t,{roomId:e.id,threadId:n,metadata:r})))},[e])}function eI(){let e=h();return s.useCallback(({threadId:t,commentId:n,emoji:r})=>{let i=new Date,s=D(e),a=d();ep.pushOptimisticUpdate({type:"add-reaction",threadId:t,commentId:n,reaction:{emoji:r,userId:s,createdAt:i},id:a}),e[o.W_].comments.addReaction({threadId:t,commentId:n,emoji:r}).then(e=>{ep.set(r=>{let i=r.threads[t],s=r.optimisticUpdates.filter(e=>e.id!==a);return void 0===i?{...r,optimisticUpdates:s}:{...r,threads:{...r.threads,[t]:(0,o.rU)(i,n,e)},optimisticUpdates:s}})},i=>ef(i,a,i=>new v(i,{roomId:e.id,threadId:t,commentId:n,emoji:r})))},[e])}function eO(){let e=h();return s.useCallback(({threadId:t,commentId:n,emoji:r})=>{let i=D(e),s=new Date,a=d();ep.pushOptimisticUpdate({type:"remove-reaction",threadId:t,commentId:n,emoji:r,userId:i,removedAt:s,id:a}),e[o.W_].comments.removeReaction({threadId:t,commentId:n,emoji:r}).then(()=>{ep.set(e=>{let l=e.threads[t],d=e.optimisticUpdates.filter(e=>e.id!==a);return void 0===l?{...e,optimisticUpdates:d}:{...e,threads:{...e.threads,[t]:(0,o.WO)(l,n,r,i,s)},optimisticUpdates:d}})},i=>ef(i,a,i=>new x(i,{roomId:e.id,threadId:t,commentId:n,emoji:r})))},[e])}function eC(){let e=h();return s.useCallback(({threadId:t,body:n})=>{let r=S("cm"),i=new Date,s={id:r,threadId:t,roomId:e.id,type:"comment",createdAt:i,userId:D(e),body:n,reactions:[]},a=d();return ep.pushOptimisticUpdate({type:"create-comment",comment:s,id:a}),e[o.W_].comments.createComment({threadId:t,commentId:r,body:n}).then(e=>{ep.set(n=>{let r=n.threads[t],i=n.optimisticUpdates.filter(e=>e.id!==a);if(void 0===r)return{...n,optimisticUpdates:i};let s=Object.values(n.inboxNotifications).find(e=>e.threadId===t),l=void 0!==s?{...n.inboxNotifications,[s.id]:{...s,notifiedAt:e.createdAt,readAt:e.createdAt}}:n.inboxNotifications;return{...n,threads:{...n.threads,[t]:(0,o.sE)(r,e)},inboxNotifications:l,optimisticUpdates:i}})},i=>ef(i,a,i=>new g(i,{roomId:e.id,threadId:t,commentId:r,body:n}))),s},[e])}function eA(){let e=h();return s.useCallback(({threadId:t,commentId:n,body:r})=>{let i=new Date,s=d(),a=ep.get().threads[t];if(void 0===a){o.iV.warn(`Internal unexpected behavior. Cannot edit comment in thread "${t}" because the thread does not exist in the cache.`);return}let l=a.comments.find(e=>e.id===n);if(void 0===l||void 0!==l.deletedAt){o.iV.warn(`Internal unexpected behavior. Cannot edit comment "${n}" in thread "${t}" because the comment does not exist in the cache.`);return}ep.pushOptimisticUpdate({type:"edit-comment",comment:{...l,editedAt:i,body:r},id:s}),e[o.W_].comments.editComment({threadId:t,commentId:n,body:r}).then(e=>{ep.set(n=>{let r=n.threads[t],i=n.optimisticUpdates.filter(e=>e.id!==s);return void 0===r?{...n,optimisticUpdates:i}:{...n,threads:{...n.threads,[t]:(0,o.sE)(r,e)},optimisticUpdates:i}})},i=>ef(i,s,i=>new b(i,{roomId:e.id,threadId:t,commentId:n,body:r})))},[e])}function eN(){let e=h();return s.useCallback(({threadId:t,commentId:n})=>{let r=new Date,i=d();ep.pushOptimisticUpdate({type:"delete-comment",threadId:t,commentId:n,deletedAt:r,id:i}),e[o.W_].comments.deleteComment({threadId:t,commentId:n}).then(()=>{ep.set(e=>{let s=e.threads[t],a=e.optimisticUpdates.filter(e=>e.id!==i);return void 0===s?{...e,optimisticUpdates:a}:{...e,threads:{...e.threads,[t]:(0,o.YF)(s,n,r)},optimisticUpdates:a}})},r=>ef(r,i,r=>new _(r,{roomId:e.id,threadId:t,commentId:n})))},[e])}let eP=e[o.W_].resolveMentionSuggestions,eL=new Map;function ej(e){let t=s.useCallback(t=>{let n=p(t).find(t=>t.threadId===e),r=t.threads[e];return void 0===n||void 0===r?{status:"not-subscribed"}:{status:"subscribed",unreadSince:n.readAt}},[e]);return(0,u.useSyncExternalStoreWithSelector)(ep.subscribe,ep.get,ep.get,t)}function eR(){let e=h();return s.useCallback(t=>{let n=Object.values(ep.get().inboxNotifications).find(e=>e.threadId===t);if(!n)return;let r=d(),i=new Date;ep.pushOptimisticUpdate({type:"mark-inbox-notification-as-read",id:r,inboxNotificationId:n.id,readAt:i}),e[o.W_].notifications.markInboxNotificationAsRead(n.id).then(()=>{ep.set(e=>({...e,inboxNotifications:{...e.inboxNotifications,[n.id]:{...n,readAt:i}},optimisticUpdates:e.optimisticUpdates.filter(e=>e.id!==r)}))},e=>{ef(e,r,e=>new w(e,{inboxNotificationId:n.id}))})},[e])}function eD(e){return`${e}:NOTIFICATION_SETTINGS`}async function eM(e,t,{retryCount:n}={retryCount:0}){let r=ey.get(t);if(void 0!==r)return r;try{let n=e[o.W_].notifications.getRoomNotificationSettings();ey.set(t,n),ep.setQueryState(t,{isLoading:!0});let r=await n;ep.updateRoomInboxNotificationSettings(e.id,r,t)}catch(r){ey.delete(t),f(()=>{eM(e,t,{retryCount:n+1})},n),ep.setQueryState(t,{isLoading:!1,error:r});return}}function eU(){let e=h();return s.useCallback(t=>{let n=d();ep.pushOptimisticUpdate({id:n,type:"update-notification-settings",roomId:e.id,settings:t}),e[o.W_].notifications.updateRoomNotificationSettings(t).then(t=>{ep.set(r=>({...r,notificationSettings:{[e.id]:t},optimisticUpdates:r.optimisticUpdates.filter(e=>e.id!==n)}))},t=>ef(t,n,t=>new E(t,{roomId:e.id})))},[e])}let e$={RoomContext:n,RoomProvider:a,useRoom:h,useStatus:N,useBatch:eo,useBroadcastEvent:B,useOthersListener:V,useLostConnectionListener:G,useErrorListener:J,useEventListener:Y,useHistory:ee,useUndo:et,useRedo:en,useCanRedo:ei,useCanUndo:er,useList:es,useMap:es,useObject:es,useStorageRoot:Q,useStorage:ea,useSelf:X,useMyPresence:R,useUpdateMyPresence:z,useOthers:K,useOthersMapped:q,useOthersConnectionIds:F,useOther:W,useMutation:eu,useThreads:function(e={query:{metadata:{}}}){let t=h(),n=s.useMemo(()=>U(t.id,e.query),[t,e]);s.useEffect(()=>(ex(t,n,e),e_(n),()=>ev(n)),[t,n]);let r=s.useCallback(r=>{let i=r.queries[n];return void 0===i||i.isLoading?{isLoading:!0}:{threads:T(t.id,r,e),isLoading:!1,error:i.error}},[t,n]);return(0,u.useSyncExternalStoreWithSelector)(ep.subscribe,ep.get,ep.get,r)},useCreateThread:ek,useEditThreadMetadata:eT,useCreateComment:eC,useEditComment:eA,useDeleteComment:eN,useAddReaction:eI,useRemoveReaction:eO,useMarkThreadAsRead:eR,useThreadSubscription:ej,useRoomNotificationSettings:function(){let e=h();s.useEffect(()=>{let t=eD(e.id);eM(e,t)},[e]);let t=eU(),n=s.useCallback(t=>{let n=t.queries[eD(e.id)];return void 0===n||n.isLoading?{isLoading:!0}:void 0!==n.error?{isLoading:!1,error:n.error}:{isLoading:!1,settings:k(e.id,t)}},[e]),r=(0,u.useSyncExternalStoreWithSelector)(ep.subscribe,ep.get,ep.get,n);return s.useMemo(()=>[r,t],[r,t])},useUpdateRoomNotificationSettings:eU,...i,suspense:{RoomContext:n,RoomProvider:a,useRoom:h,useStatus:N,useBatch:eo,useBroadcastEvent:B,useOthersListener:V,useLostConnectionListener:G,useErrorListener:J,useEventListener:Y,useHistory:ee,useUndo:et,useRedo:en,useCanRedo:ei,useCanUndo:er,useList:eh,useMap:eh,useObject:eh,useStorageRoot:Q,useStorage:function(e,t){return ed(),ea(e,t)},useSelf:function(e,t){return ec(),X(e,t)},useMyPresence:R,useUpdateMyPresence:z,useOthers:function(e,t){return ec(),K(e,t)},useOthersMapped:function(e,t){return ec(),q(e,t)},useOthersConnectionIds:function(){return ec(),F()},useOther:function(e,t,n){return ec(),W(e,t,n)},useMutation:eu,useThreads:function(e={query:{metadata:{}}}){let t=h(),n=s.useMemo(()=>U(t.id,e?.query),[t,e]),r=ep.get().queries[n];if(void 0===r||r.isLoading)throw ex(t,n,e);if(r.error)throw r.error;let i=s.useCallback(n=>({threads:T(t.id,n,e),isLoading:!1}),[t,n]);return s.useEffect(()=>(e_(n),()=>{ev(n)}),[n]),(0,u.useSyncExternalStoreWithSelector)(ep.subscribe,ep.get,ep.get,i)},useCreateThread:ek,useEditThreadMetadata:eT,useCreateComment:eC,useEditComment:eA,useDeleteComment:eN,useAddReaction:eI,useRemoveReaction:eO,useMarkThreadAsRead:eR,useThreadSubscription:ej,useRoomNotificationSettings:function(){let e=eU(),t=h(),n=eD(t.id),r=ep.get().queries[n];if(void 0===r||r.isLoading)throw eM(t,n);if(r.error)throw r.error;let i=s.useCallback(e=>({isLoading:!1,settings:k(t.id,e)}),[t]),o=(0,u.useSyncExternalStoreWithSelector)(ep.subscribe,ep.get,ep.get,i);return s.useMemo(()=>[o,e],[o,e])},useUpdateRoomNotificationSettings:eU,...i.suspense},[o.W_]:{useCurrentUserId:function(){return X(e=>"string"==typeof e.id?e.id:null)},hasResolveMentionSuggestions:void 0!==eP,useMentionSuggestions:function(e){let t=h(),[n,r]=s.useState(),i=s.useRef();return s.useEffect(()=>{let n;if(void 0===e||!eP)return;let s={text:e,roomId:t.id},a=(0,o.Pz)(s),l=!1,d=async()=>{try{i.current=performance.now();let e=await eP(s);l||(r(e),eL.set(a,e))}catch(e){o.iV.error(e?.message)}};return eL.has(a)?r(eL.get(a)):!i.current||Math.abs(performance.now()-i.current)>500?d():n=window.setTimeout(()=>{d()},500),()=>{l=!0,window.clearTimeout(n)}},[t.id,e]),n}}};return Object.defineProperty(e$,o.W_,{enumerable:!1})}function D(e){let t=e.getSelf();return null===t||void 0===t.id?"anonymous":t.id}function M(e){let t=`Request failed with status ${e.status}: ${e.message}`;if(e.details?.error==="FORBIDDEN"){let n=[t,e.details.suggestion,e.details.docs].filter(Boolean).join("\n");o.iV.error(n)}return Error(t)}function U(e,t){return`${e}-${(0,o.Pz)(t??{})}`}function $(e){let t=e[o.W_].usersStore,n=e[o.W_].roomsInfoStore;return{useUser:function(e){let n=(0,s.useCallback)(()=>t.getState(e),[e]);(0,s.useEffect)(()=>{t.get(e)},[e]);let r=(0,c.useSyncExternalStore)(t.subscribe,n,n);return r?{...r,user:r.data}:{isLoading:!0}},useRoomInfo:function(e){let t=(0,s.useCallback)(()=>n.getState(e),[e]);(0,s.useEffect)(()=>{n.get(e)},[e]);let r=(0,c.useSyncExternalStore)(n.subscribe,t,t);return r?{...r,info:r.data}:{isLoading:!0}},suspense:{useUser:function(e){let n=(0,s.useCallback)(()=>t.getState(e),[e]),r=n();if(!r||r.isLoading)throw t.get(e);if(r.error)throw r.error;let i=(0,c.useSyncExternalStore)(t.subscribe,n,n);return{...i,user:i?.data}},useRoomInfo:function(e){let t=(0,s.useCallback)(()=>n.getState(e),[e]),r=t();if(!r||r.isLoading)throw n.get(e);if(r.error)throw r.error;let i=(0,c.useSyncExternalStore)(n.subscribe,t,t);return{...i,info:i?.data}}}}}var z=(0,s.createContext)(null),K="INBOX_NOTIFICATIONS";function F(e){let t;let n=$(e),r=e[o.W_].cacheStore,i=e[o.W_].notifications;function a(e){return s.createElement(z.Provider,{value:I},e.children)}let l=null,h=0,m=(0,o.x3)(function(){return i.getInboxNotifications({since:t}).then(e=>{t=e.meta.requestedAt,r.updateThreadsAndNotifications(e.threads,e.inboxNotifications,e.deletedThreads,e.deletedInboxNotifications,K)},()=>{})});function y(){h++,m.start(6e4)}function g(){if(h<=0){console.warn(`Internal unexpected behavior. Cannot decrease subscriber count for query "${K}"`);return}--h<=0&&m.stop()}async function b({retryCount:e}={retryCount:0}){if(null!==l)return l;r.setQueryState(K,{isLoading:!0});try{l=i.getInboxNotifications();let e=await l;r.updateThreadsAndNotifications(e.threads,e.inboxNotifications,e.deletedThreads,e.deletedInboxNotifications,K),(void 0===t||t>e.meta.requestedAt)&&(t=e.meta.requestedAt),m.start(6e4)}catch(t){l=null,f(()=>{b({retryCount:e+1})},e),r.setQueryState(K,{isLoading:!1,error:t})}}function _(e){let t=e.queries[K];return void 0===t||t.isLoading?{isLoading:!0}:void 0!==t.error?{error:t.error,isLoading:!1}:{inboxNotifications:p(e),isLoading:!1}}function v(e){return{inboxNotifications:p(e),isLoading:!1}}function x(e){let t=0;for(let n of p(e))(null===n.readAt||n.readAt<n.notifiedAt)&&t++;return t}function w(e){let t=e.queries[K];return void 0===t||t.isLoading?{isLoading:!0}:void 0!==t.error?{error:t.error,isLoading:!1}:{isLoading:!1,count:x(e)}}function E(e){return{isLoading:!1,count:x(e)}}function S(){return(0,s.useCallback)(e=>{let t=d(),n=new Date;r.pushOptimisticUpdate({type:"mark-inbox-notification-as-read",id:t,inboxNotificationId:e,readAt:n}),i.markInboxNotificationAsRead(e).then(()=>{r.set(r=>{let i=r.inboxNotifications[e];return void 0===i?{...r,optimisticUpdates:r.optimisticUpdates.filter(e=>e.id!==t)}:{...r,inboxNotifications:{...r.inboxNotifications,[e]:{...i,readAt:n}},optimisticUpdates:r.optimisticUpdates.filter(e=>e.id!==t)}})},()=>{r.set(e=>({...e,optimisticUpdates:e.optimisticUpdates.filter(e=>e.id!==t)}))})},[])}function k(){return(0,s.useCallback)(()=>{let e=d(),t=new Date;r.pushOptimisticUpdate({type:"mark-inbox-notifications-as-read",id:e,readAt:t}),i.markAllInboxNotificationsAsRead().then(()=>{r.set(n=>({...n,inboxNotifications:Object.fromEntries(Array.from(Object.entries(n.inboxNotifications)).map(([e,n])=>[e,{...n,readAt:t}])),optimisticUpdates:n.optimisticUpdates.filter(t=>t.id!==e)}))},()=>{r.set(t=>({...t,optimisticUpdates:t.optimisticUpdates.filter(t=>t.id!==e)}))})},[])}let T=e[o.W_].currentUserIdStore,I={LiveblocksProvider:a,useInboxNotifications:function(){return(0,s.useEffect)(()=>(b(),y(),()=>g()),[]),(0,u.useSyncExternalStoreWithSelector)(r.subscribe,r.get,r.get,_)},useUnreadInboxNotificationsCount:function(){return(0,s.useEffect)(()=>(b(),y(),()=>g()),[]),(0,u.useSyncExternalStoreWithSelector)(r.subscribe,r.get,r.get,w)},useMarkInboxNotificationAsRead:S,useMarkAllInboxNotificationsAsRead:k,...n,suspense:{LiveblocksProvider:a,useInboxNotifications:function(){let e=r.get().queries[K];if(void 0===e||e.isLoading)throw b();if(void 0!==e.error)throw e.error;return s.useEffect(()=>(y(),()=>{g()}),[]),(0,u.useSyncExternalStoreWithSelector)(r.subscribe,r.get,r.get,v)},useUnreadInboxNotificationsCount:function(){let e=r.get().queries[K];if(void 0===e||e.isLoading)throw b();return s.useEffect(()=>(y(),()=>{g()}),[]),(0,u.useSyncExternalStoreWithSelector)(r.subscribe,r.get,r.get,E)},useMarkInboxNotificationAsRead:S,useMarkAllInboxNotificationsAsRead:k,...n.suspense},[o.W_]:{useThreadFromCache:function(e){let t=(0,s.useCallback)(t=>{let n=t.threads[e];if(void 0===n)throw Error(`Internal error: thread with id "${e}" not found in cache`);return n},[e]);return(0,u.useSyncExternalStoreWithSelector)(r.subscribe,r.get,r.get,t)},useCurrentUserId:function(){return(0,c.useSyncExternalStore)(T.subscribe,T.get,T.get)}}};return Object.defineProperty(I,o.W_,{enumerable:!1})}(0,o.l8)("@liveblocks/react","1.10.1","esm")}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[638,292,809,329,563],()=>n(96586));module.exports=r})();