"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[327],{1291:function(e,t,n){n.d(t,{EU:function(){return eV},I6:function(){return eQ},Pz:function(){return el},VB:function(){return tc},WO:function(){return ta},W_:function(){return ed},Wy:function(){return ti},Xd:function(){return tf},YF:function(){return to},Zb:function(){return v},as:function(){return eU},eI:function(){return tl},iV:function(){return y},iz:function(){return tt},l8:function(){return f},nn:function(){return m},oV:function(){return eJ},rU:function(){return ts},sE:function(){return tr},x3:function(){return tp},yO:function(){return U}}),n(6093);var i,r,o,s,a,d=n(9079),l=Object.defineProperty,c="@liveblocks/core",u="1.10.1",h="undefined"!=typeof globalThis?globalThis:window;function p(e){console.error(e)}function f(e,t,n){let i=Symbol.for(e),r=n?"".concat(t||"dev"," (").concat(n,")"):t||"dev";h[i]?h[i]===r||p(["Multiple copies of Liveblocks are being loaded in your project. This will cause issues! See ".concat("https://liveblocks.io/docs/errors/dupes "),"","Conflicts:","- ".concat(e," ").concat(h[i]," (already loaded)"),"- ".concat(e," ").concat(r," (trying to load this now)")].join("\n")):h[i]=r,t&&u&&t!==u&&p(["Cross-linked versions of Liveblocks found, which will cause issues! See ".concat("https://liveblocks.io/docs/errors/cross-linked "),"","Conflicts:","- ".concat(c," is at ").concat(u),"- ".concat(e," is at ").concat(t),"","Always upgrade all Liveblocks packages to the same version number."].join("\n"))}function _(e,t){throw Error(t)}function m(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],e}function v(){let e=new Set,t=new Set,n=null;function i(e){return t.add(e),()=>t.delete(e)}function r(t){return e.add(t),()=>e.delete(t)}async function o(e){let t;return new Promise(n=>{t=i(t=>{(void 0===e||e(t))&&n(t)})}).finally(()=>null==t?void 0:t())}function s(n){e.forEach(e=>e(n)),e.clear(),t.forEach(e=>e(n))}return{notify:function(e){null!==n?n.push(e):s(e)},subscribe:i,subscribeOnce:r,clear:function(){e.clear(),t.clear()},count:function(){return e.size+t.size},waitUntil:o,pause:function(){n=[]},unpause:function(){if(null!==n){for(let e of n)s(e);n=null}},observable:{subscribe:i,subscribeOnce:r,waitUntil:o}}}var y={};((e,t)=>{for(var n in t)l(e,n,{get:t[n],enumerable:!0})})(y,{error:()=>w,errorWithTitle:()=>O,warn:()=>E,warnWithTitle:()=>T});var g="background:#0e0d12;border-radius:9999px;color:#fff;padding:3px 7px;font-family:sans-serif;font-weight:600;";function b(e){return function(t){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return console[e]("%cLiveblocks",g,t,...i)}}var E=b("warn"),w=b("error");function S(e){return function(t,n){for(var i=arguments.length,r=Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];return console[e]("%cLiveblocks%c ".concat(t),g,"font-weight:600",n,...r)}}var T=S("warn"),O=S("error"),I=class{get current(){return this.curr}allowPatching(e){let t=this,n=!0;e({...this.curr,patch(e){if(n)for(let n of(t.curr=Object.assign({},t.curr,e),Object.entries(e))){let[e,t]=n;"patch"!==e&&(this[e]=t)}else throw Error("Can no longer patch stale context")}}),n=!1}constructor(e){this.curr=e}},A=1,k=class{get initialState(){let e=this.states.values()[Symbol.iterator]().next();if(!e.done)return e.value;throw Error("No states defined yet")}get currentState(){if(null===this.currentStateOrNull){if(0===this.runningState)throw Error("Not started yet");throw Error("Already stopped")}return this.currentStateOrNull}start(){if(0!==this.runningState)throw Error("State machine has already started");return this.runningState=1,this.currentStateOrNull=this.initialState,this.enter(null),this}stop(){if(1!==this.runningState)throw Error("Cannot stop a state machine that hasn't started yet");this.exit(null),this.runningState=2,this.currentStateOrNull=null}get context(){return this.currentContext.current}addState(e){if(0!==this.runningState)throw Error("Already started");return this.states.add(e),this}onEnter(e,t){if(0!==this.runningState)throw Error("Already started");if(this.enterFns.has(e))throw Error("enter/exit function for ".concat(e," already exists"));return this.enterFns.set(e,t),this}onEnterAsync(e,t,n,i){return this.onEnter(e,()=>{let e=new AbortController,r=e.signal,o=!1;return t(this.currentContext.current,r).then(e=>{r.aborted||(o=!0,this.transition({type:"ASYNC_OK",data:e},n))},e=>{r.aborted||(o=!0,this.transition({type:"ASYNC_ERROR",reason:e},i))}),()=>{o||e.abort()}})}getStatesMatching(e){let t=[];if("*"===e)for(let e of this.states)t.push(e);else if(e.endsWith(".*")){let n=e.slice(0,-1);for(let e of this.states)e.startsWith(n)&&t.push(e)}else this.states.has(e)&&t.push(e);if(0===t.length)throw Error("No states match ".concat(JSON.stringify(e)));return t}addTransitions(e,t){if(0!==this.runningState)throw Error("Already started");for(let n of this.getStatesMatching(e)){let i=this.allowedTransitions.get(n);for(let[r,o]of(void 0===i&&(i=new Map,this.allowedTransitions.set(n,i)),Object.entries(t))){if(i.has(r))throw Error('Trying to set transition "'.concat(r,'" on "').concat(n,'" (via "').concat(e,'"), but a transition already exists there.'));let t=o;if(this.knownEventTypes.add(r),void 0!==t){let e="function"==typeof t?t:()=>t;i.set(r,e)}}}return this}addTimedTransition(e,t,n){return this.onEnter(e,()=>{let e=setTimeout(()=>{this.transition({type:"TIMER"},n)},"function"==typeof t?t(this.currentContext.current):t);return()=>{clearTimeout(e)}})}getTargetFn(e){var t;return null===(t=this.allowedTransitions.get(this.currentState))||void 0===t?void 0:t.get(e)}exit(e){this.eventHub.willExitState.notify(this.currentState),this.currentContext.allowPatching(t=>{e=null!=e?e:this.cleanupStack.length;for(let i=0;i<e;i++){var n;null===(n=this.cleanupStack.pop())||void 0===n||n(t)}})}enter(e){let t=function(e,t){let n=e.split(".");if(t<1||t>n.length+1)throw Error("Invalid number of levels");let i=[];t>n.length&&i.push("*");for(let e=n.length-t+1;e<n.length;e++){let t=n.slice(0,e);t.length>0&&i.push(t.join(".")+".*")}return i.push(e),i}(this.currentState,null!=e?e:this.currentState.split(".").length+1);this.currentContext.allowPatching(e=>{for(let n of t){let t=this.enterFns.get(n),i=null==t?void 0:t(e);"function"==typeof i?this.cleanupStack.push(i):this.cleanupStack.push(null)}}),this.eventHub.didEnterState.notify(this.currentState)}send(e){if(!this.knownEventTypes.has(e.type))throw Error("Invalid event ".concat(JSON.stringify(e.type)));if(2===this.runningState)return;let t=this.getTargetFn(e.type);if(void 0!==t)return this.transition(e,t);this.eventHub.didIgnoreEvent.notify(e)}transition(e,t){let n,i;this.eventHub.didReceiveEvent.notify(e);let r=this.currentState,o=("function"==typeof t?t:()=>t)(e,this.currentContext.current);if(null===o){this.eventHub.didIgnoreEvent.notify(e);return}if("string"==typeof o?n=o:(n=o.target,i=Array.isArray(o.effect)?o.effect:[o.effect]),!this.states.has(n))throw Error("Invalid next state name: ".concat(JSON.stringify(n)));this.eventHub.willTransition.notify({from:r,to:n});let[s,a]=function(e,t){if(e===t)return[0,0];let n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length),o=0;for(;o<r&&n[o]===i[o];o++);return[n.length-o,i.length-o]}(this.currentState,n);if(s>0&&this.exit(s),this.currentStateOrNull=n,void 0!==i){let t=i;this.currentContext.allowPatching(n=>{for(let i of t)"function"==typeof i?i(n,e):n.patch(i)})}a>0&&this.enter(a)}constructor(e){this.id=A++,this.runningState=0,this.currentStateOrNull=null,this.states=new Set,this.enterFns=new Map,this.cleanupStack=[],this.knownEventTypes=new Set,this.allowedTransitions=new Map,this.currentContext=new I(e),this.eventHub={didReceiveEvent:v(),willTransition:v(),didIgnoreEvent:v(),willExitState:v(),didEnterState:v()},this.events={didReceiveEvent:this.eventHub.didReceiveEvent.observable,willTransition:this.eventHub.willTransition.observable,didIgnoreEvent:this.eventHub.didIgnoreEvent.observable,willExitState:this.eventHub.willExitState.observable,didEnterState:this.eventHub.didEnterState.observable}}};function C(e){return null!==e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)}function P(e){return Object.entries(e)}function N(e){try{return JSON.parse(e)}catch(e){return}}function L(e){return JSON.parse(JSON.stringify(e))}function R(e){return e.filter(e=>null!=e)}function D(e){let t={...e};return Object.keys(e).forEach(e=>{void 0===t[e]&&delete t[e]}),t}async function x(e,t,n){let i;return Promise.race([e,new Promise((e,r)=>{i=setTimeout(()=>{r(Error(n))},t)})]).finally(()=>clearTimeout(i))}var U=((i=U||{})[i.UPDATE_PRESENCE=100]="UPDATE_PRESENCE",i[i.USER_JOINED=101]="USER_JOINED",i[i.USER_LEFT=102]="USER_LEFT",i[i.BROADCASTED_EVENT=103]="BROADCASTED_EVENT",i[i.ROOM_STATE=104]="ROOM_STATE",i[i.INITIAL_STORAGE_STATE=200]="INITIAL_STORAGE_STATE",i[i.UPDATE_STORAGE=201]="UPDATE_STORAGE",i[i.REJECT_STORAGE_OP=299]="REJECT_STORAGE_OP",i[i.UPDATE_YDOC=300]="UPDATE_YDOC",i[i.THREAD_CREATED=400]="THREAD_CREATED",i[i.THREAD_METADATA_UPDATED=401]="THREAD_METADATA_UPDATED",i[i.COMMENT_CREATED=402]="COMMENT_CREATED",i[i.COMMENT_EDITED=403]="COMMENT_EDITED",i[i.COMMENT_DELETED=404]="COMMENT_DELETED",i[i.COMMENT_REACTION_ADDED=405]="COMMENT_REACTION_ADDED",i[i.COMMENT_REACTION_REMOVED=406]="COMMENT_REACTION_REMOVED",i),M=((r=M||{})[r.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",r[r.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",r[r.UNEXPECTED_CONDITION=1011]="UNEXPECTED_CONDITION",r[r.TRY_AGAIN_LATER=1013]="TRY_AGAIN_LATER",r[r.INVALID_MESSAGE_FORMAT=4e3]="INVALID_MESSAGE_FORMAT",r[r.NOT_ALLOWED=4001]="NOT_ALLOWED",r[r.MAX_NUMBER_OF_MESSAGES_PER_SECONDS=4002]="MAX_NUMBER_OF_MESSAGES_PER_SECONDS",r[r.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS=4003]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS",r[r.MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP=4004]="MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP",r[r.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM=4005]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM",r[r.KICKED=4100]="KICKED",r[r.TOKEN_EXPIRED=4109]="TOKEN_EXPIRED",r[r.CLOSE_WITHOUT_RETRY=4999]="CLOSE_WITHOUT_RETRY",r);function j(e){return 4999===e||e>=4e3&&e<4100}function K(e){return 1013===e||e>=4200&&e<4300}function H(e){switch(e){case"connecting":return"connecting";case"connected":return"open";case"reconnecting":return"unavailable";case"disconnected":return"failed";default:return"closed"}}function z(e){let t=e.currentState;switch(t){case"@ok.connected":case"@ok.awaiting-pong":return"connected";case"@idle.initial":return"initial";case"@auth.busy":case"@auth.backoff":case"@connecting.busy":case"@connecting.backoff":case"@idle.zombie":return e.context.successCount>0?"reconnecting":"connecting";case"@idle.failed":return"disconnected";default:return _(t,"Unknown state")}}var F=[250,500,1e3,2e3,4e3,8e3,1e4],B=F[0]-1,W=[2e3,3e4,6e4,3e5],J=class extends Error{constructor(e){super(e)}},V=class extends Error{constructor(e,t){super(e),this.code=t}};function q(e,t){var n;return null!==(n=t.find(t=>t>e))&&void 0!==n?n:t[t.length-1]}function G(e){e.patch({backoffDelay:q(e.backoffDelay,F)})}function Y(e){e.patch({backoffDelay:q(e.backoffDelay,W)})}function X(e){e.patch({successCount:0})}function Q(e,t){let n=2===e?w:1===e?E:()=>{};return()=>{n(t)}}function Z(e){let t="Connection to Liveblocks websocket server";return n=>{e instanceof Error?E("".concat(t," could not be established. ").concat(String(e))):E(et(e)?"".concat(t," closed prematurely (code: ").concat(e.code,"). Retrying in ").concat(n.backoffDelay,"ms."):"".concat(t," could not be established."))}}function $(e){return t=>{E("Connection to Liveblocks websocket server closed (code: ".concat(e.code,"). Retrying in ").concat(t.backoffDelay,"ms."))}}var ee=Q(1,"Connection to WebSocket closed permanently. Won't retry.");function et(e){return!(e instanceof Error)&&"close"===e.type}var en=e=>t=>t.patch(e),ei=class{getLegacyStatus(){return H(this.getStatus())}getStatus(){try{return z(this.machine)}catch(e){return"initial"}}get authValue(){return this.machine.context.authValue}connect(){this.machine.send({type:"CONNECT"})}reconnect(){this.machine.send({type:"RECONNECT"})}disconnect(){this.machine.send({type:"DISCONNECT"})}destroy(){let e;for(this.machine.stop();e=this.cleanups.pop();)e()}send(e){var t;let n=null===(t=this.machine.context)||void 0===t?void 0:t.socket;null===n?E("Cannot send: not connected yet",e):1!==n.readyState?E("Cannot send: WebSocket no longer open",e):n.send(e)}_privateSendMachineEvent(e){this.machine.send(e)}constructor(e,t=!1,n=!0){let{machine:i,events:r,cleanups:o}=function(e,t){let n=v();n.pause();let i=v();function r(e,t){return()=>{let n=new V(e,t);i.notify(n)}}let o=new k({successCount:0,authValue:null,socket:null,backoffDelay:B}).addState("@idle.initial").addState("@idle.failed").addState("@idle.zombie").addState("@auth.busy").addState("@auth.backoff").addState("@connecting.busy").addState("@connecting.backoff").addState("@ok.connected").addState("@ok.awaiting-pong");o.addTransitions("*",{RECONNECT:{target:"@auth.backoff",effect:[G,X]},DISCONNECT:"@idle.initial"}),o.onEnter("@idle.*",X).addTransitions("@idle.*",{CONNECT:(e,t)=>null!==t.authValue?"@connecting.busy":"@auth.busy"}),o.addTransitions("@auth.backoff",{NAVIGATOR_ONLINE:{target:"@auth.busy",effect:en({backoffDelay:B})}}).addTimedTransition("@auth.backoff",e=>e.backoffDelay,"@auth.busy").onEnterAsync("@auth.busy",()=>x(e.authenticate(),1e4,"Timed out during auth"),e=>({target:"@connecting.busy",effect:en({authValue:e.data})}),e=>e.reason instanceof J?{target:"@idle.failed",effect:[Q(2,e.reason.message),r(e.reason.message,-1)]}:{target:"@auth.backoff",effect:[G,Q(2,"Authentication failed: ".concat(e.reason instanceof Error?e.reason.message:String(e.reason)))]});let s=e=>o.send({type:"EXPLICIT_SOCKET_ERROR",event:e}),a=e=>o.send({type:"EXPLICIT_SOCKET_CLOSE",event:e}),d=e=>"pong"===e.data?o.send({type:"PONG"}):n.notify(e);function l(e){e&&(e.removeEventListener("error",s),e.removeEventListener("close",a),e.removeEventListener("message",d),e.close())}o.addTransitions("@connecting.backoff",{NAVIGATOR_ONLINE:{target:"@connecting.busy",effect:en({backoffDelay:B})}}).addTimedTransition("@connecting.backoff",e=>e.backoffDelay,"@connecting.busy").onEnterAsync("@connecting.busy",async(n,i)=>{let r=null,o=null;return x(new Promise((i,l)=>{if(null===n.authValue)throw Error("No auth authValue");let c=e.createSocket(n.authValue);function u(e){r=e,c.removeEventListener("message",d),l(e)}o=c;let[h,p]=function(){let e;let t=new Promise(t=>{e=t});if(!e)throw Error("Should never happen");return[t,e]}();function f(e){let t=N(e.data);(null==t?void 0:t.type)===104&&p()}t.waitForActorId||p(),c.addEventListener("message",d),t.waitForActorId&&c.addEventListener("message",f),c.addEventListener("error",u),c.addEventListener("close",u),c.addEventListener("open",()=>{c.addEventListener("error",s),c.addEventListener("close",a);let e=()=>{c.removeEventListener("error",u),c.removeEventListener("close",u),c.removeEventListener("message",f)};h.then(()=>{i([c,e])})})}),1e4,"Timed out during websocket connection").then(e=>{let[t,n]=e;if(n(),i.aborted)throw Error("Aborted");if(r)throw r;return t}).catch(e=>{throw l(o),e})},e=>({target:"@ok.connected",effect:en({socket:e.data,backoffDelay:B})}),e=>{let t=e.reason;if(t instanceof J)return{target:"@idle.failed",effect:[Q(2,t.message),r(t.message,-1)]};if(et(t)){if(4109===t.code)return"@auth.busy";if(K(t.code))return{target:"@connecting.backoff",effect:[Y,Z(t)]};if(j(t.code))return{target:"@idle.failed",effect:[Q(2,t.reason),r(t.reason,t.code)]}}return{target:"@auth.backoff",effect:[G,Z(t)]}});let c={target:"@ok.awaiting-pong",effect:e=>{var t;null===(t=e.socket)||void 0===t||t.send("ping")}},u=()=>{let t="undefined"!=typeof document?document:void 0;return(null==t?void 0:t.visibilityState)==="hidden"&&e.canZombie()?"@idle.zombie":c};if(o.addTimedTransition("@ok.connected",3e4,u).addTransitions("@ok.connected",{NAVIGATOR_OFFLINE:u,WINDOW_GOT_FOCUS:c}),o.addTransitions("@idle.zombie",{WINDOW_GOT_FOCUS:"@connecting.backoff"}),o.onEnter("@ok.*",e=>{e.patch({successCount:e.successCount+1});let t=setTimeout(n.unpause,0);return e=>{l(e.socket),e.patch({socket:null}),clearTimeout(t),n.pause()}}).addTransitions("@ok.awaiting-pong",{PONG:"@ok.connected"}).addTimedTransition("@ok.awaiting-pong",2e3,{target:"@connecting.busy",effect:Q(1,"Received no pong from server, assume implicit connection loss.")}).addTransitions("@ok.*",{EXPLICIT_SOCKET_ERROR:(e,t)=>{var n;return(null===(n=t.socket)||void 0===n?void 0:n.readyState)===1?null:{target:"@connecting.backoff",effect:G}},EXPLICIT_SOCKET_CLOSE:e=>{var t;return j(e.event.code)?{target:"@idle.failed",effect:[ee,r(e.event.reason,e.event.code)]}:(t=e.event.code)>=4100&&t<4200?4109===e.event.code?"@auth.busy":{target:"@auth.backoff",effect:[G,$(e.event)]}:K(e.event.code)?{target:"@connecting.backoff",effect:[Y,$(e.event)]}:{target:"@connecting.backoff",effect:[G,$(e.event)]}}}),"undefined"!=typeof document){let e="undefined"!=typeof document?document:void 0,t=window,n=null!=t?t:e;o.onEnter("*",i=>{function r(){o.send({type:"NAVIGATOR_OFFLINE"})}function s(){o.send({type:"NAVIGATOR_ONLINE"})}function a(){(null==e?void 0:e.visibilityState)==="visible"&&o.send({type:"WINDOW_GOT_FOCUS"})}return null==t||t.addEventListener("online",s),null==t||t.addEventListener("offline",r),null==n||n.addEventListener("visibilitychange",a),()=>{null==n||n.removeEventListener("visibilitychange",a),null==t||t.removeEventListener("online",s),null==t||t.removeEventListener("offline",r),l(i.socket)}})}let h=[],{statusDidChange:p,didConnect:f,didDisconnect:_,unsubscribe:m}=function(e){let t=v(),n=v(),i=v(),r=null,o=e.events.didEnterState.subscribe(()=>{let o=z(e);o!==r&&t.notify(o),"connected"===r&&"connected"!==o?i.notify():"connected"!==r&&"connected"===o&&n.notify(),r=o});return{statusDidChange:t.observable,didConnect:n.observable,didDisconnect:i.observable,unsubscribe:o}}(o);return h.push(m),t.enableDebugLogging&&h.push(function(e){let t=new Date().getTime();function n(){for(var n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];E("".concat(((new Date().getTime()-t)/1e3).toFixed(2)," [FSM #").concat(e.id,"]"),...i)}let i=[e.events.didReceiveEvent.subscribe(e=>n("Event ".concat(e.type))),e.events.willTransition.subscribe(e=>{let{from:t,to:i}=e;return n("Transitioning",t,"â†’",i)}),e.events.didIgnoreEvent.subscribe(e=>n("Ignored event",e.type,e,"(current state won't handle it)"))];return()=>{for(let e of i)e()}}(o)),o.start(),{machine:o,cleanups:h,events:{statusDidChange:p,didConnect:f,didDisconnect:_,onMessage:n.observable,onLiveblocksError:i.observable}}}(e,{waitForActorId:n,enableDebugLogging:t});this.machine=i,this.events=r,this.cleanups=o}};function er(e){return e.includes("room:write")}function eo(e){return e.includes("comments:write")||e.includes("room:write")}function es(e){var t;let n=e.split(".");if(3!==n.length)throw Error("Authentication error: invalid JWT token");let i=N(function(e){try{let t=e.replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch(t){return atob(e)}}(n[1]));if(!(i&&C(t=i)&&("acc"===t.k||"id"===t.k||"sec-legacy"===t.k)))throw Error("Authentication error: expected a valid token but did not get one. Hint: if you are using a callback, ensure the room is passed when creating the token. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientCallback");return{raw:e,parsed:i}}async function ea(e,t,n){let i;let r=await e(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){let e="".concat((await r.text()).trim()||"reason not provided in auth response"," (").concat(r.status," returned by POST ").concat(t,")");if(401===r.status||403===r.status)throw new J("Unauthorized: ".concat(e));throw Error("Failed to authenticate: ".concat(e))}try{i=await r.json()}catch(e){throw Error('Expected a JSON response when doing a POST request on "'.concat(t,'". ').concat(String(e)))}if(!C(i)||"string"!=typeof i.token)throw Error('Expected a JSON response of the form `{ token: "..." }` when doing a POST request on "'.concat(t,'", but got ').concat(JSON.stringify(i)));let{token:o}=i;return{token:o}}var ed=Symbol();function el(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return"object"!=typeof e||null===e||Array.isArray(e)?JSON.stringify(e,...n):JSON.stringify(Object.keys(e).sort().reduce((t,n)=>(t[n]=e[n],t),{}),...n)}v().observable,Date.now();var ec=()=>{},eu=class{constructor(e){this.resolve=ec,this.reject=ec,this.promise=new Promise(ec),this.args=e}},eh=class{clearDelayTimeout(){void 0!==this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=void 0)}schedule(){this.queue.length===this.size?this.flush():1===this.queue.length&&(this.clearDelayTimeout(),this.delayTimeoutId=setTimeout(()=>void this.flush(),this.delay))}async flush(){if(0===this.queue.length)return;let e=this.queue.splice(0),t=e.map(e=>e.args);try{let n=await this.callback(t);this.error=!1,e.forEach((t,i)=>{let r=null==n?void 0:n[i];r instanceof Error?t.reject(r):void 0!==r?t.resolve(r):Array.isArray(n)?t.reject(Error("Batch callback must return an array of the same length as the number of calls in the batch. Expected ".concat(e.length,", but got ").concat(n.length,"."))):t.reject(Error("Batch callback must return an array."))})}catch(t){this.error=!0,e.forEach(e=>{e.reject(t)})}}get(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let i=this.queue.find(e=>el(e.args)===el(t));if(i)return i.promise;let r=new eu(t);return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),this.queue.push(r),this.schedule(),r.promise}clear(){this.queue=[],this.error=!1,this.clearDelayTimeout()}constructor(e,t){var n,i;this.queue=[],this.error=!1,this.callback=e,this.size=null!==(n=null==t?void 0:t.size)&&void 0!==n?n:50,this.delay=null!==(i=null==t?void 0:t.delay)&&void 0!==i?i:100}};function ep(e,t){let n=new eh(e,t),i=new Map,r=v();function o(e,t){t?i.set(e,t):i.delete(e),r.notify(t)}async function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let s=el(t);if(!i.has(s))try{o(s,{isLoading:!0});let e=await n.get(...t);o(s,{isLoading:!1,data:e})}catch(e){o(s,{isLoading:!1,error:e})}}return{...r,get:s,getState:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=el(t);return i.get(r)}}}function ef(e){let t=e,n=new Set;return{get:function(){return t},set:function(e){let i=e(t);if(t!==i)for(let e of(t=i,n))e(t)},subscribe:function(e){return n.add(e),e(t),()=>{n.delete(e)}}}}function e_(e){let t=e.editedAt?new Date(e.editedAt):void 0,n=new Date(e.createdAt),i=e.reactions.map(e=>({...e,createdAt:new Date(e.createdAt)}));if(e.body)return{...e,reactions:i,createdAt:n,editedAt:t};{let r=new Date(e.deletedAt);return{...e,reactions:i,createdAt:n,editedAt:t,deletedAt:r}}}function em(e){let t=e.updatedAt?new Date(e.updatedAt):void 0,n=new Date(e.createdAt),i=e.comments.map(e=>e_(e));return{...e,createdAt:n,updatedAt:t,comments:i}}function ev(e){let t=new Date(e.notifiedAt),n=e.readAt?new Date(e.readAt):null;return{...e,notifiedAt:t,readAt:n}}function ey(e){let t=new Date(e.deletedAt);return{...e,deletedAt:t}}function eg(e){let t=new Date(e.deletedAt);return{...e,deletedAt:t}}function eb(e,t,n){let i=new URL(t,e);return void 0!==n&&(i.search=(n instanceof URLSearchParams?n:function(e){let t=new URLSearchParams;for(let[n,i]of Object.entries(e))null!=i&&t.set(n,i.toString());return t}(n)).toString()),i.toString()}var eE=eT(0),ew=eT(1),eS=eE+eT(-1);function eT(e){let t=32+(e<0?95+e:e);if(t<32||t>126)throw Error("Invalid n value: ".concat(e));return String.fromCharCode(t)}function eO(e,t){return void 0!==e&&void 0!==t?function(e,t){if(e<t)return eI(e,t);if(e>t)return eI(t,e);throw Error("Cannot compute value between two equal positions")}(e,t):void 0!==e?function(e){for(let t=0;t<=e.length-1;t++){let n=e.charCodeAt(t);if(!(n>=126))return e.substring(0,t)+String.fromCharCode(n+1)}return e+ew}(e):void 0!==t?function(e){let t=e.length-1;for(let n=0;n<=t;n++){let i=e.charCodeAt(n);if(!(i<=32)){if(n!==t)return e.substring(0,n+1);if(33===i)return e.substring(0,n)+eS;return e.substring(0,n)+String.fromCharCode(i-1)}}return ew}(t):ew}function eI(e,t){let n=0,i=e.length,r=t.length;for(;;){let s=n<i?e.charCodeAt(n):32,a=n<r?t.charCodeAt(n):126;if(s===a){n++;continue}if(a-s!=1){var o;return((o=n)<e.length?e.substring(0,o):e+eE.repeat(o-e.length))+String.fromCharCode(a+s>>1)}{let t=n+1,i=e.substring(0,t);return i.length<t&&(i+=eE.repeat(t-i.length)),i+eI(e.substring(t),"")}}}function eA(e){return!function(e){if(""===e)return!1;let t=e.length-1,n=e.charCodeAt(t);if(n<33||n>126)return!1;for(let n=0;n<t;n++){let t=e.charCodeAt(n);if(t<32||t>126)return!1}return!0}(e)?function(e){let t=[];for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);t.push(i<32?32:i>126?126:i)}for(;t.length>0&&32===t[t.length-1];)t.length--;return t.length>0?String.fromCharCode(...t):ew}(e):e}var ek=((o=ek||{})[o.INIT=0]="INIT",o[o.SET_PARENT_KEY=1]="SET_PARENT_KEY",o[o.CREATE_LIST=2]="CREATE_LIST",o[o.UPDATE_OBJECT=3]="UPDATE_OBJECT",o[o.CREATE_OBJECT=4]="CREATE_OBJECT",o[o.DELETE_CRDT=5]="DELETE_CRDT",o[o.DELETE_OBJECT_KEY=6]="DELETE_OBJECT_KEY",o[o.CREATE_MAP=7]="CREATE_MAP",o[o.CREATE_REGISTER=8]="CREATE_REGISTER",o);function eC(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:eA(t);return Object.freeze({type:"HasParent",node:e,key:t,pos:n})}var eP=Object.freeze({type:"NoParent"}),eN=class{_getParentKeyOrThrow(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldKey;default:return _(this.parent,"Unknown state")}}get _parentPos(){switch(this.parent.type){case"HasParent":return this.parent.pos;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldPos;default:return _(this.parent,"Unknown state")}}get _pool(){return this.__pool}get roomId(){return this.__pool?this.__pool.roomId:null}get _id(){return this.__id}get parent(){return this._parent}get _parentKey(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":return null;case"Orphaned":return this.parent.oldKey;default:return _(this.parent,"Unknown state")}}_apply(e,t){return 5===e.type&&"HasParent"===this.parent.type?this.parent.node._detachChild(this):{modified:!1}}_setParentLink(e,t){switch(this.parent.type){case"HasParent":if(this.parent.node!==e)throw Error("Cannot set parent: node already has a parent");this._parent=eC(e,t);return;case"Orphaned":case"NoParent":this._parent=eC(e,t);return;default:return _(this.parent,"Unknown state")}}_attach(e,t){if(this.__id||this.__pool)throw Error("Cannot attach node: already attached");t.addNode(e,this),this.__id=e,this.__pool=t}_detach(){switch(this.__pool&&this.__id&&this.__pool.deleteNode(this.__id),this.parent.type){case"HasParent":this._parent=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eA(e);return Object.freeze({type:"Orphaned",oldKey:e,oldPos:t})}(this.parent.key,this.parent.pos);break;case"NoParent":this._parent=eP;break;case"Orphaned":break;default:_(this.parent,"Unknown state")}this.__pool=void 0}invalidate(){(void 0!==this._cachedImmutable||void 0!==this._cachedTreeNode)&&(this._cachedImmutable=void 0,this._cachedTreeNode=void 0,"HasParent"===this.parent.type&&this.parent.node.invalidate())}toTreeNode(e){return(void 0===this._cachedTreeNode||this._cachedTreeNodeKey!==e)&&(this._cachedTreeNodeKey=e,this._cachedTreeNode=this._toTreeNode(e)),this._cachedTreeNode}toImmutable(){return void 0===this._cachedImmutable&&(this._cachedImmutable=this._toImmutable()),this._cachedImmutable}constructor(){this._parent=eP}},eL=((s=eL||{})[s.OBJECT=0]="OBJECT",s[s.LIST=1]="LIST",s[s.MAP=2]="MAP",s[s.REGISTER=3]="REGISTER",s);function eR(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789,./;[]~!@#$%&*()_+=-",n=t.length;return Array.from({length:e},()=>t.charAt(Math.floor(Math.random()*n))).join("")}var eD=class e extends eN{get data(){return this._data}static _deserialize(t,n,i){let[r,o]=t,s=new e(o.data);return s._attach(r,i),s}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize register if parentId or parentKey is undefined");return[{type:8,opId:null==n?void 0:n.generateOpId(),id:this._id,parentId:e,parentKey:t,data:this.data}]}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveRegister if parent is missing");return{type:3,parentId:m(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key,data:this.data}}_attachChild(e){throw Error("Method not implemented.")}_detachChild(e){throw Error("Method not implemented.")}_apply(e,t){return super._apply(e,t)}_toTreeNode(e){var t;return{type:"Json",id:null!==(t=this._id)&&void 0!==t?t:eR(),key:e,payload:this._data}}_toImmutable(){return this._data}clone(){return L(this.data)}constructor(e){super(),this._data=e}};function ex(e,t){let n=e._parentPos,i=t._parentPos;return n===i?0:n<i?-1:1}var eU=class e extends eN{static _deserialize(t,n,i){let[r]=t,o=new e;o._attach(r,i);let s=n.get(r);if(void 0===s)return o;for(let[e,t]of s){let r=eY([e,t],n,i);r._setParentLink(o,t.parentKey),o._insertAndSort(r)}return o}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let i=[],r={id:this._id,opId:null==n?void 0:n.generateOpId(),type:2,parentId:e,parentKey:t};for(let e of(i.push(r),this._items)){let t=e._getParentKeyOrThrow(),r=eB(e._toOps(this._id,t,n),void 0),o=r[0].opId;void 0!==o&&this._unacknowledgedSets.set(t,o),i.push(...r)}return i}_insertAndSort(e){this._items.push(e),this._sortItems()}_sortItems(){this._items.sort(ex),this.invalidate()}_indexOfPosition(e){return this._items.findIndex(t=>t._getParentKeyOrThrow()===e)}_attach(e,t){for(let n of(super._attach(e,t),this._items))n._attach(t.generateId(),t)}_detach(){for(let e of(super._detach(),this._items))e._detach()}_applySetRemote(e){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:t,parentKey:n}=e,i=eq(e);i._attach(t,this._pool),i._setParentLink(this,n);let r=e.deletedId,o=this._indexOfPosition(n);if(-1!==o){let t=this._items[o];if(t._id===r)return t._detach(),this._items[o]=i,{modified:ej(this,[eK(o,i)]),reverse:[]};{this._implicitlyDeletedItems.add(t),this._items[o]=i;let n=[eK(o,i)],r=this._detachItemAssociatedToSetOperation(e.deletedId);return r&&n.push(r),{modified:ej(this,n),reverse:[]}}}{let t=[],r=this._detachItemAssociatedToSetOperation(e.deletedId);return r&&t.push(r),this._insertAndSort(i),t.push(ez(this._indexOfPosition(n),i)),{reverse:[],modified:ej(this,t)}}}_applySetAck(e){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let t=[],n=this._detachItemAssociatedToSetOperation(e.deletedId);n&&t.push(n);let i=this._unacknowledgedSets.get(e.parentKey);if(void 0!==i){if(i!==e.opId)return 0===t.length?{modified:!1}:{modified:ej(this,t),reverse:[]};this._unacknowledgedSets.delete(e.parentKey)}let r=this._indexOfPosition(e.parentKey),o=this._items.find(t=>t._id===e.id);if(void 0!==o){if(o._parentKey===e.parentKey)return{modified:t.length>0&&ej(this,t),reverse:[]};-1!==r&&(this._implicitlyDeletedItems.add(this._items[r]),this._items.splice(r,1),t.push(eH(r)));let n=this._items.indexOf(o);o._setParentLink(this,e.parentKey),this._sortItems();let i=this._items.indexOf(o);return i!==n&&t.push(eF(n,i,o)),{modified:t.length>0&&ej(this,t),reverse:[]}}{let n=this._pool.getNode(e.id);if(n&&this._implicitlyDeletedItems.has(n)){n._setParentLink(this,e.parentKey),this._implicitlyDeletedItems.delete(n),this._insertAndSort(n);let i=this._items.indexOf(n);return{modified:ej(this,[-1===r?ez(i,n):eK(i,n),...t]),reverse:[]}}{-1!==r&&this._items.splice(r,1);let{newItem:n,newIndex:i}=this._createAttachItemAndSort(e,e.parentKey);return{modified:ej(this,[-1===r?ez(i,n):eK(i,n),...t]),reverse:[]}}}}_detachItemAssociatedToSetOperation(e){if(void 0===e||void 0===this._pool)return null;let t=this._pool.getNode(e);if(void 0===t)return null;let n=this._detachChild(t);return!1===n.modified?null:n.modified.updates[0]}_applyRemoteInsert(e){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let t=eA(e.parentKey),n=this._indexOfPosition(t);-1!==n&&this._shiftItemPosition(n,t);let{newItem:i,newIndex:r}=this._createAttachItemAndSort(e,t);return{modified:ej(this,[ez(r,i)]),reverse:[]}}_applyInsertAck(e){let t=this._items.find(t=>t._id===e.id),n=eA(e.parentKey),i=this._indexOfPosition(n);if(t){if(t._parentKey===n)return{modified:!1};{let e=this._items.indexOf(t);-1!==i&&this._shiftItemPosition(i,n),t._setParentLink(this,n),this._sortItems();let r=this._indexOfPosition(n);return r===e?{modified:!1}:{modified:ej(this,[eF(e,r,t)]),reverse:[]}}}{let t=m(this._pool).getNode(e.id);if(t&&this._implicitlyDeletedItems.has(t))return t._setParentLink(this,n),this._implicitlyDeletedItems.delete(t),this._insertAndSort(t),{modified:ej(this,[ez(this._indexOfPosition(n),t)]),reverse:[]};{-1!==i&&this._shiftItemPosition(i,n);let{newItem:t,newIndex:r}=this._createAttachItemAndSort(e,n);return{modified:ej(this,[ez(r,t)]),reverse:[]}}}}_applyInsertUndoRedo(e){var t,n,i;let{id:r,parentKey:o}=e,s=eq(e);if((null===(t=this._pool)||void 0===t?void 0:t.getNode(r))!==void 0)return{modified:!1};s._attach(r,m(this._pool)),s._setParentLink(this,o);let a=this._indexOfPosition(o),d=o;return -1!==a&&(d=eO(null===(n=this._items[a])||void 0===n?void 0:n._parentPos,null===(i=this._items[a+1])||void 0===i?void 0:i._parentPos),s._setParentLink(this,d)),this._insertAndSort(s),{modified:ej(this,[ez(this._indexOfPosition(d),s)]),reverse:[{type:5,id:r}]}}_applySetUndoRedo(e){var t;let{id:n,parentKey:i}=e,r=eq(e);if((null===(t=this._pool)||void 0===t?void 0:t.getNode(n))!==void 0)return{modified:!1};this._unacknowledgedSets.set(i,m(e.opId));let o=this._indexOfPosition(i);if(r._attach(n,m(this._pool)),r._setParentLink(this,i),-1===o)return this._insertAndSort(r),this._detachItemAssociatedToSetOperation(e.deletedId),{reverse:[{type:5,id:n}],modified:ej(this,[ez(this._indexOfPosition(i),r)])};{let t=this._items[o];t._detach(),this._items[o]=r;let n=eB(t._toOps(m(this._id),i,this._pool),e.id),s=[eK(o,r)],a=this._detachItemAssociatedToSetOperation(e.deletedId);return a&&s.push(a),{modified:ej(this,s),reverse:n}}}_attachChild(e,t){let n;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");return!1!==(n="set"===e.intent?1===t?this._applySetRemote(e):2===t?this._applySetAck(e):this._applySetUndoRedo(e):1===t?this._applyRemoteInsert(e):2===t?this._applyInsertAck(e):this._applyInsertUndoRedo(e)).modified&&this.invalidate(),n}_detachChild(e){if(e){let t=m(e._parentKey),n=e._toOps(m(this._id),t,this._pool),i=this._items.indexOf(e);return -1===i?{modified:!1}:(this._items.splice(i,1),this.invalidate(),e._detach(),{modified:ej(this,[eH(i)]),reverse:n})}return{modified:!1}}_applySetChildKeyRemote(e,t){if(this._implicitlyDeletedItems.has(t))return this._implicitlyDeletedItems.delete(t),t._setParentLink(this,e),this._insertAndSort(t),{modified:ej(this,[ez(this._items.indexOf(t),t)]),reverse:[]};if(e===t._parentKey)return{modified:!1};let n=this._indexOfPosition(e);if(-1===n){let n=this._items.indexOf(t);t._setParentLink(this,e),this._sortItems();let i=this._items.indexOf(t);return i===n?{modified:!1}:{modified:ej(this,[eF(n,i,t)]),reverse:[]}}{var i;this._items[n]._setParentLink(this,eO(e,null===(i=this._items[n+1])||void 0===i?void 0:i._parentPos));let r=this._items.indexOf(t);t._setParentLink(this,e),this._sortItems();let o=this._items.indexOf(t);return o===r?{modified:!1}:{modified:ej(this,[eF(r,o,t)]),reverse:[]}}}_applySetChildKeyAck(e,t){var n,i;let r=m(t._parentKey);if(this._implicitlyDeletedItems.has(t)){let i=this._indexOfPosition(e);return this._implicitlyDeletedItems.delete(t),-1!==i&&this._items[i]._setParentLink(this,eO(e,null===(n=this._items[i+1])||void 0===n?void 0:n._parentPos)),t._setParentLink(this,e),this._insertAndSort(t),{modified:!1}}{if(e===r)return{modified:!1};let n=this._items.indexOf(t),o=this._indexOfPosition(e);-1!==o&&this._items[o]._setParentLink(this,eO(e,null===(i=this._items[o+1])||void 0===i?void 0:i._parentPos)),t._setParentLink(this,e),this._sortItems();let s=this._items.indexOf(t);return n===s?{modified:!1}:{modified:ej(this,[eF(n,s,t)]),reverse:[]}}}_applySetChildKeyUndoRedo(e,t){let n=m(t._parentKey),i=this._items.indexOf(t),r=this._indexOfPosition(e);if(-1!==r){var o;this._items[r]._setParentLink(this,eO(e,null===(o=this._items[r+1])||void 0===o?void 0:o._parentPos))}t._setParentLink(this,e),this._sortItems();let s=this._items.indexOf(t);return i===s?{modified:!1}:{modified:ej(this,[eF(i,s,t)]),reverse:[{type:1,id:m(t._id),parentKey:n}]}}_setChildKey(e,t,n){return 1===n?this._applySetChildKeyRemote(e,t):2===n?this._applySetChildKeyAck(e,t):this._applySetChildKeyUndoRedo(e,t)}_apply(e,t){return super._apply(e,t)}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveList if parent is missing");return{type:1,parentId:m(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get length(){return this._items.length}push(e){var t;return null===(t=this._pool)||void 0===t||t.assertStorageIsWritable(),this.insert(e,this.length)}insert(e,t){var n;if(null===(n=this._pool)||void 0===n||n.assertStorageIsWritable(),t<0||t>this._items.length)throw Error('Cannot insert list item at index "\x1d'.concat(t,'". index should be between 0 and ').concat(this._items.length));let i=eO(this._items[t-1]?this._items[t-1]._parentPos:void 0,this._items[t]?this._items[t]._parentPos:void 0),r=e0(e);if(r._setParentLink(this,i),this._insertAndSort(r),this._pool&&this._id){let e=this._pool.generateId();r._attach(e,this._pool),this._pool.dispatch(r._toOps(this._id,i,this._pool),[{type:5,id:e}],new Map([[this._id,ej(this,[ez(t,r)])]]))}}move(e,t){var n;if(null===(n=this._pool)||void 0===n||n.assertStorageIsWritable(),t<0)throw Error("targetIndex cannot be less than 0");if(t>=this._items.length)throw Error("targetIndex cannot be greater or equal than the list length");if(e<0)throw Error("index cannot be less than 0");if(e>=this._items.length)throw Error("index cannot be greater or equal than the list length");let i=null,r=null;e<t?(r=t===this._items.length-1?void 0:this._items[t+1]._parentPos,i=this._items[t]._parentPos):(r=this._items[t]._parentPos,i=0===t?void 0:this._items[t-1]._parentPos);let o=eO(i,r),s=this._items[e],a=s._getParentKeyOrThrow();if(s._setParentLink(this,o),this._sortItems(),this._pool&&this._id){let n=new Map([[this._id,ej(this,[eF(e,t,s)])]]);this._pool.dispatch([{type:1,id:m(s._id),opId:this._pool.generateOpId(),parentKey:o}],[{type:1,id:m(s._id),parentKey:a}],n)}}delete(e){var t;if(null===(t=this._pool)||void 0===t||t.assertStorageIsWritable(),e<0||e>=this._items.length)throw Error('Cannot delete list item at index "'.concat(e,'". index should be between 0 and ').concat(this._items.length-1));let n=this._items[e];if(n._detach(),this._items.splice(e,1),this.invalidate(),this._pool){let t=n._id;if(t){let i=new Map;i.set(m(this._id),ej(this,[eH(e)])),this._pool.dispatch([{id:t,opId:this._pool.generateOpId(),type:5}],n._toOps(m(this._id),n._getParentKeyOrThrow()),i)}}}clear(){var e;if(null===(e=this._pool)||void 0===e||e.assertStorageIsWritable(),this._pool){let e=[],t=[],n=[];for(let i of this._items){i._detach();let r=i._id;r&&(e.push({type:5,id:r,opId:this._pool.generateOpId()}),t.push(...i._toOps(m(this._id),i._getParentKeyOrThrow())),n.push(eH(0)))}this._items=[],this.invalidate();let i=new Map;i.set(m(this._id),ej(this,n)),this._pool.dispatch(e,t,i)}else{for(let e of this._items)e._detach();this._items=[],this.invalidate()}}set(e,t){var n;if(null===(n=this._pool)||void 0===n||n.assertStorageIsWritable(),e<0||e>=this._items.length)throw Error('Cannot set list item at index "\x1d'.concat(e,'". index should be between 0 and ').concat(this._items.length-1));let i=this._items[e],r=i._getParentKeyOrThrow(),o=i._id;i._detach();let s=e0(t);if(s._setParentLink(this,r),this._items[e]=s,this.invalidate(),this._pool&&this._id){let t=this._pool.generateId();s._attach(t,this._pool);let n=new Map;n.set(this._id,ej(this,[eK(e,s)]));let a=eB(s._toOps(this._id,r,this._pool),o);this._unacknowledgedSets.set(r,m(a[0].opId));let d=eB(i._toOps(this._id,r,void 0),t);this._pool.dispatch(a,d,n)}}toArray(){return this._items.map(e=>e$(e))}every(e){return this.toArray().every(e)}filter(e){return this.toArray().filter(e)}find(e){return this.toArray().find(e)}findIndex(e){return this.toArray().findIndex(e)}forEach(e){return this.toArray().forEach(e)}get(e){if(!(e<0)&&!(e>=this._items.length))return e$(this._items[e])}indexOf(e,t){return this.toArray().indexOf(e,t)}lastIndexOf(e,t){return this.toArray().lastIndexOf(e,t)}map(e){return this._items.map((t,n)=>e(e$(t),n))}some(e){return this.toArray().some(e)}[Symbol.iterator](){return new eM(this._items)}_createAttachItemAndSort(e,t){let n=eq(e);return n._attach(e.id,m(this._pool)),n._setParentLink(this,t),this._insertAndSort(n),{newItem:n,newIndex:this._indexOfPosition(t)}}_shiftItemPosition(e,t){var n;let i=eO(t,this._items.length>e+1?null===(n=this._items[e+1])||void 0===n?void 0:n._parentPos:void 0);this._items[e]._setParentLink(this,i)}_toTreeNode(e){var t;return{type:"LiveList",id:null!==(t=this._id)&&void 0!==t?t:eR(),key:e,payload:this._items.map((e,t)=>e.toTreeNode(t.toString()))}}toImmutable(){return super.toImmutable()}_toImmutable(){return this._items.map(e=>e.toImmutable())}clone(){return new e(this._items.map(e=>e.clone()))}constructor(e=[]){let t;for(let n of(super(),this._items=[],this._implicitlyDeletedItems=new WeakSet,this._unacknowledgedSets=new Map,e)){let e=eO(t),i=e0(n);i._setParentLink(this,e),this._items.push(i),t=e}}},eM=class{[Symbol.iterator](){return this}next(){let e=this._innerIterator.next();return e.done?{done:!0,value:void 0}:{value:e$(e.value)}}constructor(e){this._innerIterator=e[Symbol.iterator]()}};function ej(e,t){return{node:e,type:"LiveList",updates:t}}function eK(e,t){return{index:e,type:"set",item:t instanceof eD?t.data:t}}function eH(e){return{index:e,type:"delete"}}function ez(e,t){return{index:e,type:"insert",item:t instanceof eD?t.data:t}}function eF(e,t,n){return{index:t,type:"move",previousIndex:e,item:n instanceof eD?n.data:n}}function eB(e,t){return e.map((e,n)=>0===n?{...e,intent:"set",deletedId:t}:e)}var eW=e=>e,eJ=class e extends eN{_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let i=[],r={id:this._id,opId:null==n?void 0:n.generateOpId(),type:7,parentId:e,parentKey:t};for(let[e,t]of(i.push(r),this._map))i.push(...t._toOps(this._id,e,n));return i}static _deserialize(t,n,i){let[r,o]=t,s=new e;s._attach(r,i);let a=n.get(r);if(void 0===a)return s;for(let[e,t]of a){let r=eY([e,t],n,i);r._setParentLink(s,t.parentKey),s._map.set(t.parentKey,r),s.invalidate()}return s}_attach(e,t){for(let[n,i]of(super._attach(e,t),this._map))eQ(i)&&i._attach(t.generateId(),t)}_attachChild(e,t){let n;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:i,parentKey:r,opId:o}=e,s=eq(e);if(void 0!==this._pool.getNode(i))return{modified:!1};if(2===t){let e=this.unacknowledgedSet.get(r);if(e===o)return this.unacknowledgedSet.delete(r),{modified:!1};if(void 0!==e)return{modified:!1}}else 1===t&&this.unacknowledgedSet.delete(r);let a=this._map.get(r);if(a){let e=m(this._id);n=a._toOps(e,r),a._detach()}else n=[{type:5,id:i}];return s._setParentLink(this,r),s._attach(i,this._pool),this._map.set(r,s),this.invalidate(),{modified:{node:this,type:"LiveMap",updates:{[r]:{type:"update"}}},reverse:n}}_detach(){for(let e of(super._detach(),this._map.values()))e._detach()}_detachChild(e){let t=m(this._id),n=m(e._parentKey),i=e._toOps(t,n,this._pool);for(let[t,n]of this._map)n===e&&(this._map.delete(t),this.invalidate());return e._detach(),{modified:{node:this,type:"LiveMap",updates:{[n]:{type:"delete"}}},reverse:i}}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveMap if parent is missing");return{type:2,parentId:m(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get(e){let t=this._map.get(e);if(void 0!==t)return e$(t)}set(e,t){var n;null===(n=this._pool)||void 0===n||n.assertStorageIsWritable();let i=this._map.get(e);i&&i._detach();let r=e0(t);if(r._setParentLink(this,e),this._map.set(e,r),this.invalidate(),this._pool&&this._id){let t=this._pool.generateId();r._attach(t,this._pool);let n=new Map;n.set(this._id,{node:this,type:"LiveMap",updates:{[e]:{type:"update"}}});let o=r._toOps(this._id,e,this._pool);this.unacknowledgedSet.set(e,m(o[0].opId)),this._pool.dispatch(r._toOps(this._id,e,this._pool),i?i._toOps(this._id,e):[{type:5,id:t}],n)}}get size(){return this._map.size}has(e){return this._map.has(e)}delete(e){var t;null===(t=this._pool)||void 0===t||t.assertStorageIsWritable();let n=this._map.get(e);if(void 0===n)return!1;if(n._detach(),this._map.delete(e),this.invalidate(),this._pool&&n._id){let t=m(this._id),i=new Map;i.set(t,{node:this,type:"LiveMap",updates:{[e]:{type:"delete"}}}),this._pool.dispatch([{type:5,id:n._id,opId:this._pool.generateOpId()}],n._toOps(t,e),i)}return!0}entries(){let e=this._map.entries();return{[Symbol.iterator](){return this},next(){let t=e.next();return t.done?{done:!0,value:void 0}:{value:[t.value[0],e$(t.value[1])]}}}}[Symbol.iterator](){return this.entries()}keys(){return this._map.keys()}values(){let e=this._map.values();return{[Symbol.iterator](){return this},next(){let t=e.next();return t.done?{done:!0,value:void 0}:{value:e$(t.value)}}}}forEach(e){for(let t of this)e(t[1],t[0],this)}_toTreeNode(e){var t;return{type:"LiveMap",id:null!==(t=this._id)&&void 0!==t?t:eR(),key:e,payload:Array.from(this._map.entries()).map(e=>{let[t,n]=e;return n.toTreeNode(t)})}}toImmutable(){return super.toImmutable()}_toImmutable(){let e=new Map;for(let[t,n]of this._map)e.set(t,n.toImmutable());return eW(e)}clone(){return new e(Array.from(this._map).map(e=>{let[t,n]=e;return[t,n.clone()]}))}constructor(e){if(super(),this.unacknowledgedSet=new Map,e){let t=[];for(let[n,i]of e){let e=e0(i);e._setParentLink(this,n),t.push([n,e])}this._map=new Map(t)}else this._map=new Map}},eV=class e extends eN{static _buildRootAndParentToChildren(e){let t=new Map,n=null;for(let[i,r]of e)if(0!==r.type||void 0!==r.parentId&&void 0!==r.parentKey){let e=[i,r],n=t.get(r.parentId);void 0!==n?n.push(e):t.set(r.parentId,[e])}else n=[i,r];if(null===n)throw Error("Root can't be null");return[n,t]}static _fromItems(t,n){let[i,r]=e._buildRootAndParentToChildren(t);return e._deserialize(i,r,n)}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let i=null==n?void 0:n.generateOpId(),r=[],o={type:4,id:this._id,opId:i,parentId:e,parentKey:t,data:{}};for(let[e,t]of(r.push(o),this._map))eQ(t)?r.push(...t._toOps(this._id,e,n)):o.data[e]=t;return r}static _deserialize(t,n,i){let[r,o]=t,s=new e(o.data);return s._attach(r,i),this._deserializeChildren(s,n,i)}static _deserializeChildren(e,t,n){let i=t.get(m(e._id));if(void 0===i)return e;for(let[r,o]of i){let i=function(e,t,n){let[i,r]=e;switch(r.type){case 0:return eV._deserialize([i,r],t,n);case 1:return eU._deserialize([i,r],t,n);case 2:return eJ._deserialize([i,r],t,n);case 3:return r.data;default:throw Error("Unexpected CRDT type")}}([r,o],t,n);eX(i)&&i._setParentLink(e,o.parentKey),e._map.set(o.parentKey,i),e.invalidate()}return e}_attach(e,t){for(let[n,i]of(super._attach(e,t),this._map))eQ(i)&&i._attach(t.generateId(),t)}_attachChild(e,t){let n;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:i,opId:r,parentKey:o}=e,s=eG(e);if(void 0!==this._pool.getNode(i))return this._propToLastUpdate.get(o)===r&&this._propToLastUpdate.delete(o),{modified:!1};if(0===t)this._propToLastUpdate.set(o,m(r));else if(void 0===this._propToLastUpdate.get(o));else if(this._propToLastUpdate.get(o)===r)return this._propToLastUpdate.delete(o),{modified:!1};else return{modified:!1};let a=m(this._id),d=this._map.get(o);return eQ(d)?(n=d._toOps(a,o),d._detach()):n=void 0===d?[{type:6,id:a,key:o}]:[{type:3,id:a,data:{[o]:d}}],this._map.set(o,s),this.invalidate(),eX(s)&&(s._setParentLink(this,o),s._attach(i,this._pool)),{reverse:n,modified:{node:this,type:"LiveObject",updates:{[o]:{type:"update"}}}}}_detachChild(e){if(e){let t=m(this._id),n=m(e._parentKey),i=e._toOps(t,n,this._pool);for(let[t,n]of this._map)n===e&&(this._map.delete(t),this.invalidate());return e._detach(),{modified:{node:this,type:"LiveObject",updates:{[n]:{type:"delete"}}},reverse:i}}return{modified:!1}}_detach(){for(let e of(super._detach(),this._map.values()))eQ(e)&&e._detach()}_apply(e,t){return 3===e.type?this._applyUpdate(e,t):6===e.type?this._applyDeleteObjectKey(e,t):super._apply(e,t)}_serialize(){let e={};for(let[t,n]of this._map)eQ(n)||(e[t]=n);return"HasParent"===this.parent.type&&this.parent.node._id?{type:0,parentId:this.parent.node._id,parentKey:this.parent.key,data:e}:{type:0,data:e}}_applyUpdate(e,t){let n=!1,i=m(this._id),r=[],o={type:3,id:i,data:{}};for(let t in e.data){let e=this._map.get(t);eQ(e)?(r.push(...e._toOps(i,t)),e._detach()):void 0!==e?o.data[t]=e:void 0===e&&r.push({type:6,id:i,key:t})}let s={};for(let i in e.data){let r=e.data[i];if(void 0===r)continue;if(t)this._propToLastUpdate.set(i,m(e.opId));else if(void 0===this._propToLastUpdate.get(i))n=!0;else{if(this._propToLastUpdate.get(i)!==e.opId)continue;this._propToLastUpdate.delete(i);continue}let o=this._map.get(i);eQ(o)&&o._detach(),n=!0,s[i]={type:"update"},this._map.set(i,r),this.invalidate()}return 0!==Object.keys(o.data).length&&r.unshift(o),n?{modified:{node:this,type:"LiveObject",updates:s},reverse:r}:{modified:!1}}_applyDeleteObjectKey(e,t){let n=e.key;if(!1===this._map.has(n)||!t&&void 0!==this._propToLastUpdate.get(n))return{modified:!1};let i=this._map.get(n),r=m(this._id),o=[];return eQ(i)?(o=i._toOps(r,e.key),i._detach()):void 0!==i&&(o=[{type:3,id:r,data:{[n]:i}}]),this._map.delete(n),this.invalidate(),{modified:{node:this,type:"LiveObject",updates:{[e.key]:{type:"delete"}}},reverse:o}}toObject(){return Object.fromEntries(this._map)}set(e,t){var n;null===(n=this._pool)||void 0===n||n.assertStorageIsWritable(),this.update({[e]:t})}get(e){return this._map.get(e)}delete(e){var t;let n;null===(t=this._pool)||void 0===t||t.assertStorageIsWritable();let i=this._map.get(e);if(void 0===i)return;if(void 0===this._pool||void 0===this._id){eQ(i)&&i._detach(),this._map.delete(e),this.invalidate();return}eQ(i)?(i._detach(),n=i._toOps(this._id,e)):n=[{type:3,data:{[e]:i},id:this._id}],this._map.delete(e),this.invalidate();let r=new Map;r.set(this._id,{node:this,type:"LiveObject",updates:{[e]:{type:"delete"}}}),this._pool.dispatch([{type:6,key:e,id:this._id,opId:this._pool.generateOpId()}],n,r)}update(e){var t;if(null===(t=this._pool)||void 0===t||t.assertStorageIsWritable(),void 0===this._pool||void 0===this._id){for(let t in e){let n=e[t];if(void 0===n)continue;let i=this._map.get(t);eQ(i)&&i._detach(),eQ(n)&&n._setParentLink(this,t),this._map.set(t,n),this.invalidate()}return}let n=[],i=[],r=this._pool.generateOpId(),o={},s={id:this._id,type:3,data:{}},a={};for(let t in e){let d=e[t];if(void 0===d)continue;let l=this._map.get(t);if(eQ(l)?(i.push(...l._toOps(this._id,t)),l._detach()):void 0===l?i.push({type:6,id:this._id,key:t}):s.data[t]=l,eQ(d)){d._setParentLink(this,t),d._attach(this._pool.generateId(),this._pool);let e=d._toOps(this._id,t,this._pool),i=e.find(e=>e.parentId===this._id);i&&this._propToLastUpdate.set(t,m(i.opId)),n.push(...e)}else o[t]=d,this._propToLastUpdate.set(t,r);this._map.set(t,d),this.invalidate(),a[t]={type:"update"}}0!==Object.keys(s.data).length&&i.unshift(s),0!==Object.keys(o).length&&n.unshift({opId:r,id:this._id,type:3,data:o});let d=new Map;d.set(this._id,{node:this,type:"LiveObject",updates:a}),this._pool.dispatch(n,i,d)}toImmutable(){return super.toImmutable()}toTreeNode(e){return super.toTreeNode(e)}_toTreeNode(e){var t;let n=null!==(t=this._id)&&void 0!==t?t:eR();return{type:"LiveObject",id:n,key:e,payload:Array.from(this._map.entries()).map(e=>{let[t,i]=e;return eQ(i)?i.toTreeNode(t):{type:"Json",id:"".concat(n,":").concat(t),key:t,payload:i}})}}_toImmutable(){let e={};for(let[t,n]of this._map)e[t]=eX(n)?n.toImmutable():n;return e}clone(){return new e(Object.fromEntries(Array.from(this._map).map(e=>{let[t,n]=e;return[t,eX(n)?n.clone():L(n)]})))}constructor(e={}){for(let t in super(),this._propToLastUpdate=new Map,e){let n=e[t];void 0!==n&&eQ(n)&&n._setParentLink(this,t)}this._map=new Map(Object.entries(e))}};function eq(e){return e0(eG(e))}function eG(e){switch(e.type){case 8:return e.data;case 4:return new eV(e.data);case 7:return new eJ;case 2:return new eU;default:return _(e,"Unknown creation Op")}}function eY(e,t,n){let[i,r]=e;switch(r.type){case 0:return eV._deserialize([i,r],t,n);case 1:return eU._deserialize([i,r],t,n);case 2:return eJ._deserialize([i,r],t,n);case 3:return eD._deserialize([i,r],t,n);default:throw Error("Unexpected CRDT type")}}function eX(e){return eZ(e)||e instanceof eJ||e instanceof eV}function eQ(e){return eX(e)||e instanceof eD}function eZ(e){return e instanceof eU}function e$(e){return e instanceof eD?e.data:e instanceof eU||e instanceof eJ||e instanceof eV?e:_(e,"Unknown AbstractCrdt")}function e0(e){return e instanceof eV||e instanceof eJ||e instanceof eU?e:new eD(e)}function e1(e,t){return void 0===e?t:"LiveObject"===e.type&&"LiveObject"===t.type?function(e,t){let n=e.updates;for(let[e,i]of P(t.updates))n[e]=i;return{...t,updates:n}}(e,t):"LiveMap"===e.type&&"LiveMap"===t.type?function(e,t){let n=e.updates;for(let[e,i]of P(t.updates))n[e]=i;return{...t,updates:n}}(e,t):"LiveList"===e.type&&"LiveList"===t.type?function(e,t){let n=e.updates;return{...t,updates:n.concat(t.updates)}}(e,t):t}function e2(e){return Array.isArray(e)}var e3=((a=e3||{})[a.UPDATE_PRESENCE=100]="UPDATE_PRESENCE",a[a.BROADCAST_EVENT=103]="BROADCAST_EVENT",a[a.FETCH_STORAGE=200]="FETCH_STORAGE",a[a.UPDATE_STORAGE=201]="UPDATE_STORAGE",a[a.FETCH_YDOC=300]="FETCH_YDOC",a[a.UPDATE_YDOC=301]="UPDATE_YDOC",a);function e4(e,t){let n=!1,i={...e};return Object.keys(t).forEach(e=>{let r=t[e];i[e]!==r&&(void 0===r?delete i[e]:i[e]=r,n=!0)}),n?i:e}var e5=class{get didInvalidate(){return this._ev.observable}invalidate(){void 0!==this._cache&&(this._cache=void 0,this._ev.notify())}get current(){var e;return null!==(e=this._cache)&&void 0!==e?e:this._cache=this._toImmutable()}constructor(){this._ev=v()}},e6=class extends e5{connectionIds(){return this._connections.keys()}_toImmutable(){return R(Array.from(this._presences.keys()).map(e=>this.getUser(Number(e))))}clearOthers(){this._connections=new Map,this._presences=new Map,this._users=new Map,this.invalidate()}_getUser(e){let t=this._connections.get(e),n=this._presences.get(e);if(void 0!==t&&void 0!==n)return function(e,t){let{connectionId:n,id:i,info:r}=e,o=er(e.scopes);return eW(D({connectionId:n,id:i,info:r,canWrite:o,canComment:eo(e.scopes),isReadOnly:!o,presence:t}))}(t,n)}getUser(e){let t=this._users.get(e);if(t)return t;let n=this._getUser(e);if(n)return this._users.set(e,n),n}_invalidateUser(e){this._users.has(e)&&this._users.delete(e),this.invalidate()}setConnection(e,t,n,i){this._connections.set(e,eW({connectionId:e,id:t,info:n,scopes:i})),this._presences.has(e)&&this._invalidateUser(e)}removeConnection(e){this._connections.delete(e),this._presences.delete(e),this._invalidateUser(e)}setOther(e,t){this._presences.set(e,eW(D(t))),this._connections.has(e)&&this._invalidateUser(e)}patchOther(e,t){let n=this._presences.get(e);if(void 0===n)return;let i=e4(n,t);n!==i&&(this._presences.set(e,eW(i)),this._invalidateUser(e))}constructor(){super(),this._connections=new Map,this._presences=new Map,this._users=new Map}},e9=class extends e5{_toImmutable(){return this._data}patch(e){let t=this._data,n=e4(t,e);t!==n&&(this._data=eW(n),this.invalidate())}constructor(e){super(),this._data=eW(D(e))}},e7=class extends e5{_toImmutable(){return this._value}set(e){this._value=eW(e),this.invalidate()}constructor(e){super(),this._value=eW(e)}},e8=class extends e5{_toImmutable(){return this._transform(...this._refs.map(e=>e.current))}constructor(...e){super();let t=e.pop();this._refs=e,this._refs.forEach(e=>{e.didInvalidate.subscribe(()=>this.invalidate())}),this._transform=t}};function te(e,t){return{type:"User",id:"".concat(t.connectionId),key:e,payload:t}}var tt=class extends Error{constructor(e,t,n){super(e),this.message=e,this.status=t,this.details=n}};function tn(e,t){return e.updatedAt&&t.updatedAt?e.updatedAt>t.updatedAt?1:e.updatedAt<t.updatedAt?-1:0:e.updatedAt||t.updatedAt?e.updatedAt?1:-1:e.createdAt>t.createdAt?1:e.createdAt<t.createdAt?-1:0}function ti(e){let t={threads:{...e.threads},inboxNotifications:{...e.inboxNotifications},notificationSettings:{...e.notificationSettings}};for(let n of e.optimisticUpdates)switch(n.type){case"create-thread":t.threads[n.thread.id]=n.thread;break;case"edit-thread-metadata":{let e=t.threads[n.threadId];if(void 0===e||void 0!==e.deletedAt||void 0!==e.updatedAt&&e.updatedAt>n.updatedAt)break;t.threads[e.id]={...e,updatedAt:n.updatedAt,metadata:{...e.metadata,...n.metadata}};break}case"create-comment":{let e=t.threads[n.comment.threadId];if(void 0===e)break;t.threads[e.id]=tr(e,n.comment);let i=Object.values(t.inboxNotifications).find(t=>t.threadId===e.id);if(void 0===i)break;t.inboxNotifications[i.id]={...i,notifiedAt:n.comment.createdAt,readAt:n.comment.createdAt};break}case"edit-comment":{let e=t.threads[n.comment.threadId];if(void 0===e)break;t.threads[e.id]=tr(e,n.comment);break}case"delete-comment":{let e=t.threads[n.threadId];if(void 0===e)break;t.threads[e.id]=to(e,n.commentId,n.deletedAt);break}case"add-reaction":{let e=t.threads[n.threadId];if(void 0===e)break;t.threads[e.id]=ts(e,n.commentId,n.reaction);break}case"remove-reaction":{let e=t.threads[n.threadId];if(void 0===e)break;t.threads[e.id]=ta(e,n.commentId,n.emoji,n.userId,n.removedAt);break}case"mark-inbox-notification-as-read":t.inboxNotifications[n.inboxNotificationId]={...e.inboxNotifications[n.inboxNotificationId],readAt:n.readAt};break;case"mark-inbox-notifications-as-read":for(let e in t.inboxNotifications)t.inboxNotifications[e]={...t.inboxNotifications[e],readAt:n.readAt};break;case"update-notification-settings":t.notificationSettings[n.roomId]={...t.notificationSettings[n.roomId],...n.settings}}return t}function tr(e,t){var n,i,r;if(void 0!==e.deletedAt)return e;if(t.threadId!==e.id)return E("Comment ".concat(t.id," does not belong to thread ").concat(e.id)),e;let o=e.comments.find(e=>e.id===t.id);if(void 0===o){let i=new Date(Math.max((null===(n=e.updatedAt)||void 0===n?void 0:n.getTime())||0,t.createdAt.getTime()));return{...e,updatedAt:i,comments:[...e.comments,t]}}if(void 0!==o.deletedAt)return e;if(void 0===o.editedAt||void 0===t.editedAt||o.editedAt<=t.editedAt){let n=e.comments.map(e=>e.id===t.id?t:e);return{...e,updatedAt:new Date(Math.max((null===(i=e.updatedAt)||void 0===i?void 0:i.getTime())||0,(null===(r=t.editedAt)||void 0===r?void 0:r.getTime())||t.createdAt.getTime())),comments:n}}return e}function to(e,t,n){if(void 0!==e.deletedAt)return e;let i=e.comments.find(e=>e.id===t);if(void 0===i||void 0!==i.deletedAt)return e;let r=e.comments.map(e=>e.id===t?{...e,deletedAt:n,body:void 0}:e);return r.some(e=>void 0===e.deletedAt)?{...e,updatedAt:n,comments:r}:{...e,deletedAt:n,updatedAt:n,comments:[]}}function ts(e,t,n){var i;if(void 0!==e.deletedAt)return e;let r=e.comments.find(e=>e.id===t);if(void 0===r||void 0!==r.deletedAt)return e;let o=e.comments.map(e=>e.id===t?{...e,reactions:function(e,t){let n=e.find(e=>e.emoji===t.emoji);return void 0===n?[...e,{emoji:t.emoji,createdAt:t.createdAt,users:[{id:t.userId}]}]:!1===n.users.some(e=>e.id===t.userId)?e.map(e=>e.emoji===t.emoji?{...e,users:[...e.users,{id:t.userId}]}:e):e}(e.reactions,n)}:e);return{...e,updatedAt:new Date(Math.max(n.createdAt.getTime(),(null===(i=e.updatedAt)||void 0===i?void 0:i.getTime())||0)),comments:o}}function ta(e,t,n,i,r){var o;if(void 0!==e.deletedAt)return e;let s=e.comments.find(e=>e.id===t);if(void 0===s||void 0!==s.deletedAt)return e;let a=e.comments.map(e=>e.id===t?{...e,reactions:e.reactions.map(e=>e.emoji===n?{...e,users:e.users.filter(e=>e.id!==i)}:e).filter(e=>e.users.length>0)}:e);return{...e,updatedAt:new Date(Math.max(r.getTime(),(null===(o=e.updatedAt)||void 0===o?void 0:o.getTime())||0)),comments:a}}function td(e){return"public"===e.type?e.publicApiKey:e.token.raw}function tl(e){var t,n,i,r;let o=tu("throttle",null!==(n=e.throttle)&&void 0!==n?n:100,16,1e3),s=tu("lostConnectionTimeout",null!==(i=e.lostConnectionTimeout)&&void 0!==i?i:5e3,200,3e4,1e3),a=function(e){if(void 0!==e)return tu("backgroundKeepAliveTimeout",e,15e3)}(e.backgroundKeepAliveTimeout),l=((r=e.baseUrl)||(r=d.env.LIVEBLOCKS_BASE_URL||d.env.NEXT_PUBLIC_LIVEBLOCKS_BASE_URL||d.env.VITE_LIVEBLOCKS_BASE_URL||void 0),"string"==typeof r&&r.startsWith("http"))?r:"https://api.liveblocks.io",c=function(e){let t=function(e){let{publicApiKey:t,authEndpoint:n}=e;if(void 0!==n&&void 0!==t)throw Error("You cannot simultaneously use `publicApiKey` and `authEndpoint` options. Please pick one and leave the other option unspecified. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient");if("string"==typeof t){if(t.startsWith("sk_"))throw Error("Invalid `publicApiKey` option. The value you passed is a secret key, which should not be used from the client. Please only ever pass a public key here. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");if(!t.startsWith("pk_"))throw Error("Invalid key. Please use the public key format: pk_<public key>. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");return{type:"public",publicApiKey:t}}if("string"==typeof n)return{type:"private",url:n};if("function"==typeof n)return{type:"custom",callback:n};if(void 0!==n)throw Error("The `authEndpoint` option must be a string or a function. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientAuthEndpoint");throw Error("Invalid Liveblocks client options. Please provide either a `publicApiKey` or `authEndpoint` option. They cannot both be empty. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient")}(e),n=new Set,i=[],r=[],o=new Map;function s(e,t){return"comments:read"===e?t.includes("comments:read")||t.includes("comments:write")||t.includes("room:read")||t.includes("room:write"):"room:read"===e&&(t.includes("room:read")||t.includes("room:write"))}async function a(i){var r,o;let s=null!==(o=null===(r=e.polyfills)||void 0===r?void 0:r.fetch)&&void 0!==o?o:window.fetch;if("private"===t.type){if(void 0===s)throw new J("To use Liveblocks client in a non-DOM environment with a url as auth endpoint, you need to provide a fetch polyfill.");let e=es((await ea(s,t.url,{room:i.roomId})).token);if(d(e,i),n.has(e.raw))throw new J("The same Liveblocks auth token was issued from the backend before. Caching Liveblocks tokens is not supported.");return e}if("custom"===t.type){let e=await t.callback(i.roomId);if(e&&"object"==typeof e){if("string"==typeof e.token){let t=es(e.token);return d(t,i),t}if("string"==typeof e.error){let t="Authentication failed: ".concat("reason"in e&&"string"==typeof e.reason?e.reason:"Forbidden");if("forbidden"===e.error)throw new J(t);throw Error(t)}}throw Error('Your authentication callback function should return a token, but it did not. Hint: the return value should look like: { token: "..." }')}throw Error("Unexpected authentication type. Must be private or custom.")}function d(e,t){if(!t.roomId&&"acc"===e.parsed.k&&0!==Object.entries(e.parsed.perms).length){for(let[n,i]of Object.entries(e.parsed.perms))if(n.includes("*")&&s(t.requestedScope,i))return;throw new J("The issued access token doesn't grant enough permissions. Please follow the instructions at https://liveblocks.io/docs/errors/liveblocks-client/access-tokens-not-enough-permissions")}}return{reset:function(){n.clear(),i.length=0,r.length=0,o.clear()},getAuthValue:async function(e){let d;if("public"===t.type)return{type:"public",publicApiKey:t.publicApiKey};let l=function(e){let t=Math.ceil(Date.now()/1e3);for(let n=i.length-1;n>=0;n--){let o=i[n];if(r[n]<=t){i.splice(n,1),r.splice(n,1);continue}if("id"===o.parsed.k)return o;if("acc"===o.parsed.k){if(!e.roomId&&0===Object.entries(o.parsed.perms).length)return o;for(let[t,n]of Object.entries(o.parsed.perms))if(e.roomId){if(t.includes("*")&&e.roomId.startsWith(t.replace("*",""))||e.roomId===t&&s(e.requestedScope,n))return o}else if(t.includes("*")&&s(e.requestedScope,n))return o}}}(e);if(void 0!==l)return{type:"secret",token:l};e.roomId?void 0===(d=o.get(e.roomId))&&(d=a(e),o.set(e.roomId,d)):void 0===(d=o.get("liveblocks-user-token"))&&(d=a(e),o.set("liveblocks-user-token",d));try{let e=await d,t=Math.floor(Date.now()/1e3)+(e.parsed.exp-e.parsed.iat)-30;return n.add(e.raw),"sec-legacy"!==e.parsed.k&&(i.push(e),r.push(t)),{type:"secret",token:e}}finally{e.roomId?o.delete(e.roomId):o.delete("liveblocks-user-token")}}}}(e),h=new Map;function p(e){let t=()=>{if(e.unsubs.delete(t)){if(0===e.unsubs.size){var n;(n=e.room).id,h.delete(n.id),n.destroy()}}else E("This leave function was already called. Calling it more than once has no effect.")};return e.unsubs.add(t),{room:e.room,leave:t}}function f(t,n){var i,r,d,f,y,g,b;let w=h.get(t);if(void 0!==w)return p(w);!function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]}(null===n.initialPresence||void 0===n.initialPresence,"Please provide an initial presence value for the current user when entering the room.");let S=function(e,t){var n;let i,r,o;let s="function"==typeof e.initialPresence?e.initialPresence(t.roomId):e.initialPresence,a="function"==typeof e.initialStorage?e.initialStorage(t.roomId):e.initialStorage,[d,l]=function(){let e="undefined"!=typeof document?document:void 0,t={current:null};function n(){if((null==e?void 0:e.visibilityState)==="hidden"){var n;t.current=null!==(n=t.current)&&void 0!==n?n:Date.now()}else t.current=null}return null==e||e.addEventListener("visibilitychange",n),[t,()=>{null==e||e.removeEventListener("visibilitychange",n)}]}(),c={...t.delegates,canZombie:()=>void 0!==t.backgroundKeepAliveTimeout&&null!==d.current&&Date.now()>d.current+t.backgroundKeepAliveTimeout&&"synchronizing"!==Z()},u=new ei(c,t.enableDebugLogging),h={buffer:{flushTimerID:void 0,lastFlushedAt:0,presenceUpdates:{type:"full",data:s},messages:[],storageOperations:[]},staticSessionInfo:new e7(null),dynamicSessionInfo:new e7(null),myPresence:new e9(s),others:new e6,initialStorage:a,idFactory:null,clock:0,opClock:0,nodes:new Map,root:void 0,undoStack:[],redoStack:[],pausedHistory:null,activeBatch:null,unacknowledgedOps:new Map,opStackTraces:void 0},p=e=>e(),f=null!==(n=t.unstable_batchedUpdates)&&void 0!==n?n:p,y=!1;u.events.onMessage.subscribe(function(e){if("string"!=typeof e.data)return;let t=function(e){let t=N(e);return void 0===t?null:e2(t)?R(t.map(e=>F(e))):R([F(t)])}(e.data);if(null===t||0===t.length)return;let n={storageUpdates:new Map,others:[]};f(()=>{for(let i of t)switch(i.type){case 101:{let e=function(e){h.others.setConnection(e.actor,e.id,e.info,e.scopes),h.buffer.messages.push({type:100,data:h.myPresence.current,targetActor:e.actor}),B();let t=h.others.getUser(e.actor);return t?{type:"enter",user:t}:void 0}(i);e&&n.others.push(e);break}case 100:{let e=function(e){if(void 0!==e.targetActor){let t=h.others.getUser(e.actor);h.others.setOther(e.actor,e.data);let n=h.others.getUser(e.actor);if(void 0===t&&void 0!==n)return{type:"enter",user:n}}else h.others.patchOther(e.actor,e.data);let t=h.others.getUser(e.actor);return t?{type:"update",updates:e.data,user:t}:void 0}(i);e&&n.others.push(e);break}case 103:{var e;let t=h.others.current;b.customEvent.notify({connectionId:i.actor,user:i.actor<0?null:null!==(e=t.find(e=>e.connectionId===i.actor))&&void 0!==e?e:null,event:i.event});break}case 102:{let e=function(e){let t=h.others.getUser(e.actor);return t?(h.others.removeConnection(e.actor),{type:"leave",user:t}):null}(i);e&&n.others.push(e);break}case 300:b.ydoc.notify(i);break;case 104:n.others.push(function(e,t){var n;let i;for(let r of(h.dynamicSessionInfo.set({actor:e.actor,nonce:e.nonce,scopes:e.scopes}),h.idFactory=(n=e.actor,i=0,()=>"".concat(n,":").concat(i++)),k(t),h.others.connectionIds()))void 0===e.users[r]&&h.others.removeConnection(r);for(let t in e.users){let n=e.users[t],i=Number(t);h.others.setConnection(i,n.id,n.info,n.scopes)}return{type:"reset"}}(i,p));break;case 200:q(i);break;case 201:for(let[e,t]of M(i.ops,!1).updates.storageUpdates)n.storageUpdates.set(e,e1(n.storageUpdates.get(e),t));break;case 299:O("Storage mutation rejection error",i.reason);break;case 400:case 401:case 405:case 406:case 402:case 403:case 404:b.comments.notify(i)}x(n,p)})}),u.events.statusDidChange.subscribe(function(e){let t=u.authValue;if(null!==t){let e=td(t);if(e!==i){if(i=e,"secret"===t.type){let e=t.token.parsed;h.staticSessionInfo.set({userId:"sec-legacy"===e.k?e.id:e.uid,userInfo:"sec-legacy"===e.k?e.info:e.ui})}else h.staticSessionInfo.set({userId:void 0,userInfo:void 0})}}f(()=>{b.status.notify(e),k(p)})}),u.events.statusDidChange.subscribe(function(e){"reconnecting"===e?r=setTimeout(()=>{f(()=>{b.lostConnection.notify("lost"),y=!0,h.others.clearOthers(),x({others:[{type:"reset"}]},p)})},t.lostConnectionTimeout):(clearTimeout(r),y&&("disconnected"===e?f(()=>{b.lostConnection.notify("failed")}):f(()=>{b.lostConnection.notify("restored")}),y=!1))}),u.events.didConnect.subscribe(function(){h.buffer.presenceUpdates={type:"full",data:{...h.myPresence.current}},null!==J&&Y({flush:!1}),B()}),u.events.didDisconnect.subscribe(function(){clearTimeout(h.buffer.flushTimerID)}),u.events.onLiveblocksError.subscribe(e=>{f(()=>{b.error.notify(e)})});let g={roomId:t.roomId,getNode:e=>h.nodes.get(e),addNode:(e,t)=>void h.nodes.set(e,t),deleteNode:e=>void h.nodes.delete(e),generateId:()=>"".concat(U(),":").concat(h.clock++),generateOpId:()=>"".concat(U(),":").concat(h.opClock++),dispatch(e,t,n){let i=h.activeBatch;if(i){for(let[t,r]of(i.ops.push(...e),n))i.updates.storageUpdates.set(t,e1(i.updates.storageUpdates.get(t),r));i.reverseOps.unshift(...t)}else f(()=>{D(t,p),h.redoStack.length=0,W(e),x({storageUpdates:n},p)})},assertStorageIsWritable:()=>{var e;let t=null===(e=h.dynamicSessionInfo.current)||void 0===e?void 0:e.scopes;if(void 0!==t&&!er(t))throw Error("Cannot write to storage with a read only user, please ensure the user has write permissions")}},b={connection:v(),status:v(),lostConnection:v(),customEvent:v(),self:v(),myPresence:v(),others:v(),error:v(),storage:v(),history:v(),storageDidLoad:v(),storageStatus:v(),ydoc:v(),comments:v()};async function w(e,n,i,r,o){var s;let a=eb(t.baseUrl,"/v2/c/rooms/".concat(encodeURIComponent(e)).concat(n),o),d=(null===(s=t.polyfills)||void 0===s?void 0:s.fetch)||fetch;return await d(a,{...r,headers:{...null==r?void 0:r.headers,Authorization:"Bearer ".concat(td(i))}})}async function S(e,t){return w(t,"/storage",e,{method:"GET",headers:{"Content-Type":"application/json"}})}async function T(e,n){if(!u.authValue)throw Error("Not authorized");return w(t.roomId,e,u.authValue,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}function I(e){var n;let i=JSON.stringify(e),r=null===(n=h.dynamicSessionInfo.current)||void 0===n?void 0:n.nonce;if(t.unstable_fallbackToHTTP&&r&&new TextEncoder().encode(i).length>1047552){T("/send-message",{nonce:r,messages:e}).then(e=>{e.ok||403!==e.status||u.reconnect()}),E("Message was too large for websockets and sent over HTTP instead");return}u.send(i)}let A=new e8(h.staticSessionInfo,h.dynamicSessionInfo,h.myPresence,(e,t,n)=>{if(null===e||null===t)return null;{let i=er(t.scopes);return{connectionId:t.actor,id:e.userId,info:e.userInfo,presence:n,canWrite:i,canComment:eo(t.scopes),isReadOnly:!i}}});function k(e){let t=A.current;null!==t&&t!==o&&(e(()=>{b.self.notify(t)}),o=t)}let C=new e8(A,e=>null!==e?te("Me",e):null);function P(e,t){h.undoStack.length>=50&&h.undoStack.shift(),h.undoStack.push(e),z(t)}function D(e,t){null!==h.pausedHistory?h.pausedHistory.unshift(...e):P(e,t)}function x(e,t){let n=e.storageUpdates,i=e.others;t(()=>{var t;if(void 0!==i&&i.length>0){let e=h.others.current;for(let t of i)b.others.notify({...t,others:e})}if(null!==(t=e.presence)&&void 0!==t&&t&&(k(p),b.myPresence.notify(h.myPresence.current)),void 0!==n&&n.size>0){let e=Array.from(n.values());b.storage.notify(e)}ee()})}function U(){let e=h.dynamicSessionInfo.current;if(e)return e.actor;throw Error("Internal. Tried to get connection id but connection was never open")}function M(e,t){let n={reverse:[],storageUpdates:new Map,presence:!1},i=new Set,r=e.map(e=>"presence"===e.type||e.opId?e:{...e,opId:g.generateOpId()});for(let e of r)if("presence"===e.type){let t={type:"presence",data:{}};for(let n in e.data)t.data[n]=h.myPresence.current[n];if(h.myPresence.patch(e.data),null===h.buffer.presenceUpdates)h.buffer.presenceUpdates={type:"partial",data:e.data};else for(let t in e.data)h.buffer.presenceUpdates.data[t]=e.data[t];n.reverse.unshift(t),n.presence=!0}else{let r;if(t)r=0;else{let t=m(e.opId);r=h.unacknowledgedOps.delete(t)?2:1}let o=function(e,t){if(5===e.type&&"ACK"===e.id)return{modified:!1};switch(e.type){case 6:case 3:case 5:{let n=h.nodes.get(e.id);if(void 0===n)return{modified:!1};return n._apply(e,0===t)}case 1:{let n=h.nodes.get(e.id);if(void 0===n)return{modified:!1};if("HasParent"===n.parent.type&&eZ(n.parent.node))return n.parent.node._setChildKey(eA(e.parentKey),n,t);return{modified:!1}}case 4:case 2:case 7:case 8:{if(void 0===e.parentId)return{modified:!1};let n=h.nodes.get(e.parentId);if(void 0===n)return{modified:!1};return n._attachChild(e,t)}}}(e,r);if(o.modified){let t=o.modified.node._id;t&&i.has(t)||(n.storageUpdates.set(m(o.modified.node._id),e1(n.storageUpdates.get(m(o.modified.node._id)),o.modified)),n.reverse.unshift(...o.reverse)),(2===e.type||7===e.type||4===e.type)&&i.add(m(e.id))}}return{ops:r,reverse:n.reverse,updates:{storageUpdates:n.storageUpdates,presence:n.presence}}}function j(){return h.undoStack.length>0}function K(){return h.redoStack.length>0}function z(e){e(()=>{b.history.notify({canUndo:j(),canRedo:K()})})}function F(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||e2(e)?null:e}function B(){let e=h.buffer.storageOperations;if(e.length>0){for(let t of e)h.unacknowledgedOps.set(m(t.opId),t);ee()}if("connected"!==u.getStatus()){h.buffer.storageOperations=[];return}let n=Date.now(),i=n-h.buffer.lastFlushedAt;if(i>=t.throttleDelay){let e=function(){let e=[];for(let t of(h.buffer.presenceUpdates&&e.push("full"===h.buffer.presenceUpdates.type?{type:100,targetActor:-1,data:h.buffer.presenceUpdates.data}:{type:100,data:h.buffer.presenceUpdates.data}),h.buffer.messages))e.push(t);return h.buffer.storageOperations.length>0&&e.push({type:201,ops:h.buffer.storageOperations}),e}();if(0===e.length)return;I(e),h.buffer={flushTimerID:void 0,lastFlushedAt:n,messages:[],storageOperations:[],presenceUpdates:null}}else clearTimeout(h.buffer.flushTimerID),h.buffer.flushTimerID=setTimeout(B,t.throttleDelay-i)}function W(e){h.buffer.storageOperations.push(...e),B()}let J=null,V=null;function q(e){let t=new Map(h.unacknowledgedOps);!function(e,t){if(0===e.items.length)throw Error("Internal error: cannot load storage without items");void 0!==h.root?function(e,t){if(void 0===h.root)return;let n=new Map;for(let[e,t]of h.nodes)n.set(e,t._serialize());x(M(function(e,t){let n=[];return e.forEach((e,i)=>{t.get(i)||n.push({type:5,id:i})}),t.forEach((t,i)=>{let r=e.get(i);if(r)0===t.type&&(0!==r.type||JSON.stringify(t.data)!==JSON.stringify(r.data))&&n.push({type:3,id:i,data:t.data}),t.parentKey!==r.parentKey&&n.push({type:1,id:i,parentKey:m(t.parentKey,"Parent key must not be missing")});else switch(t.type){case 3:n.push({type:8,id:i,parentId:t.parentId,parentKey:t.parentKey,data:t.data});break;case 1:n.push({type:2,id:i,parentId:t.parentId,parentKey:t.parentKey});break;case 0:if(void 0===t.parentId||void 0===t.parentKey)throw Error("Internal error. Cannot serialize storage root into an operation");n.push({type:4,id:i,parentId:t.parentId,parentKey:t.parentKey,data:t.data});break;case 2:n.push({type:7,id:i,parentId:t.parentId,parentKey:t.parentKey})}}),n}(n,new Map(e)),!1).updates,t)}(e.items,t):h.root=eV._fromItems(e.items,g);let n=h.undoStack.length;for(let e in h.initialStorage)if(void 0===h.root.get(e)){var i;h.root.set(e,void 0===(i=h.initialStorage[e])?void 0:eX(i)?i.clone():L(i))}h.undoStack.length=n}(e,p),function(e,t){if(0===e.size)return;let n=[],i=M(Array.from(e.values()),!0);n.push({type:201,ops:i.ops}),x(i.updates,t),I(n)}(t,p),null==V||V(),ee(),b.storageDidLoad.notify()}async function G(){if(!u.authValue)return;let e=await S(u.authValue,t.roomId);q({type:200,items:await e.json()})}function Y(e){let n=h.buffer.messages;t.unstable_streamData?G():n.some(e=>200===e.type)||n.push({type:200}),e.flush&&B()}function X(){return null===J&&(Y({flush:!0}),J=new Promise(e=>{V=e}),ee()),J}async function Q(){return void 0!==h.root?Promise.resolve({root:h.root}):(await X(),{root:m(h.root)})}function Z(){return void 0===h.root?null===J?"not-loaded":"loading":0===h.unacknowledgedOps.size?"synchronized":"synchronizing"}let $=Z();function ee(){let e=Z();$!==e&&($=e,b.storageStatus.notify(e))}let et=new e8(h.others,e=>e.map((e,t)=>te("Other ".concat(t),e))),en={status:b.status.observable,lostConnection:b.lostConnection.observable,customEvent:b.customEvent.observable,others:b.others.observable,self:b.self.observable,myPresence:b.myPresence.observable,error:b.error.observable,storage:b.storage.observable,history:b.history.observable,storageDidLoad:b.storageDidLoad.observable,storageStatus:b.storageStatus.observable,ydoc:b.ydoc.observable,comments:b.comments.observable},es=function(e,t,n){async function i(i,r,o){return n(e,i,await t(),o,r)}async function r(e,t,n){let r;let o=await i(e,n,t);if(!o.ok&&o.status>=400&&o.status<600){let e;try{let t=await o.json();e=new tt(t.message,o.status,t)}catch(t){e=new tt(o.statusText,o.status)}throw e}try{r=await o.json()}catch(e){r={}}return r}return{getThreads:async function(e){var t,n;let r=await i("/threads/search",{since:null==e?void 0:null===(t=e.since)||void 0===t?void 0:t.toISOString()},{body:JSON.stringify({...(null==e?void 0:null===(n=e.query)||void 0===n?void 0:n.metadata)&&{metadata:e.query.metadata}}),headers:{"Content-Type":"application/json"},method:"POST"});if(r.ok){let e=await r.json();return{threads:e.data.map(e=>em(e)),inboxNotifications:e.inboxNotifications.map(e=>ev(e)),deletedThreads:e.deletedThreads.map(e=>ey(e)),deletedInboxNotifications:e.deletedInboxNotifications.map(e=>eg(e)),meta:{requestedAt:new Date(e.meta.requestedAt)}}}if(404===r.status)return{threads:[],inboxNotifications:[],deletedThreads:[],deletedInboxNotifications:[],meta:{requestedAt:new Date}};throw Error("There was an error while getting threads.")},getThread:async function(e){let{threadId:t}=e,n=await i("/thread-with-notification/".concat(t));if(n.ok){let e=await n.json();return{thread:em(e.thread),inboxNotification:e.inboxNotification?ev(e.inboxNotification):void 0}}if(404!==n.status)throw Error("There was an error while getting thread ".concat(t,"."))},createThread:async function(e){let{metadata:t,body:n,commentId:i,threadId:o}=e;return em(await r("/threads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o,comment:{id:i,body:n},metadata:t})}))},editThreadMetadata:async function(e){let{metadata:t,threadId:n}=e;return await r("/threads/".concat(encodeURIComponent(n),"/metadata"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})},createComment:async function(e){let{threadId:t,commentId:n,body:i}=e;return e_(await r("/threads/".concat(encodeURIComponent(t),"/comments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n,body:i})}))},editComment:async function(e){let{threadId:t,commentId:n,body:i}=e;return e_(await r("/threads/".concat(encodeURIComponent(t),"/comments/").concat(encodeURIComponent(n)),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({body:i})}))},deleteComment:async function(e){let{threadId:t,commentId:n}=e;await r("/threads/".concat(encodeURIComponent(t),"/comments/").concat(encodeURIComponent(n)),{method:"DELETE"})},addReaction:async function(e){var t;let{threadId:n,commentId:i,emoji:o}=e;return{...t=await r("/threads/".concat(encodeURIComponent(n),"/comments/").concat(encodeURIComponent(i),"/reactions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:o})}),createdAt:new Date(t.createdAt)}},removeReaction:async function(e){let{threadId:t,commentId:n,emoji:i}=e;await r("/threads/".concat(encodeURIComponent(t),"/comments/").concat(encodeURIComponent(n),"/reactions/").concat(encodeURIComponent(i)),{method:"DELETE"})}}}(t.roomId,c.authenticate,w);async function ea(e,n){let i;let r=await c.authenticate(),o=await w(t.roomId,e,r,n);if(!o.ok&&o.status>=400&&o.status<600){let e;try{let t=await o.json();e=new tc(t.message,o.status,t)}catch(t){e=new tc(o.statusText,o.status)}throw e}try{i=await o.json()}catch(e){i={}}return i}async function el(e){await ea("/inbox-notifications/read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inboxNotificationIds:e})})}let ec=new eh(async e=>{let t=e.flat();return await el(t),t},{delay:50});async function eu(e){await ec.get(e)}return Object.defineProperty({[ed]:{get presenceBuffer(){var ep,ef;return L(null!==(ef=null===(ep=h.buffer.presenceUpdates)||void 0===ep?void 0:ep.data)&&void 0!==ef?ef:null)},get undoStack(){return L(h.undoStack)},get nodeCount(){return h.nodes.size},getSelf_forDevTools:()=>C.current,getOthers_forDevTools:()=>et.current,simulate:{explicitClose:e=>u._privateSendMachineEvent({type:"EXPLICIT_SOCKET_CLOSE",event:e}),rawSend:e=>u.send(e)},comments:{...es},notifications:{getRoomNotificationSettings:function(){return ea("/notification-settings")},updateRoomNotificationSettings:function(e){return ea("/notification-settings",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})},markInboxNotificationAsRead:eu}},id:t.roomId,subscribe:function(e,t,n){if("string"==typeof e&&("my-presence"===e||"others"===e||"event"===e||"error"===e||"history"===e||"status"===e||"storage-status"===e||"lost-connection"===e||"connection"===e)){if("function"!=typeof t)throw Error("Second argument must be a callback function");switch(e){case"event":return en.customEvent.subscribe(t);case"my-presence":return en.myPresence.subscribe(t);case"others":return en.others.subscribe(e=>{let{others:n,...i}=e;return t(n,i)});case"error":return en.error.subscribe(t);case"connection":return en.status.subscribe(e=>t(H(e)));case"status":return en.status.subscribe(t);case"lost-connection":return en.lostConnection.subscribe(t);case"history":return en.history.subscribe(t);case"storage-status":return en.storageStatus.subscribe(t);default:return _(e,'"'.concat(String(e),'" is not a valid event name'))}}if(void 0===t||"function"==typeof e){if("function"==typeof e)return en.storage.subscribe(e);throw Error("Please specify a listener callback")}if(eQ(e))return(null==n?void 0:n.isDeep)?en.storage.subscribe(n=>{let i=n.filter(t=>(function e(t,n){return t===n||"HasParent"===t.parent.type&&e(t.parent.node,n)})(t.node,e));i.length>0&&t(i)}):en.storage.subscribe(n=>{for(let i of n)i.node._id===e._id&&t(i.node)});throw Error("".concat(String(e)," is not a value that can be subscribed to."))},connect:()=>u.connect(),reconnect:()=>u.reconnect(),disconnect:()=>u.disconnect(),destroy:()=>{l(),u.destroy()},updatePresence:function(e,t){let n={};for(let t in null===h.buffer.presenceUpdates&&(h.buffer.presenceUpdates={type:"partial",data:{}}),e){let i=e[t];void 0!==i&&(h.buffer.presenceUpdates.data[t]=i,n[t]=h.myPresence.current[t])}h.myPresence.patch(e),h.activeBatch?((null==t?void 0:t.addToHistory)&&h.activeBatch.reverseOps.unshift({type:"presence",data:n}),h.activeBatch.updates.presence=!0):(B(),f(()=>{(null==t?void 0:t.addToHistory)&&D([{type:"presence",data:n}],p),x({presence:!0},p)}))},updateYDoc:function(e,t){let n={type:301,update:e,guid:t};h.buffer.messages.push(n),b.ydoc.notify(n),B()},broadcastEvent:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shouldQueueEventIfNotReady:!1};("connected"===u.getStatus()||t.shouldQueueEventIfNotReady)&&(h.buffer.messages.push({type:103,event:e}),B())},batch:function(e){let t;return h.activeBatch?e():(f(()=>{h.activeBatch={ops:[],updates:{storageUpdates:new Map,presence:!1,others:[]},reverseOps:[]};try{t=e()}finally{let e=h.activeBatch;h.activeBatch=null,e.reverseOps.length>0&&D(e.reverseOps,p),e.ops.length>0&&(h.redoStack.length=0),e.ops.length>0&&W(e.ops),x(e.updates,p),B()}}),t)},history:{undo:function(){if(h.activeBatch)throw Error("undo is not allowed during a batch");let e=h.undoStack.pop();if(void 0===e)return;h.pausedHistory=null;let t=M(e,!0);for(let e of(f(()=>{x(t.updates,p),h.redoStack.push(t.reverse),z(p)}),t.ops))"presence"!==e.type&&h.buffer.storageOperations.push(e);B()},redo:function(){if(h.activeBatch)throw Error("redo is not allowed during a batch");let e=h.redoStack.pop();if(void 0===e)return;h.pausedHistory=null;let t=M(e,!0);for(let e of(f(()=>{x(t.updates,p),h.undoStack.push(t.reverse),z(p)}),t.ops))"presence"!==e.type&&h.buffer.storageOperations.push(e);B()},canUndo:j,canRedo:K,clear:function(){h.undoStack.length=0,h.redoStack.length=0},pause:function(){null===h.pausedHistory&&(h.pausedHistory=[])},resume:function(){let e=h.pausedHistory;h.pausedHistory=null,null!==e&&e.length>0&&P(e,f)}},fetchYDoc:function(e,t){h.buffer.messages.find(n=>300===n.type&&n.vector===e&&n.guid===t)||h.buffer.messages.push({type:300,vector:e,guid:t}),B()},getStorage:Q,getStorageSnapshot:function(){let e=h.root;return void 0!==e?e:(X(),null)},getStorageStatus:Z,events:en,getStatus:()=>u.getStatus(),getConnectionState:()=>u.getLegacyStatus(),getSelf:()=>A.current,getPresence:()=>h.myPresence.current,getOthers:()=>h.others.current},ed,{enumerable:!1})}({initialPresence:null!==(r=n.initialPresence)&&void 0!==r?r:{},initialStorage:n.initialStorage},{roomId:t,throttleDelay:o,lostConnectionTimeout:s,backgroundKeepAliveTimeout:a,polyfills:e.polyfills,delegates:null!==(d=e.mockedDelegates)&&void 0!==d?d:{createSocket:(b=null===(i=e.polyfills)||void 0===i?void 0:i.WebSocket,e=>{let n=null!=b?b:"undefined"==typeof WebSocket?void 0:WebSocket;if(void 0===n)throw new J("To use Liveblocks client in a non-DOM environment, you need to provide a WebSocket polyfill.");let i=new URL(l);if(i.protocol="http:"===i.protocol?"ws":"wss",i.pathname="/v7",i.searchParams.set("roomId",t),"secret"===e.type)i.searchParams.set("tok",e.token.raw);else{if("public"!==e.type)return _(e,"Unhandled case");i.searchParams.set("pubkey",e.publicApiKey)}return i.searchParams.set("version",u||"dev"),new n(i.toString())}),authenticate:async()=>c.getAuthValue({requestedScope:"room:read",roomId:t})},enableDebugLogging:e.enableDebugLogging,unstable_batchedUpdates:null==n?void 0:n.unstable_batchedUpdates,baseUrl:l,unstable_fallbackToHTTP:!!e.unstable_fallbackToHTTP,unstable_streamData:!!e.unstable_streamData}),T={room:S,unsubs:new Set};if(h.set(t,T),null===(y=null!==(f=n.autoConnect)&&void 0!==f?f:n.shouldInitiallyConnect)||void 0===y||y){if("undefined"==typeof atob){if((null===(g=e.polyfills)||void 0===g?void 0:g.atob)===void 0)throw Error("You need to polyfill atob to use the client in your environment. Please follow the instructions at https://liveblocks.io/docs/errors/liveblocks-client/atob-polyfill");global.atob=e.polyfills.atob}S.connect()}return p(T)}let y=ef(null),{getInboxNotifications:g,getUnreadInboxNotificationsCount:b,markAllInboxNotificationsAsRead:w,markInboxNotificationAsRead:S}=function(e){let{baseUrl:t,authManager:n,currentUserIdStore:i,fetcher:r}=e;async function o(e,o,s){let a;let d=await n.getAuthValue({requestedScope:"comments:read"});if("secret"===d.type&&"acc"===d.token.parsed.k){let e=d.token.parsed.uid;i.set(()=>e)}let l=eb(t,"/v2/c".concat(e),s),c=await r(l.toString(),{...o,headers:{...null==o?void 0:o.headers,Authorization:"Bearer ".concat(td(d))}});if(!c.ok&&c.status>=400&&c.status<600){let e;try{let t=await c.json();e=new tc(t.message,c.status,t)}catch(t){e=new tc(c.statusText,c.status)}throw e}try{a=await c.json()}catch(e){a={}}return a}async function s(e){var t;let n=await o("/inbox-notifications",void 0,{limit:null==e?void 0:e.limit,since:null==e?void 0:null===(t=e.since)||void 0===t?void 0:t.toISOString()});return{threads:n.threads.map(e=>em(e)),inboxNotifications:n.inboxNotifications.map(e=>ev(e)),deletedThreads:n.deletedThreads.map(e=>ey(e)),deletedInboxNotifications:n.deletedInboxNotifications.map(e=>eg(e)),meta:{requestedAt:new Date(n.meta.requestedAt)}}}async function a(){let{count:e}=await o("/inbox-notifications/count");return e}async function d(){await o("/inbox-notifications/read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inboxNotificationIds:"all"})})}async function l(e){await o("/inbox-notifications/read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inboxNotificationIds:e})})}let c=new eh(async e=>{let t=e.flat();return await l(t),t},{delay:50});return{getInboxNotifications:s,getUnreadInboxNotificationsCount:a,markAllInboxNotificationsAsRead:d,markInboxNotificationAsRead:async function(e){await c.get(e)}}}({baseUrl:l,fetcher:(null===(t=e.polyfills)||void 0===t?void 0:t.fetch)||fetch,authManager:c,currentUserIdStore:y}),T=function(){let e=ef({threads:{},queries:{},optimisticUpdates:[],inboxNotifications:{},notificationSettings:{}});return{...e,deleteThread(t){e.set(e=>({...e,threads:function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let{[t]:n,...i}=e;return i}return e}(e.threads,t),inboxNotifications:Object.fromEntries(Object.entries(e.inboxNotifications).filter(e=>{let[n,i]=e;return i.threadId!==t}))}))},updateThreadAndNotification(t,n){e.set(e=>{let i=e.threads[t.id];return{...e,threads:void 0===i||1===tn(t,i)?{...e.threads,[t.id]:t}:e.threads,inboxNotifications:void 0===n?e.inboxNotifications:{...e.inboxNotifications,[n.id]:n}}})},updateThreadsAndNotifications(t,n,i,r,o){e.set(e=>({...e,threads:function(e,t){let n={...e};return t.newThreads.forEach(e=>{let t=n[e.id];t&&1===tn(t,e)||(n[e.id]=e)}),t.deletedThreads.forEach(e=>{let{id:t,deletedAt:i}=e,r=n[t];void 0!==r&&(r.deletedAt=i,r.updatedAt=i,r.comments=[])}),n}(e.threads,{newThreads:t,deletedThreads:i}),inboxNotifications:function(e,t){let n={...e};return t.newInboxNotifications.forEach(e=>{let t=n[e.id];(!t||1!=(t.notifiedAt>e.notifiedAt?1:t.notifiedAt<e.notifiedAt?-1:t.readAt&&e.readAt?t.readAt>e.readAt?1:t.readAt<e.readAt?-1:0:t.readAt||e.readAt?t.readAt?1:-1:0))&&(n[e.id]=e)}),t.deletedNotifications.forEach(e=>{let{id:t}=e;return delete n[t]}),n}(e.inboxNotifications,{newInboxNotifications:n,deletedNotifications:r}),queries:void 0!==o?{...e.queries,[o]:{isLoading:!1}}:e.queries}))},updateRoomInboxNotificationSettings(t,n,i){e.set(e=>({...e,notificationSettings:{...e.notificationSettings,[t]:n},queries:{...e.queries,[i]:{isLoading:!1}}}))},pushOptimisticUpdate(t){e.set(e=>({...e,optimisticUpdates:[...e.optimisticUpdates,t]}))},setQueryState(t,n){e.set(e=>({...e,queries:{...e.queries,[t]:n}}))}}}(),I=e.resolveUsers,A=th(()=>!I,"Set the resolveUsers option in createClient to specify user info."),k=ep(async e=>{let t=e.flat(),n=await (null==I?void 0:I({userIds:t}));return A(),null!=n?n:t.map(()=>void 0)},{delay:50}),C=e.resolveRoomsInfo,P=th(()=>!C,"Set the resolveRoomsInfo option in createClient to specify room info."),D=ep(async e=>{let t=e.flat(),n=await (null==C?void 0:C({roomIds:t}));return P(),null!=n?n:t.map(()=>void 0)},{delay:50});return Object.defineProperty({logout:function(){for(let{room:t}of(c.reset(),h.values())){var e;"initial"===(e=t.getStatus())||"disconnected"===e||t.reconnect()}},enter:function(e,t){let{room:n,leave:i}=f(e,t);return n},getRoom:function(e){var t;return(null===(t=h.get(e))||void 0===t?void 0:t.room)||null},leave:function(e){var t,n;for(let i of null!==(n=null===(t=h.get(e))||void 0===t?void 0:t.unsubs)&&void 0!==n?n:new Set)i()},enterRoom:f,[ed]:{notifications:{getInboxNotifications:g,getUnreadInboxNotificationsCount:b,markAllInboxNotificationsAsRead:w,markInboxNotificationAsRead:S},currentUserIdStore:y,resolveMentionSuggestions:e.resolveMentionSuggestions,cacheStore:T,usersStore:k,roomsInfoStore:D,getRoomIds:()=>Array.from(h.keys())}},ed,{enumerable:!1})}var tc=class extends Error{constructor(e,t,n){super(e),this.message=e,this.status=t,this.details=n}};function tu(e,t,n,i,r){if("number"!=typeof t||t<n||void 0!==i&&t>i)throw Error(void 0!==i?"".concat(e," should be between ").concat(null!=r?r:n," and ").concat(i,"."):"".concat(e," should be at least ").concat(null!=r?r:n,"."));return t}function th(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return()=>{}}function tp(e){let t={state:"stopped",timeoutHandle:null,interval:null,lastScheduledAt:null,remainingInterval:null};function n(){"running"===t.state&&i(t.interval),e()}function i(e){t={state:"running",interval:"stopped"!==t.state?t.interval:e,lastScheduledAt:performance.now(),timeoutHandle:setTimeout(n,e),remainingInterval:null}}function r(e){"running"!==t.state&&i(e)}function o(){"stopped"!==t.state&&(t.timeoutHandle&&clearTimeout(t.timeoutHandle),t={state:"stopped",interval:null,lastScheduledAt:null,timeoutHandle:null,remainingInterval:null})}return{start:r,restart:function(e){o(),r(e)},pause:function(){"running"===t.state&&(clearTimeout(t.timeoutHandle),t={state:"paused",interval:t.interval,lastScheduledAt:t.lastScheduledAt,timeoutHandle:null,remainingInterval:t.interval-(performance.now()-t.lastScheduledAt)})},resume:function(){if("paused"===t.state){var e;e=t.remainingInterval,"paused"===t.state&&(t={state:"running",interval:t.interval,lastScheduledAt:t.lastScheduledAt,timeoutHandle:setTimeout(n,e),remainingInterval:null})}},stop:o}}function tf(e,t){if(Object.is(e,t))return!0;let n=Array.isArray(e),i=Array.isArray(t);return n||i?!!n&&!!i&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}(e,t):function(e,t){if("object"!=typeof e||null===e||"object"!=typeof t||null===t||"[object Object]"!==Object.prototype.toString.call(e)||"[object Object]"!==Object.prototype.toString.call(t))return!1;let n=Object.keys(e);return n.length===Object.keys(t).length&&n.every(n=>Object.prototype.hasOwnProperty.call(t,n)&&Object.is(e[n],t[n]))}(e,t)}RegExp(["&","<",">",'"',"'"].map(e=>"\\".concat(e)).join("|"),"g"),RegExp(["_","*","#","`","~","!","|","(",")","{","}","[","]"].map(e=>"\\".concat(e)).join("|"),"g"),f(c,u,"esm")}}]);